{"version":3,"sources":["/source/node_modules/browser-pack/_prelude.js","/source/node_modules/es6-promise/dist/es6-promise.js","/source/node_modules/events/events.js","/source/node_modules/process/browser.js","/source/node_modules/webworkify/index.js","/source/src/config.js","/source/src/core/features.js","/source/src/core/media-info.js","/source/src/core/media-segment-info.js","/source/src/core/mse-controller.js","/source/src/core/mse-events.js","/source/src/core/transmuxer.js","/source/src/core/transmuxing-controller.js","/source/src/core/transmuxing-events.js","/source/src/core/transmuxing-worker.js","/source/src/demux/amf-parser.js","/source/src/demux/demux-errors.js","/source/src/demux/exp-golomb.js","/source/src/demux/flv-demuxer.js","/source/src/demux/sps-parser.js","/source/src/flv.js","/source/src/io/fetch-stream-loader.js","/source/src/io/io-controller.js","/source/src/io/loader.js","/source/src/io/param-seek-handler.js","/source/src/io/range-seek-handler.js","/source/src/io/speed-sampler.js","/source/src/io/websocket-loader.js","/source/src/io/xhr-moz-chunked-loader.js","/source/src/io/xhr-msstream-loader.js","/source/src/io/xhr-range-loader.js","/source/src/player/flv-player.js","/source/src/player/native-player.js","/source/src/player/player-errors.js","/source/src/player/player-events.js","/source/src/remux/aac-silent.js","/source/src/remux/mp4-generator.js","/source/src/remux/mp4-remuxer.js","/source/src/utils/browser.js","/source/src/utils/bsearch.js","/source/src/utils/exception.js","/source/src/utils/logger.js","/source/src/utils/logging-control.js","/source/src/utils/polyfill.js","/source/src/utils/utf8-conv.js"],"names":["e","t","n","r","s","o","u","a","require","i","f","Error","code","l","exports","call","length","1","module","lib$es6$promise$utils$$objectOrFunction","x","lib$es6$promise$utils$$isFunction","lib$es6$promise$asap$$setScheduler","scheduleFn","lib$es6$promise$asap$$customSchedulerFn","lib$es6$promise$asap$$setAsap","asapFn","lib$es6$promise$asap$$asap","lib$es6$promise$asap$$useNextTick","process","nextTick","lib$es6$promise$asap$$flush","lib$es6$promise$asap$$useVertxTimer","lib$es6$promise$asap$$vertxNext","lib$es6$promise$asap$$useMutationObserver","iterations","observer","lib$es6$promise$asap$$BrowserMutationObserver","node","document","createTextNode","observe","characterData","data","lib$es6$promise$asap$$useMessageChannel","channel","MessageChannel","port1","onmessage","port2","postMessage","lib$es6$promise$asap$$useSetTimeout","setTimeout","lib$es6$promise$asap$$len","callback","lib$es6$promise$asap$$queue","arg","undefined","lib$es6$promise$asap$$attemptVertx","vertx","runOnLoop","runOnContext","lib$es6$promise$then$$then","onFulfillment","onRejection","parent","this","child","constructor","lib$es6$promise$$internal$$noop","lib$es6$promise$$internal$$PROMISE_ID","lib$es6$promise$$internal$$makePromise","state","_state","arguments","lib$es6$promise$$internal$$invokeCallback","_result","lib$es6$promise$$internal$$subscribe","lib$es6$promise$promise$resolve$$resolve","object","Constructor","promise","lib$es6$promise$$internal$$resolve","lib$es6$promise$$internal$$selfFulfillment","TypeError","lib$es6$promise$$internal$$cannotReturnOwn","lib$es6$promise$$internal$$getThen","then","error","lib$es6$promise$$internal$$GET_THEN_ERROR","lib$es6$promise$$internal$$tryThen","value","fulfillmentHandler","rejectionHandler","lib$es6$promise$$internal$$handleForeignThenable","thenable","sealed","lib$es6$promise$$internal$$fulfill","reason","lib$es6$promise$$internal$$reject","_label","lib$es6$promise$$internal$$handleOwnThenable","lib$es6$promise$$internal$$FULFILLED","lib$es6$promise$$internal$$REJECTED","lib$es6$promise$$internal$$handleMaybeThenable","maybeThenable","lib$es6$promise$then$$default","resolve","lib$es6$promise$promise$resolve$$default","lib$es6$promise$$internal$$publishRejection","_onerror","lib$es6$promise$$internal$$publish","lib$es6$promise$$internal$$PENDING","_subscribers","subscribers","settled","detail","lib$es6$promise$$internal$$ErrorObject","lib$es6$promise$$internal$$tryCatch","lib$es6$promise$$internal$$TRY_CATCH_ERROR","succeeded","failed","hasCallback","lib$es6$promise$$internal$$initializePromise","resolver","lib$es6$promise$$internal$$nextId","lib$es6$promise$$internal$$id","lib$es6$promise$promise$all$$all","entries","lib$es6$promise$enumerator$$default","lib$es6$promise$promise$race$$race","lib$es6$promise$utils$$isArray","reject","lib$es6$promise$promise$reject$$reject","lib$es6$promise$promise$$needsResolver","lib$es6$promise$promise$$needsNew","lib$es6$promise$promise$$Promise","lib$es6$promise$enumerator$$Enumerator","input","_instanceConstructor","_input","_remaining","Array","_enumerate","lib$es6$promise$enumerator$$validationError","lib$es6$promise$polyfill$$polyfill","local","global","self","Function","P","Promise","Object","prototype","toString","cast","lib$es6$promise$promise$$default","lib$es6$promise$utils$$_isArray","isArray","lib$es6$promise$asap$$scheduleFlush","lib$es6$promise$asap$$browserWindow","window","lib$es6$promise$asap$$browserGlobal","MutationObserver","WebKitMutationObserver","lib$es6$promise$asap$$isNode","lib$es6$promise$asap$$isWorker","Uint8ClampedArray","importScripts","Math","random","substring","lib$es6$promise$promise$all$$default","lib$es6$promise$promise$race$$default","lib$es6$promise$promise$reject$$default","all","race","_setScheduler","_setAsap","_asap","catch","_eachEntry","entry","c","_settledAt","_willSettleAt","enumerator","lib$es6$promise$polyfill$$default","lib$es6$promise$umd$$ES6Promise","polyfill","define","EventEmitter","_events","_maxListeners","isFunction","isNumber","isObject","isUndefined","defaultMaxListeners","setMaxListeners","isNaN","emit","type","er","handler","len","args","listeners","err","context","slice","apply","addListener","listener","m","newListener","push","warned","console","trace","on","once","g","removeListener","fired","list","position","splice","removeAllListeners","key","ret","listenerCount","evlistener","emitter","runTimeout","fun","cachedSetTimeout","runClearTimeout","marker","cachedClearTimeout","clearTimeout","cleanUpNextTick","draining","currentQueue","queue","concat","queueIndex","drainQueue","timeout","run","Item","array","noop","title","browser","env","argv","version","versions","off","binding","name","cwd","chdir","dir","umask","bundleFn","sources","cache","stringify","JSON","fn","options","wkey","cacheKeys","keys","exp","default","floor","pow","wcache","skey","scache","src","map","join","URL","webkitURL","mozURL","msURL","blob","Blob","bare","workerUrl","createObjectURL","worker","Worker","objectURL","createDefaultConfig","assign","defaultConfig","enableWorker","enableStashBuffer","stashInitialSize","isLive","lazyLoad","lazyLoadMaxDuration","deferLoadAfterSourceOpen","statisticsInfoReportInterval","accurateSeek","seekType","seekParamStart","seekParamEnd","rangeLoadZeroStart","customSeekHandler","_ioController","_config","Features","MediaSource","isTypeSupported","ioctl","_ioController2","loaderType","destroy","mimeType","videoElement","createElement","canPlay","canPlayType","features","mseFlvPlayback","mseLiveFlvPlayback","networkStreamIO","networkLoaderName","nativeMP4H264Playback","nativeWebmVP8Playback","nativeWebmVP9Playback","supportMSEH264Playback","supportNetworkStreamIO","getNetworkLoaderTypeName","supportNativeMediaPlayback","MediaInfo","_classCallCheck","duration","hasAudio","hasVideo","audioCodec","videoCodec","audioDataRate","videoDataRate","audioSampleRate","audioChannelCount","width","height","fps","profile","level","chromaFormat","sarNum","sarDen","metadata","segments","segmentCount","hasKeyframesIndex","keyframesIndex","audioInfoComplete","videoInfoComplete","milliseconds","table","keyframeIdx","_search","times","index","fileposition","filepositions","idx","last","mid","lbound","ubound","SampleInfo","dts","pts","originalDts","isSync","isSyncPoint","MediaSegmentInfo","beginDts","endDts","beginPts","endPts","originalBeginDts","originalEndDts","syncPoints","firstSample","lastSample","sampleInfo","IDRSampleList","_list","clear","MediaSegmentInfoList","_type","_lastAppendLocation","_searchNearestSegmentBefore","mediaSegmentInfo","msi","lastAppendIdx","insertIdx","segment","getLastSegmentBefore","segmentIdx","_logger","_browser","_mseEvents","_mediaSegmentInfo","_exception","MSEController","TAG","_emitter","_events2","onSourceOpen","_onSourceOpen","bind","onSourceEnded","_onSourceEnded","onSourceClose","_onSourceClose","onSourceBufferError","_onSourceBufferError","onSourceBufferUpdateEnd","_onSourceBufferUpdateEnd","_mediaSource","_mediaSourceObjectURL","_mediaElement","_isBufferFull","_hasPendingEos","_pendingSourceBufferInit","_mimeTypes","video","audio","_sourceBuffers","_lastInitSegments","_pendingSegments","_pendingRemoveRanges","_idrList","detachMediaElement","event","mediaElement","IllegalStateException","ms","addEventListener","ps","sb","readyState","removeSourceBuffer","removeEventListener","endOfStream","_logger2","message","removeAttribute","revokeObjectURL","initSegment","deferred","is","container","codec","firstInitSegment","v","addSourceBuffer","_mseEvents2","ERROR","msg","updating","_doAppendSegments","mediaSegment","_hasPendingRemoveRanges","seconds","abort","buffered","start","end","_doRemoveRanges","_browser2","safari","lastInitSegment","_hasPendingSegments","getLastSyncPointBeforeDts","ranges","range","shift","remove","pendingSegments","appendBuffer","hasOwnProperty","appendArray","info","unshift","BUFFER_FULL","pendings","appendInitSegment","SOURCE_OPEN","prr","UPDATE_END","MSEEvents","_loggingControl","_transmuxingController","_transmuxingEvents","_transmuxingWorker","_mediaInfo","Transmuxer","mediaDataSource","config","work","_worker","_transmuxingWorker2","_workerDestroying","_onWorkerMessage","cmd","param","onLoggingConfigChanged","_onLoggingConfigChanged","_loggingControl2","registerListener","getConfig","_controller","_transmuxingController2","ctl","_transmuxingEvents2","IO_ERROR","_onIOError","DEMUX_ERROR","_onDemuxError","INIT_SEGMENT","_onInitSegment","MEDIA_SEGMENT","_onMediaSegment","LOADING_COMPLETE","_onLoadingComplete","RECOVERED_EARLY_EOF","_onRecoveredEarlyEof","MEDIA_INFO","_onMediaInfo","STATISTICS_INFO","_onStatisticsInfo","RECOMMEND_SEEKPOINT","_onRecommendSeekpoint","stop","seek","pause","resume","_this","_this2","_this3","_this4","mediaInfo","_this5","statisticsInfo","_this6","_this7","_this8","_this9","terminate","setPrototypeOf","_mediaInfo2","_flvDemuxer","_mp4Remuxer","_demuxErrors","TransmuxingController","filesize","url","cors","withCredentials","_mediaDataSource","_currentSegmentIndex","totalDuration","forEach","timestampBase","_demuxer","_remuxer","_ioctl","_pendingSeekTime","_pendingResolveSeekPoint","_loadSegment","segmentIndex","optionalFrom","dataSource","onError","_onIOException","onSeeked","_onIOSeeked","onComplete","_onIOComplete","onRecoveredEarlyEof","_onIORecoveredEarlyEof","bindDataSource","onDataArrival","_onInitChunkArrival","open","_internalAbort","isWorking","isPaused","isSeekable","targetSegmentIndex","_searchSegmentIndexContains","segmentInfo","keyframe","getNearestKeyframe","targetSegmentInfo","insertDiscontinuity","_keyframe","byteStart","probeData","_flvDemuxer2","probe","match","_mp4Remuxer2","mds","overridedDuration","_onDemuxException","onMediaInfo","onInitSegment","_onRemuxerInitSegmentArrival","onMediaSegment","_onRemuxerMediaSegmentArrival","_demuxErrors2","FORMAT_UNSUPPORTED","consumed","exportInfo","target","extraData","nextSegmentIndex","seekpoint","_reportStatisticsInfo","currentUrl","speed","currentSpeed","currentSegmentIndex","totalSegmentCount","TransmuxingEvents","_polyfill","TransmuxingWorker","obj","onLoadingComplete","onStatisticsInfo","statInfo","onIOError","onDemuxError","onRecommendSeekpoint","controller","_polyfill2","install","applyConfig","_utf8Conv","le","buf","ArrayBuffer","DataView","setInt16","Int16Array","AMF","arrayBuffer","dataOffset","dataSize","parseValue","size","parseString","isObjectEnd","objectEnd","parseObject","getUint16","str","_utf8Conv2","Uint8Array","getUint32","timestamp","getFloat64","localTimeOffset","getInt16","Date","offset","getUint8","b","amfstr","terminal","amfobj","_terminal","amfvar","parseVariable","_marker","strictArrayLength","val","date","parseDate","amfLongStr","w","DemuxErrors","OK","FORMAT_ERROR","CODEC_UNSUPPORTED","ExpGolomb","uint8array","_buffer","_buffer_index","_total_bytes","byteLength","_total_bits","_current_word","_current_word_bits_left","buffer_bytes_left","bytes_read","min","word","set","subarray","buffer","bits","InvalidArgumentException","result","bits_need_left","_fillCurrentWord","bits_read_next","result2","readBits","zero_count","_skipLeadingZero","leading_zeros","readUEG","ReadBig32","_amfParser","_bsearch","_spsParser","FLVDemuxer","_onError","_onTrackMetadata","_onDataAvailable","_dataOffset","_firstParse","_dispatch","_hasAudio","hasAudioTrack","_hasVideo","hasVideoTrack","_audioInitialMetadataDispatched","_videoInitialMetadataDispatched","_metadata","_audioMetadata","_videoMetadata","_naluLengthSize","_timestampBase","_timescale","_duration","_durationOverrided","_referenceFrameRate","fixed","fps_num","fps_den","_videoTrack","id","sequenceNumber","samples","_audioTrack","_littleEndian","loader","parseChunks","chunk","prevTagSize0","_v","tagType","ts2","ts1","ts0","ts3","streamId","_parseAudioData","_parseVideoData","_parseScriptData","prevTagSize","_isInitialMetadataDispatched","scriptData","_amfParser2","parseScriptData","onMetaData","audiodatarate","videodatarate","framerate","_typeof","keyframes","_parseKeyframesIndex","isComplete","time","tagTimestamp","meta","track","timescale","soundSpec","soundFormat","soundRate","soundRateIndex","soundRateTable","soundType","channelCount","refSampleDuration","aacData","_parseAACAudioData","packetType","misc","samplingRate","mi","originalAudioObjectType","aacSample","unit","_parseAACAudioSpecificConfig","mpegSamplingRates","audioObjectType","audioExtensionObjectType","samplingIndex","extensionSamplingIndex","samplingFrequence","channelConfig","userAgent","navigator","toLowerCase","indexOf","tagPosition","spec","frameType","codecId","_parseAVCVideoPacket","cts","_parseAVCDecoderConfigurationRecord","_parseAVCVideoData","avcc","avcProfile","spsCount","sps","_spsParser2","parseSPS","codecWidth","codec_size","codecHeight","presentWidth","present_size","presentHeight","profile_string","level_string","bitDepth","bit_depth","chroma_format","sarRatio","sar_ratio","frameRate","frame_rate","codecArray","codecString","j","h","chroma_format_string","ppsCount","_i","_len","units","lengthSize","naluSize","unitType","avcSample","isKeyframe","base","mismatch","_expGolomb","SPSParser","src_length","dst","dst_idx","rbsp","_ebsp2rbsp","gb","_expGolomb2","readByte","profile_idc","level_idc","getProfileString","getLevelString","chroma_format_idc","chroma_format_table","readBool","scaling_list_count","_skipScalingList","pic_order_cnt_type","readSEG","num_ref_frames_in_pic_order_cnt_cycle","pic_width_in_mbs_minus1","pic_height_in_map_units_minus1","frame_mbs_only_flag","frame_crop_left_offset","frame_crop_right_offset","frame_crop_top_offset","frame_crop_bottom_offset","frame_cropping_flag","sar_width","sar_height","fps_fixed","vui_parameters_present_flag","aspect_ratio_idc","sar_w_table","sar_h_table","num_units_in_tick","time_scale","sarScale","crop_unit_x","crop_unit_y","sub_wc","sub_hc","codec_width","codec_height","present_width","ceil","getChromaFormatString","count","last_scale","next_scale","delta_scale","toFixed","chroma","createPlayer","optionalConfig","_flvPlayer2","_nativePlayer2","isSupported","_features2","getFeatureList","_features","_flvPlayer","_nativePlayer","_playerEvents","_playerErrors","flvjs","Events","_playerEvents2","ErrorTypes","ErrorDetails","FlvPlayer","NativePlayer","LoggingControl","_loader","FetchStreamLoader","seekHandler","_possibleConstructorReturn","getPrototypeOf","_seekHandler","_needStash","_requestAbort","_contentLength","_receivedLength","fetch","ReadableStream","msedge","_get","_dataSource","_range","seekConfig","headers","Headers","configHeaders","append","params","method","mode","credentials","_status","LoaderStatus","kConnecting","res","kIdle","ok","status","lengthHeader","get","parseInt","_onContentLengthKnown","_pump","body","getReader","kError","RuntimeException","statusText","LoaderErrors","HTTP_STATUS_CODE_INVALID","EXCEPTION","reader","read","done","kComplete","cancel","kBuffering","from","_onDataArrival","_onComplete","EARLY_EOF","_speedSampler","_fetchStreamLoader","_xhrMozChunkedLoader","_xhrMsstreamLoader","_xhrRangeLoader","_websocketLoader","_rangeSeekHandler","_paramSeekHandler","IOController","_extraData","_stashInitialSize","_stashUsed","_stashSize","_bufferSize","_stashBuffer","_stashByteStart","_enableStash","_loaderClass","_isWebSocketURL","test","_refTotalLength","_totalLength","_fullRequestFlag","_currentRange","_speed","_speedNormalized","_speedSampler2","_speedNormalizeList","_isEarlyEofReconnecting","_paused","_resumeFrom","_onSeeked","_selectSeekHandler","_selectLoader","_createLoader","_rangeSeekHandler2","paramStart","paramEnd","_paramSeekHandler2","_websocketLoader2","_fetchStreamLoader2","_xhrMozChunkedLoader2","_xhrRangeLoader2","needStashBuffer","onContentLengthKnown","_onLoaderChunkArrival","_onLoaderComplete","_onLoaderError","to","reset","bytes","_internalSeek","dropUnconsumed","_flushStashBuffer","requestRange","expectedBytes","bufferNewSize","newBuffer","stashOldArray","stashNewArray","normalized","stashSizeKB","bufferSize","_expandBuffer","chunks","contentLength","receivedLength","addBytes","KBps","lastSecondKBps","_normalizeSpeed","_adjustStashSize","_stashArray2","_stashArray3","_consumed2","_dispatchChunks","_remainArray","_consumed3","_remain","remain","stashArray","_stashArray","_consumed","remainArray","UNRECOVERABLE_EARLY_EOF","nextFrom","CONNECTING_TIMEOUT","BaseLoader","typeName","NotImplementedException","ParamSeekHandler","_startName","_endName","baseUrl","needAnd","RangeSeekHandler","zeroStart","_zeroStart","SpeedSampler","_firstCheckpoint","_lastCheckpoint","_intervalBytes","_totalBytes","_lastSecondBytes","performance","now","_now","durationSeconds","currentKBps","WebSocketLoader","_ws","WebSocket","ws","binaryType","onopen","_onWebSocketOpen","onclose","_onWebSocketClose","_onWebSocketMessage","onerror","_onWebSocketError","close","MozChunkedLoader","_xhr","xhr","XMLHttpRequest","responseType","onreadystatechange","onprogress","onloadend","_onReadyStateChange","_onProgress","_onLoadEnd","_onXhrError","setRequestHeader","send","total","response","loaded","MSStreamLoader","_reader","_totalRange","_bufferLimit","_lastTimeBufferSize","_isReconnecting","MSStream","MSStreamReader","onload","_internalOpen","isSubrange","_msrOnProgress","_msrOnLoad","_msrOnError","_xhrOnReadyStateChange","_xhrOnError","getResponseHeader","msstream","readAsArrayBuffer","bigbuffer","_doReconnectIfNeeded","RangeLoader","_chunkSizeKBList","_currentChunkSizeKB","_currentSpeed","_currentSpeedNormalized","_zeroSpeedChunkCount","_waitForTotalLength","_totalLengthReceived","_currentRequestRange","_lastTimeLoaded","_openSubRange","chunkSize","_onLoad","openNextRange","delta","reportComplete","_transmuxer","_mseController","onvLoadedMetadata","_onvLoadedMetadata","onvSeeking","_onvSeeking","onvCanPlay","_onvCanPlay","onvStalled","_onvStalled","onvProgress","_onvProgress","_requestSetTime","_seekpointRecord","_statisticsReporter","_progressChecker","_hasStatisticsListener","_msectl","_mseSourceOpened","_hasPendingLoad","_receivedCanPlay","_statisticsInfo","chromeNeedIDRFix","chrome","major","build","_alwaysSeekKeyframe","msie","clearInterval","unload","setInterval","_mseController2","_onmseUpdateEnd","_onmseBufferFull","load","MEDIA_ERROR","MEDIA_MSE_ERROR","attachMediaElement","currentTime","_transmuxer2","appendMediaSegment","_suspendTransmuxer","NETWORK_ERROR","_fillStatisticsInfo","play","playerType","hasQualityInfo","decoded","dropped","getVideoPlaybackQuality","quality","totalVideoFrames","droppedVideoFrames","webkitDecodedFrameCount","webkitDroppedFrameCount","decodedFrames","droppedFrames","currentRangeStart","currentRangeEnd","_checkProgressAndResume","needResume","directSeek","_isTimepointBuffered","directSeekBegin","directSeekBeginTime","videoBeginTime","idr","recordTime","_checkAndApplyUnbufferedSeekpoint","stalled","media","seekPoint","_checkAndResumeStuckPlayback","volume","muted","preload","videoWidth","videoHeight","OTHER_ERROR","NETWORK_EXCEPTION","NETWORK_STATUS_CODE_INVALID","NETWORK_TIMEOUT","NETWORK_UNRECOVERABLE_EARLY_EOF","MEDIA_FORMAT_ERROR","MEDIA_FORMAT_UNSUPPORTED","MEDIA_CODEC_UNSUPPORTED","PlayerEvents","AAC","MP4","types","avc1","avcC","btrt","dinf","dref","esds","ftyp","hdlr","mdat","mdhd","mdia","mfhd","minf","moof","moov","mp4a","mvex","mvhd","sdtp","stbl","stco","stsc","stsd","stsz","stts","tfdt","tfhd","traf","trak","trun","trex","tkhd","vmhd","smhd","charCodeAt","constants","FTYP","STSD_PREFIX","STTS","STSC","STCO","STSZ","HDLR_VIDEO","HDLR_AUDIO","DREF","SMHD","VMHD","datas","arrayCount","box","trackId","xmhd","sampleRate","configSize","baseMediaDecodeTime","sampleCount","flags","isLeading","dependsOn","isDependedOn","hasRedundancy","isNonSync","init","_mp4Generator","_aacSilent","MP4Remuxer","_isLive","_dtsBase","_dtsBaseInited","_audioDtsBase","Infinity","_videoDtsBase","_audioNextDts","_videoNextDts","_audioMeta","_videoMeta","_audioSegmentInfoList","_videoSegmentInfoList","_forceFirstIDR","_fillSilentAfterSeek","producer","onDataAvailable","remux","onTrackMetadata","_onTrackMetadataReceived","audioTrack","videoTrack","_calculateDtsBase","_remuxVideo","_remuxAudio","metabox","_mp4Generator2","generateInitSegment","dtsCorrection","firstDts","lastDts","remuxSilentFrame","silentFrameDuration","mdatbox","mp4Samples","isEmpty","getLastSampleBefore","distance","expectedDts","videoSegment","frame","_generateSilentAudio","_mp4Sample","mp4Sample","_unit","sampleDuration","nextDts","latest","moofbox","_mergeBoxes","frameDuration","_aacSilent2","getSilentFrame","firstPts","lastPts","sampleSize","syncPoint","appendSyncPoint","detect","ua","exec","platform_match","matched","majorVersion","platform","versionArray","split","string","minor","opr","webkit","rv","iemobile","edge","opera","android","Browser","BSearch","compare","low","high","cmp","less","search","_message","Log","tag","ENABLE_ERROR","FORCE_GLOBAL_TAG","GLOBAL_TAG","warn","log","ENABLE_INFO","ENABLE_WARN","ENABLE_DEBUG","debug","ENABLE_VERBOSE","globalTag","forceGlobalTag","enableVerbose","enableDebug","enableInfo","enableWarn","enableError","enable","_notifyChange","Polyfill","proto","__proto__","output","source","checkContinuation","checkLength","decodeUTF8","out","String","fromCharCode","ucs4","_ucs","_ucs2"],"mappings":"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","file":"flv.min.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","/*!\n * @overview es6-promise - a tiny implementation of Promises/A+.\n * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)\n * @license   Licensed under MIT license\n *            See https://raw.githubusercontent.com/jakearchibald/es6-promise/master/LICENSE\n * @version   3.2.1\n */\n\n(function() {\n    \"use strict\";\n    function lib$es6$promise$utils$$objectOrFunction(x) {\n      return typeof x === 'function' || (typeof x === 'object' && x !== null);\n    }\n\n    function lib$es6$promise$utils$$isFunction(x) {\n      return typeof x === 'function';\n    }\n\n    function lib$es6$promise$utils$$isMaybeThenable(x) {\n      return typeof x === 'object' && x !== null;\n    }\n\n    var lib$es6$promise$utils$$_isArray;\n    if (!Array.isArray) {\n      lib$es6$promise$utils$$_isArray = function (x) {\n        return Object.prototype.toString.call(x) === '[object Array]';\n      };\n    } else {\n      lib$es6$promise$utils$$_isArray = Array.isArray;\n    }\n\n    var lib$es6$promise$utils$$isArray = lib$es6$promise$utils$$_isArray;\n    var lib$es6$promise$asap$$len = 0;\n    var lib$es6$promise$asap$$vertxNext;\n    var lib$es6$promise$asap$$customSchedulerFn;\n\n    var lib$es6$promise$asap$$asap = function asap(callback, arg) {\n      lib$es6$promise$asap$$queue[lib$es6$promise$asap$$len] = callback;\n      lib$es6$promise$asap$$queue[lib$es6$promise$asap$$len + 1] = arg;\n      lib$es6$promise$asap$$len += 2;\n      if (lib$es6$promise$asap$$len === 2) {\n        // If len is 2, that means that we need to schedule an async flush.\n        // If additional callbacks are queued before the queue is flushed, they\n        // will be processed by this flush that we are scheduling.\n        if (lib$es6$promise$asap$$customSchedulerFn) {\n          lib$es6$promise$asap$$customSchedulerFn(lib$es6$promise$asap$$flush);\n        } else {\n          lib$es6$promise$asap$$scheduleFlush();\n        }\n      }\n    }\n\n    function lib$es6$promise$asap$$setScheduler(scheduleFn) {\n      lib$es6$promise$asap$$customSchedulerFn = scheduleFn;\n    }\n\n    function lib$es6$promise$asap$$setAsap(asapFn) {\n      lib$es6$promise$asap$$asap = asapFn;\n    }\n\n    var lib$es6$promise$asap$$browserWindow = (typeof window !== 'undefined') ? window : undefined;\n    var lib$es6$promise$asap$$browserGlobal = lib$es6$promise$asap$$browserWindow || {};\n    var lib$es6$promise$asap$$BrowserMutationObserver = lib$es6$promise$asap$$browserGlobal.MutationObserver || lib$es6$promise$asap$$browserGlobal.WebKitMutationObserver;\n    var lib$es6$promise$asap$$isNode = typeof self === 'undefined' && typeof process !== 'undefined' && {}.toString.call(process) === '[object process]';\n\n    // test for web worker but not in IE10\n    var lib$es6$promise$asap$$isWorker = typeof Uint8ClampedArray !== 'undefined' &&\n      typeof importScripts !== 'undefined' &&\n      typeof MessageChannel !== 'undefined';\n\n    // node\n    function lib$es6$promise$asap$$useNextTick() {\n      // node version 0.10.x displays a deprecation warning when nextTick is used recursively\n      // see https://github.com/cujojs/when/issues/410 for details\n      return function() {\n        process.nextTick(lib$es6$promise$asap$$flush);\n      };\n    }\n\n    // vertx\n    function lib$es6$promise$asap$$useVertxTimer() {\n      return function() {\n        lib$es6$promise$asap$$vertxNext(lib$es6$promise$asap$$flush);\n      };\n    }\n\n    function lib$es6$promise$asap$$useMutationObserver() {\n      var iterations = 0;\n      var observer = new lib$es6$promise$asap$$BrowserMutationObserver(lib$es6$promise$asap$$flush);\n      var node = document.createTextNode('');\n      observer.observe(node, { characterData: true });\n\n      return function() {\n        node.data = (iterations = ++iterations % 2);\n      };\n    }\n\n    // web worker\n    function lib$es6$promise$asap$$useMessageChannel() {\n      var channel = new MessageChannel();\n      channel.port1.onmessage = lib$es6$promise$asap$$flush;\n      return function () {\n        channel.port2.postMessage(0);\n      };\n    }\n\n    function lib$es6$promise$asap$$useSetTimeout() {\n      return function() {\n        setTimeout(lib$es6$promise$asap$$flush, 1);\n      };\n    }\n\n    var lib$es6$promise$asap$$queue = new Array(1000);\n    function lib$es6$promise$asap$$flush() {\n      for (var i = 0; i < lib$es6$promise$asap$$len; i+=2) {\n        var callback = lib$es6$promise$asap$$queue[i];\n        var arg = lib$es6$promise$asap$$queue[i+1];\n\n        callback(arg);\n\n        lib$es6$promise$asap$$queue[i] = undefined;\n        lib$es6$promise$asap$$queue[i+1] = undefined;\n      }\n\n      lib$es6$promise$asap$$len = 0;\n    }\n\n    function lib$es6$promise$asap$$attemptVertx() {\n      try {\n        var r = require;\n        var vertx = r('vertx');\n        lib$es6$promise$asap$$vertxNext = vertx.runOnLoop || vertx.runOnContext;\n        return lib$es6$promise$asap$$useVertxTimer();\n      } catch(e) {\n        return lib$es6$promise$asap$$useSetTimeout();\n      }\n    }\n\n    var lib$es6$promise$asap$$scheduleFlush;\n    // Decide what async method to use to triggering processing of queued callbacks:\n    if (lib$es6$promise$asap$$isNode) {\n      lib$es6$promise$asap$$scheduleFlush = lib$es6$promise$asap$$useNextTick();\n    } else if (lib$es6$promise$asap$$BrowserMutationObserver) {\n      lib$es6$promise$asap$$scheduleFlush = lib$es6$promise$asap$$useMutationObserver();\n    } else if (lib$es6$promise$asap$$isWorker) {\n      lib$es6$promise$asap$$scheduleFlush = lib$es6$promise$asap$$useMessageChannel();\n    } else if (lib$es6$promise$asap$$browserWindow === undefined && typeof require === 'function') {\n      lib$es6$promise$asap$$scheduleFlush = lib$es6$promise$asap$$attemptVertx();\n    } else {\n      lib$es6$promise$asap$$scheduleFlush = lib$es6$promise$asap$$useSetTimeout();\n    }\n    function lib$es6$promise$then$$then(onFulfillment, onRejection) {\n      var parent = this;\n\n      var child = new this.constructor(lib$es6$promise$$internal$$noop);\n\n      if (child[lib$es6$promise$$internal$$PROMISE_ID] === undefined) {\n        lib$es6$promise$$internal$$makePromise(child);\n      }\n\n      var state = parent._state;\n\n      if (state) {\n        var callback = arguments[state - 1];\n        lib$es6$promise$asap$$asap(function(){\n          lib$es6$promise$$internal$$invokeCallback(state, child, callback, parent._result);\n        });\n      } else {\n        lib$es6$promise$$internal$$subscribe(parent, child, onFulfillment, onRejection);\n      }\n\n      return child;\n    }\n    var lib$es6$promise$then$$default = lib$es6$promise$then$$then;\n    function lib$es6$promise$promise$resolve$$resolve(object) {\n      /*jshint validthis:true */\n      var Constructor = this;\n\n      if (object && typeof object === 'object' && object.constructor === Constructor) {\n        return object;\n      }\n\n      var promise = new Constructor(lib$es6$promise$$internal$$noop);\n      lib$es6$promise$$internal$$resolve(promise, object);\n      return promise;\n    }\n    var lib$es6$promise$promise$resolve$$default = lib$es6$promise$promise$resolve$$resolve;\n    var lib$es6$promise$$internal$$PROMISE_ID = Math.random().toString(36).substring(16);\n\n    function lib$es6$promise$$internal$$noop() {}\n\n    var lib$es6$promise$$internal$$PENDING   = void 0;\n    var lib$es6$promise$$internal$$FULFILLED = 1;\n    var lib$es6$promise$$internal$$REJECTED  = 2;\n\n    var lib$es6$promise$$internal$$GET_THEN_ERROR = new lib$es6$promise$$internal$$ErrorObject();\n\n    function lib$es6$promise$$internal$$selfFulfillment() {\n      return new TypeError(\"You cannot resolve a promise with itself\");\n    }\n\n    function lib$es6$promise$$internal$$cannotReturnOwn() {\n      return new TypeError('A promises callback cannot return that same promise.');\n    }\n\n    function lib$es6$promise$$internal$$getThen(promise) {\n      try {\n        return promise.then;\n      } catch(error) {\n        lib$es6$promise$$internal$$GET_THEN_ERROR.error = error;\n        return lib$es6$promise$$internal$$GET_THEN_ERROR;\n      }\n    }\n\n    function lib$es6$promise$$internal$$tryThen(then, value, fulfillmentHandler, rejectionHandler) {\n      try {\n        then.call(value, fulfillmentHandler, rejectionHandler);\n      } catch(e) {\n        return e;\n      }\n    }\n\n    function lib$es6$promise$$internal$$handleForeignThenable(promise, thenable, then) {\n       lib$es6$promise$asap$$asap(function(promise) {\n        var sealed = false;\n        var error = lib$es6$promise$$internal$$tryThen(then, thenable, function(value) {\n          if (sealed) { return; }\n          sealed = true;\n          if (thenable !== value) {\n            lib$es6$promise$$internal$$resolve(promise, value);\n          } else {\n            lib$es6$promise$$internal$$fulfill(promise, value);\n          }\n        }, function(reason) {\n          if (sealed) { return; }\n          sealed = true;\n\n          lib$es6$promise$$internal$$reject(promise, reason);\n        }, 'Settle: ' + (promise._label || ' unknown promise'));\n\n        if (!sealed && error) {\n          sealed = true;\n          lib$es6$promise$$internal$$reject(promise, error);\n        }\n      }, promise);\n    }\n\n    function lib$es6$promise$$internal$$handleOwnThenable(promise, thenable) {\n      if (thenable._state === lib$es6$promise$$internal$$FULFILLED) {\n        lib$es6$promise$$internal$$fulfill(promise, thenable._result);\n      } else if (thenable._state === lib$es6$promise$$internal$$REJECTED) {\n        lib$es6$promise$$internal$$reject(promise, thenable._result);\n      } else {\n        lib$es6$promise$$internal$$subscribe(thenable, undefined, function(value) {\n          lib$es6$promise$$internal$$resolve(promise, value);\n        }, function(reason) {\n          lib$es6$promise$$internal$$reject(promise, reason);\n        });\n      }\n    }\n\n    function lib$es6$promise$$internal$$handleMaybeThenable(promise, maybeThenable, then) {\n      if (maybeThenable.constructor === promise.constructor &&\n          then === lib$es6$promise$then$$default &&\n          constructor.resolve === lib$es6$promise$promise$resolve$$default) {\n        lib$es6$promise$$internal$$handleOwnThenable(promise, maybeThenable);\n      } else {\n        if (then === lib$es6$promise$$internal$$GET_THEN_ERROR) {\n          lib$es6$promise$$internal$$reject(promise, lib$es6$promise$$internal$$GET_THEN_ERROR.error);\n        } else if (then === undefined) {\n          lib$es6$promise$$internal$$fulfill(promise, maybeThenable);\n        } else if (lib$es6$promise$utils$$isFunction(then)) {\n          lib$es6$promise$$internal$$handleForeignThenable(promise, maybeThenable, then);\n        } else {\n          lib$es6$promise$$internal$$fulfill(promise, maybeThenable);\n        }\n      }\n    }\n\n    function lib$es6$promise$$internal$$resolve(promise, value) {\n      if (promise === value) {\n        lib$es6$promise$$internal$$reject(promise, lib$es6$promise$$internal$$selfFulfillment());\n      } else if (lib$es6$promise$utils$$objectOrFunction(value)) {\n        lib$es6$promise$$internal$$handleMaybeThenable(promise, value, lib$es6$promise$$internal$$getThen(value));\n      } else {\n        lib$es6$promise$$internal$$fulfill(promise, value);\n      }\n    }\n\n    function lib$es6$promise$$internal$$publishRejection(promise) {\n      if (promise._onerror) {\n        promise._onerror(promise._result);\n      }\n\n      lib$es6$promise$$internal$$publish(promise);\n    }\n\n    function lib$es6$promise$$internal$$fulfill(promise, value) {\n      if (promise._state !== lib$es6$promise$$internal$$PENDING) { return; }\n\n      promise._result = value;\n      promise._state = lib$es6$promise$$internal$$FULFILLED;\n\n      if (promise._subscribers.length !== 0) {\n        lib$es6$promise$asap$$asap(lib$es6$promise$$internal$$publish, promise);\n      }\n    }\n\n    function lib$es6$promise$$internal$$reject(promise, reason) {\n      if (promise._state !== lib$es6$promise$$internal$$PENDING) { return; }\n      promise._state = lib$es6$promise$$internal$$REJECTED;\n      promise._result = reason;\n\n      lib$es6$promise$asap$$asap(lib$es6$promise$$internal$$publishRejection, promise);\n    }\n\n    function lib$es6$promise$$internal$$subscribe(parent, child, onFulfillment, onRejection) {\n      var subscribers = parent._subscribers;\n      var length = subscribers.length;\n\n      parent._onerror = null;\n\n      subscribers[length] = child;\n      subscribers[length + lib$es6$promise$$internal$$FULFILLED] = onFulfillment;\n      subscribers[length + lib$es6$promise$$internal$$REJECTED]  = onRejection;\n\n      if (length === 0 && parent._state) {\n        lib$es6$promise$asap$$asap(lib$es6$promise$$internal$$publish, parent);\n      }\n    }\n\n    function lib$es6$promise$$internal$$publish(promise) {\n      var subscribers = promise._subscribers;\n      var settled = promise._state;\n\n      if (subscribers.length === 0) { return; }\n\n      var child, callback, detail = promise._result;\n\n      for (var i = 0; i < subscribers.length; i += 3) {\n        child = subscribers[i];\n        callback = subscribers[i + settled];\n\n        if (child) {\n          lib$es6$promise$$internal$$invokeCallback(settled, child, callback, detail);\n        } else {\n          callback(detail);\n        }\n      }\n\n      promise._subscribers.length = 0;\n    }\n\n    function lib$es6$promise$$internal$$ErrorObject() {\n      this.error = null;\n    }\n\n    var lib$es6$promise$$internal$$TRY_CATCH_ERROR = new lib$es6$promise$$internal$$ErrorObject();\n\n    function lib$es6$promise$$internal$$tryCatch(callback, detail) {\n      try {\n        return callback(detail);\n      } catch(e) {\n        lib$es6$promise$$internal$$TRY_CATCH_ERROR.error = e;\n        return lib$es6$promise$$internal$$TRY_CATCH_ERROR;\n      }\n    }\n\n    function lib$es6$promise$$internal$$invokeCallback(settled, promise, callback, detail) {\n      var hasCallback = lib$es6$promise$utils$$isFunction(callback),\n          value, error, succeeded, failed;\n\n      if (hasCallback) {\n        value = lib$es6$promise$$internal$$tryCatch(callback, detail);\n\n        if (value === lib$es6$promise$$internal$$TRY_CATCH_ERROR) {\n          failed = true;\n          error = value.error;\n          value = null;\n        } else {\n          succeeded = true;\n        }\n\n        if (promise === value) {\n          lib$es6$promise$$internal$$reject(promise, lib$es6$promise$$internal$$cannotReturnOwn());\n          return;\n        }\n\n      } else {\n        value = detail;\n        succeeded = true;\n      }\n\n      if (promise._state !== lib$es6$promise$$internal$$PENDING) {\n        // noop\n      } else if (hasCallback && succeeded) {\n        lib$es6$promise$$internal$$resolve(promise, value);\n      } else if (failed) {\n        lib$es6$promise$$internal$$reject(promise, error);\n      } else if (settled === lib$es6$promise$$internal$$FULFILLED) {\n        lib$es6$promise$$internal$$fulfill(promise, value);\n      } else if (settled === lib$es6$promise$$internal$$REJECTED) {\n        lib$es6$promise$$internal$$reject(promise, value);\n      }\n    }\n\n    function lib$es6$promise$$internal$$initializePromise(promise, resolver) {\n      try {\n        resolver(function resolvePromise(value){\n          lib$es6$promise$$internal$$resolve(promise, value);\n        }, function rejectPromise(reason) {\n          lib$es6$promise$$internal$$reject(promise, reason);\n        });\n      } catch(e) {\n        lib$es6$promise$$internal$$reject(promise, e);\n      }\n    }\n\n    var lib$es6$promise$$internal$$id = 0;\n    function lib$es6$promise$$internal$$nextId() {\n      return lib$es6$promise$$internal$$id++;\n    }\n\n    function lib$es6$promise$$internal$$makePromise(promise) {\n      promise[lib$es6$promise$$internal$$PROMISE_ID] = lib$es6$promise$$internal$$id++;\n      promise._state = undefined;\n      promise._result = undefined;\n      promise._subscribers = [];\n    }\n\n    function lib$es6$promise$promise$all$$all(entries) {\n      return new lib$es6$promise$enumerator$$default(this, entries).promise;\n    }\n    var lib$es6$promise$promise$all$$default = lib$es6$promise$promise$all$$all;\n    function lib$es6$promise$promise$race$$race(entries) {\n      /*jshint validthis:true */\n      var Constructor = this;\n\n      if (!lib$es6$promise$utils$$isArray(entries)) {\n        return new Constructor(function(resolve, reject) {\n          reject(new TypeError('You must pass an array to race.'));\n        });\n      } else {\n        return new Constructor(function(resolve, reject) {\n          var length = entries.length;\n          for (var i = 0; i < length; i++) {\n            Constructor.resolve(entries[i]).then(resolve, reject);\n          }\n        });\n      }\n    }\n    var lib$es6$promise$promise$race$$default = lib$es6$promise$promise$race$$race;\n    function lib$es6$promise$promise$reject$$reject(reason) {\n      /*jshint validthis:true */\n      var Constructor = this;\n      var promise = new Constructor(lib$es6$promise$$internal$$noop);\n      lib$es6$promise$$internal$$reject(promise, reason);\n      return promise;\n    }\n    var lib$es6$promise$promise$reject$$default = lib$es6$promise$promise$reject$$reject;\n\n\n    function lib$es6$promise$promise$$needsResolver() {\n      throw new TypeError('You must pass a resolver function as the first argument to the promise constructor');\n    }\n\n    function lib$es6$promise$promise$$needsNew() {\n      throw new TypeError(\"Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.\");\n    }\n\n    var lib$es6$promise$promise$$default = lib$es6$promise$promise$$Promise;\n    /**\n      Promise objects represent the eventual result of an asynchronous operation. The\n      primary way of interacting with a promise is through its `then` method, which\n      registers callbacks to receive either a promise's eventual value or the reason\n      why the promise cannot be fulfilled.\n\n      Terminology\n      -----------\n\n      - `promise` is an object or function with a `then` method whose behavior conforms to this specification.\n      - `thenable` is an object or function that defines a `then` method.\n      - `value` is any legal JavaScript value (including undefined, a thenable, or a promise).\n      - `exception` is a value that is thrown using the throw statement.\n      - `reason` is a value that indicates why a promise was rejected.\n      - `settled` the final resting state of a promise, fulfilled or rejected.\n\n      A promise can be in one of three states: pending, fulfilled, or rejected.\n\n      Promises that are fulfilled have a fulfillment value and are in the fulfilled\n      state.  Promises that are rejected have a rejection reason and are in the\n      rejected state.  A fulfillment value is never a thenable.\n\n      Promises can also be said to *resolve* a value.  If this value is also a\n      promise, then the original promise's settled state will match the value's\n      settled state.  So a promise that *resolves* a promise that rejects will\n      itself reject, and a promise that *resolves* a promise that fulfills will\n      itself fulfill.\n\n\n      Basic Usage:\n      ------------\n\n      ```js\n      var promise = new Promise(function(resolve, reject) {\n        // on success\n        resolve(value);\n\n        // on failure\n        reject(reason);\n      });\n\n      promise.then(function(value) {\n        // on fulfillment\n      }, function(reason) {\n        // on rejection\n      });\n      ```\n\n      Advanced Usage:\n      ---------------\n\n      Promises shine when abstracting away asynchronous interactions such as\n      `XMLHttpRequest`s.\n\n      ```js\n      function getJSON(url) {\n        return new Promise(function(resolve, reject){\n          var xhr = new XMLHttpRequest();\n\n          xhr.open('GET', url);\n          xhr.onreadystatechange = handler;\n          xhr.responseType = 'json';\n          xhr.setRequestHeader('Accept', 'application/json');\n          xhr.send();\n\n          function handler() {\n            if (this.readyState === this.DONE) {\n              if (this.status === 200) {\n                resolve(this.response);\n              } else {\n                reject(new Error('getJSON: `' + url + '` failed with status: [' + this.status + ']'));\n              }\n            }\n          };\n        });\n      }\n\n      getJSON('/posts.json').then(function(json) {\n        // on fulfillment\n      }, function(reason) {\n        // on rejection\n      });\n      ```\n\n      Unlike callbacks, promises are great composable primitives.\n\n      ```js\n      Promise.all([\n        getJSON('/posts'),\n        getJSON('/comments')\n      ]).then(function(values){\n        values[0] // => postsJSON\n        values[1] // => commentsJSON\n\n        return values;\n      });\n      ```\n\n      @class Promise\n      @param {function} resolver\n      Useful for tooling.\n      @constructor\n    */\n    function lib$es6$promise$promise$$Promise(resolver) {\n      this[lib$es6$promise$$internal$$PROMISE_ID] = lib$es6$promise$$internal$$nextId();\n      this._result = this._state = undefined;\n      this._subscribers = [];\n\n      if (lib$es6$promise$$internal$$noop !== resolver) {\n        typeof resolver !== 'function' && lib$es6$promise$promise$$needsResolver();\n        this instanceof lib$es6$promise$promise$$Promise ? lib$es6$promise$$internal$$initializePromise(this, resolver) : lib$es6$promise$promise$$needsNew();\n      }\n    }\n\n    lib$es6$promise$promise$$Promise.all = lib$es6$promise$promise$all$$default;\n    lib$es6$promise$promise$$Promise.race = lib$es6$promise$promise$race$$default;\n    lib$es6$promise$promise$$Promise.resolve = lib$es6$promise$promise$resolve$$default;\n    lib$es6$promise$promise$$Promise.reject = lib$es6$promise$promise$reject$$default;\n    lib$es6$promise$promise$$Promise._setScheduler = lib$es6$promise$asap$$setScheduler;\n    lib$es6$promise$promise$$Promise._setAsap = lib$es6$promise$asap$$setAsap;\n    lib$es6$promise$promise$$Promise._asap = lib$es6$promise$asap$$asap;\n\n    lib$es6$promise$promise$$Promise.prototype = {\n      constructor: lib$es6$promise$promise$$Promise,\n\n    /**\n      The primary way of interacting with a promise is through its `then` method,\n      which registers callbacks to receive either a promise's eventual value or the\n      reason why the promise cannot be fulfilled.\n\n      ```js\n      findUser().then(function(user){\n        // user is available\n      }, function(reason){\n        // user is unavailable, and you are given the reason why\n      });\n      ```\n\n      Chaining\n      --------\n\n      The return value of `then` is itself a promise.  This second, 'downstream'\n      promise is resolved with the return value of the first promise's fulfillment\n      or rejection handler, or rejected if the handler throws an exception.\n\n      ```js\n      findUser().then(function (user) {\n        return user.name;\n      }, function (reason) {\n        return 'default name';\n      }).then(function (userName) {\n        // If `findUser` fulfilled, `userName` will be the user's name, otherwise it\n        // will be `'default name'`\n      });\n\n      findUser().then(function (user) {\n        throw new Error('Found user, but still unhappy');\n      }, function (reason) {\n        throw new Error('`findUser` rejected and we're unhappy');\n      }).then(function (value) {\n        // never reached\n      }, function (reason) {\n        // if `findUser` fulfilled, `reason` will be 'Found user, but still unhappy'.\n        // If `findUser` rejected, `reason` will be '`findUser` rejected and we're unhappy'.\n      });\n      ```\n      If the downstream promise does not specify a rejection handler, rejection reasons will be propagated further downstream.\n\n      ```js\n      findUser().then(function (user) {\n        throw new PedagogicalException('Upstream error');\n      }).then(function (value) {\n        // never reached\n      }).then(function (value) {\n        // never reached\n      }, function (reason) {\n        // The `PedgagocialException` is propagated all the way down to here\n      });\n      ```\n\n      Assimilation\n      ------------\n\n      Sometimes the value you want to propagate to a downstream promise can only be\n      retrieved asynchronously. This can be achieved by returning a promise in the\n      fulfillment or rejection handler. The downstream promise will then be pending\n      until the returned promise is settled. This is called *assimilation*.\n\n      ```js\n      findUser().then(function (user) {\n        return findCommentsByAuthor(user);\n      }).then(function (comments) {\n        // The user's comments are now available\n      });\n      ```\n\n      If the assimliated promise rejects, then the downstream promise will also reject.\n\n      ```js\n      findUser().then(function (user) {\n        return findCommentsByAuthor(user);\n      }).then(function (comments) {\n        // If `findCommentsByAuthor` fulfills, we'll have the value here\n      }, function (reason) {\n        // If `findCommentsByAuthor` rejects, we'll have the reason here\n      });\n      ```\n\n      Simple Example\n      --------------\n\n      Synchronous Example\n\n      ```javascript\n      var result;\n\n      try {\n        result = findResult();\n        // success\n      } catch(reason) {\n        // failure\n      }\n      ```\n\n      Errback Example\n\n      ```js\n      findResult(function(result, err){\n        if (err) {\n          // failure\n        } else {\n          // success\n        }\n      });\n      ```\n\n      Promise Example;\n\n      ```javascript\n      findResult().then(function(result){\n        // success\n      }, function(reason){\n        // failure\n      });\n      ```\n\n      Advanced Example\n      --------------\n\n      Synchronous Example\n\n      ```javascript\n      var author, books;\n\n      try {\n        author = findAuthor();\n        books  = findBooksByAuthor(author);\n        // success\n      } catch(reason) {\n        // failure\n      }\n      ```\n\n      Errback Example\n\n      ```js\n\n      function foundBooks(books) {\n\n      }\n\n      function failure(reason) {\n\n      }\n\n      findAuthor(function(author, err){\n        if (err) {\n          failure(err);\n          // failure\n        } else {\n          try {\n            findBoooksByAuthor(author, function(books, err) {\n              if (err) {\n                failure(err);\n              } else {\n                try {\n                  foundBooks(books);\n                } catch(reason) {\n                  failure(reason);\n                }\n              }\n            });\n          } catch(error) {\n            failure(err);\n          }\n          // success\n        }\n      });\n      ```\n\n      Promise Example;\n\n      ```javascript\n      findAuthor().\n        then(findBooksByAuthor).\n        then(function(books){\n          // found books\n      }).catch(function(reason){\n        // something went wrong\n      });\n      ```\n\n      @method then\n      @param {Function} onFulfilled\n      @param {Function} onRejected\n      Useful for tooling.\n      @return {Promise}\n    */\n      then: lib$es6$promise$then$$default,\n\n    /**\n      `catch` is simply sugar for `then(undefined, onRejection)` which makes it the same\n      as the catch block of a try/catch statement.\n\n      ```js\n      function findAuthor(){\n        throw new Error('couldn't find that author');\n      }\n\n      // synchronous\n      try {\n        findAuthor();\n      } catch(reason) {\n        // something went wrong\n      }\n\n      // async with promises\n      findAuthor().catch(function(reason){\n        // something went wrong\n      });\n      ```\n\n      @method catch\n      @param {Function} onRejection\n      Useful for tooling.\n      @return {Promise}\n    */\n      'catch': function(onRejection) {\n        return this.then(null, onRejection);\n      }\n    };\n    var lib$es6$promise$enumerator$$default = lib$es6$promise$enumerator$$Enumerator;\n    function lib$es6$promise$enumerator$$Enumerator(Constructor, input) {\n      this._instanceConstructor = Constructor;\n      this.promise = new Constructor(lib$es6$promise$$internal$$noop);\n\n      if (!this.promise[lib$es6$promise$$internal$$PROMISE_ID]) {\n        lib$es6$promise$$internal$$makePromise(this.promise);\n      }\n\n      if (lib$es6$promise$utils$$isArray(input)) {\n        this._input     = input;\n        this.length     = input.length;\n        this._remaining = input.length;\n\n        this._result = new Array(this.length);\n\n        if (this.length === 0) {\n          lib$es6$promise$$internal$$fulfill(this.promise, this._result);\n        } else {\n          this.length = this.length || 0;\n          this._enumerate();\n          if (this._remaining === 0) {\n            lib$es6$promise$$internal$$fulfill(this.promise, this._result);\n          }\n        }\n      } else {\n        lib$es6$promise$$internal$$reject(this.promise, lib$es6$promise$enumerator$$validationError());\n      }\n    }\n\n    function lib$es6$promise$enumerator$$validationError() {\n      return new Error('Array Methods must be provided an Array');\n    }\n\n    lib$es6$promise$enumerator$$Enumerator.prototype._enumerate = function() {\n      var length  = this.length;\n      var input   = this._input;\n\n      for (var i = 0; this._state === lib$es6$promise$$internal$$PENDING && i < length; i++) {\n        this._eachEntry(input[i], i);\n      }\n    };\n\n    lib$es6$promise$enumerator$$Enumerator.prototype._eachEntry = function(entry, i) {\n      var c = this._instanceConstructor;\n      var resolve = c.resolve;\n\n      if (resolve === lib$es6$promise$promise$resolve$$default) {\n        var then = lib$es6$promise$$internal$$getThen(entry);\n\n        if (then === lib$es6$promise$then$$default &&\n            entry._state !== lib$es6$promise$$internal$$PENDING) {\n          this._settledAt(entry._state, i, entry._result);\n        } else if (typeof then !== 'function') {\n          this._remaining--;\n          this._result[i] = entry;\n        } else if (c === lib$es6$promise$promise$$default) {\n          var promise = new c(lib$es6$promise$$internal$$noop);\n          lib$es6$promise$$internal$$handleMaybeThenable(promise, entry, then);\n          this._willSettleAt(promise, i);\n        } else {\n          this._willSettleAt(new c(function(resolve) { resolve(entry); }), i);\n        }\n      } else {\n        this._willSettleAt(resolve(entry), i);\n      }\n    };\n\n    lib$es6$promise$enumerator$$Enumerator.prototype._settledAt = function(state, i, value) {\n      var promise = this.promise;\n\n      if (promise._state === lib$es6$promise$$internal$$PENDING) {\n        this._remaining--;\n\n        if (state === lib$es6$promise$$internal$$REJECTED) {\n          lib$es6$promise$$internal$$reject(promise, value);\n        } else {\n          this._result[i] = value;\n        }\n      }\n\n      if (this._remaining === 0) {\n        lib$es6$promise$$internal$$fulfill(promise, this._result);\n      }\n    };\n\n    lib$es6$promise$enumerator$$Enumerator.prototype._willSettleAt = function(promise, i) {\n      var enumerator = this;\n\n      lib$es6$promise$$internal$$subscribe(promise, undefined, function(value) {\n        enumerator._settledAt(lib$es6$promise$$internal$$FULFILLED, i, value);\n      }, function(reason) {\n        enumerator._settledAt(lib$es6$promise$$internal$$REJECTED, i, reason);\n      });\n    };\n    function lib$es6$promise$polyfill$$polyfill() {\n      var local;\n\n      if (typeof global !== 'undefined') {\n          local = global;\n      } else if (typeof self !== 'undefined') {\n          local = self;\n      } else {\n          try {\n              local = Function('return this')();\n          } catch (e) {\n              throw new Error('polyfill failed because global object is unavailable in this environment');\n          }\n      }\n\n      var P = local.Promise;\n\n      if (P && Object.prototype.toString.call(P.resolve()) === '[object Promise]' && !P.cast) {\n        return;\n      }\n\n      local.Promise = lib$es6$promise$promise$$default;\n    }\n    var lib$es6$promise$polyfill$$default = lib$es6$promise$polyfill$$polyfill;\n\n    var lib$es6$promise$umd$$ES6Promise = {\n      'Promise': lib$es6$promise$promise$$default,\n      'polyfill': lib$es6$promise$polyfill$$default\n    };\n\n    /* global define:true module:true window: true */\n    if (typeof define === 'function' && define['amd']) {\n      define(function() { return lib$es6$promise$umd$$ES6Promise; });\n    } else if (typeof module !== 'undefined' && module['exports']) {\n      module['exports'] = lib$es6$promise$umd$$ES6Promise;\n    } else if (typeof this !== 'undefined') {\n      this['ES6Promise'] = lib$es6$promise$umd$$ES6Promise;\n    }\n\n    lib$es6$promise$polyfill$$default();\n}).call(this);\n\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\nfunction EventEmitter() {\n  this._events = this._events || {};\n  this._maxListeners = this._maxListeners || undefined;\n}\nmodule.exports = EventEmitter;\n\n// Backwards-compat with node 0.10.x\nEventEmitter.EventEmitter = EventEmitter;\n\nEventEmitter.prototype._events = undefined;\nEventEmitter.prototype._maxListeners = undefined;\n\n// By default EventEmitters will print a warning if more than 10 listeners are\n// added to it. This is a useful default which helps finding memory leaks.\nEventEmitter.defaultMaxListeners = 10;\n\n// Obviously not all Emitters should be limited to 10. This function allows\n// that to be increased. Set to zero for unlimited.\nEventEmitter.prototype.setMaxListeners = function(n) {\n  if (!isNumber(n) || n < 0 || isNaN(n))\n    throw TypeError('n must be a positive number');\n  this._maxListeners = n;\n  return this;\n};\n\nEventEmitter.prototype.emit = function(type) {\n  var er, handler, len, args, i, listeners;\n\n  if (!this._events)\n    this._events = {};\n\n  // If there is no 'error' event listener then throw.\n  if (type === 'error') {\n    if (!this._events.error ||\n        (isObject(this._events.error) && !this._events.error.length)) {\n      er = arguments[1];\n      if (er instanceof Error) {\n        throw er; // Unhandled 'error' event\n      } else {\n        // At least give some kind of context to the user\n        var err = new Error('Uncaught, unspecified \"error\" event. (' + er + ')');\n        err.context = er;\n        throw err;\n      }\n    }\n  }\n\n  handler = this._events[type];\n\n  if (isUndefined(handler))\n    return false;\n\n  if (isFunction(handler)) {\n    switch (arguments.length) {\n      // fast cases\n      case 1:\n        handler.call(this);\n        break;\n      case 2:\n        handler.call(this, arguments[1]);\n        break;\n      case 3:\n        handler.call(this, arguments[1], arguments[2]);\n        break;\n      // slower\n      default:\n        args = Array.prototype.slice.call(arguments, 1);\n        handler.apply(this, args);\n    }\n  } else if (isObject(handler)) {\n    args = Array.prototype.slice.call(arguments, 1);\n    listeners = handler.slice();\n    len = listeners.length;\n    for (i = 0; i < len; i++)\n      listeners[i].apply(this, args);\n  }\n\n  return true;\n};\n\nEventEmitter.prototype.addListener = function(type, listener) {\n  var m;\n\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  if (!this._events)\n    this._events = {};\n\n  // To avoid recursion in the case that type === \"newListener\"! Before\n  // adding it to the listeners, first emit \"newListener\".\n  if (this._events.newListener)\n    this.emit('newListener', type,\n              isFunction(listener.listener) ?\n              listener.listener : listener);\n\n  if (!this._events[type])\n    // Optimize the case of one listener. Don't need the extra array object.\n    this._events[type] = listener;\n  else if (isObject(this._events[type]))\n    // If we've already got an array, just append.\n    this._events[type].push(listener);\n  else\n    // Adding the second element, need to change to array.\n    this._events[type] = [this._events[type], listener];\n\n  // Check for listener leak\n  if (isObject(this._events[type]) && !this._events[type].warned) {\n    if (!isUndefined(this._maxListeners)) {\n      m = this._maxListeners;\n    } else {\n      m = EventEmitter.defaultMaxListeners;\n    }\n\n    if (m && m > 0 && this._events[type].length > m) {\n      this._events[type].warned = true;\n      console.error('(node) warning: possible EventEmitter memory ' +\n                    'leak detected. %d listeners added. ' +\n                    'Use emitter.setMaxListeners() to increase limit.',\n                    this._events[type].length);\n      if (typeof console.trace === 'function') {\n        // not supported in IE 10\n        console.trace();\n      }\n    }\n  }\n\n  return this;\n};\n\nEventEmitter.prototype.on = EventEmitter.prototype.addListener;\n\nEventEmitter.prototype.once = function(type, listener) {\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  var fired = false;\n\n  function g() {\n    this.removeListener(type, g);\n\n    if (!fired) {\n      fired = true;\n      listener.apply(this, arguments);\n    }\n  }\n\n  g.listener = listener;\n  this.on(type, g);\n\n  return this;\n};\n\n// emits a 'removeListener' event iff the listener was removed\nEventEmitter.prototype.removeListener = function(type, listener) {\n  var list, position, length, i;\n\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  if (!this._events || !this._events[type])\n    return this;\n\n  list = this._events[type];\n  length = list.length;\n  position = -1;\n\n  if (list === listener ||\n      (isFunction(list.listener) && list.listener === listener)) {\n    delete this._events[type];\n    if (this._events.removeListener)\n      this.emit('removeListener', type, listener);\n\n  } else if (isObject(list)) {\n    for (i = length; i-- > 0;) {\n      if (list[i] === listener ||\n          (list[i].listener && list[i].listener === listener)) {\n        position = i;\n        break;\n      }\n    }\n\n    if (position < 0)\n      return this;\n\n    if (list.length === 1) {\n      list.length = 0;\n      delete this._events[type];\n    } else {\n      list.splice(position, 1);\n    }\n\n    if (this._events.removeListener)\n      this.emit('removeListener', type, listener);\n  }\n\n  return this;\n};\n\nEventEmitter.prototype.removeAllListeners = function(type) {\n  var key, listeners;\n\n  if (!this._events)\n    return this;\n\n  // not listening for removeListener, no need to emit\n  if (!this._events.removeListener) {\n    if (arguments.length === 0)\n      this._events = {};\n    else if (this._events[type])\n      delete this._events[type];\n    return this;\n  }\n\n  // emit removeListener for all listeners on all events\n  if (arguments.length === 0) {\n    for (key in this._events) {\n      if (key === 'removeListener') continue;\n      this.removeAllListeners(key);\n    }\n    this.removeAllListeners('removeListener');\n    this._events = {};\n    return this;\n  }\n\n  listeners = this._events[type];\n\n  if (isFunction(listeners)) {\n    this.removeListener(type, listeners);\n  } else if (listeners) {\n    // LIFO order\n    while (listeners.length)\n      this.removeListener(type, listeners[listeners.length - 1]);\n  }\n  delete this._events[type];\n\n  return this;\n};\n\nEventEmitter.prototype.listeners = function(type) {\n  var ret;\n  if (!this._events || !this._events[type])\n    ret = [];\n  else if (isFunction(this._events[type]))\n    ret = [this._events[type]];\n  else\n    ret = this._events[type].slice();\n  return ret;\n};\n\nEventEmitter.prototype.listenerCount = function(type) {\n  if (this._events) {\n    var evlistener = this._events[type];\n\n    if (isFunction(evlistener))\n      return 1;\n    else if (evlistener)\n      return evlistener.length;\n  }\n  return 0;\n};\n\nEventEmitter.listenerCount = function(emitter, type) {\n  return emitter.listenerCount(type);\n};\n\nfunction isFunction(arg) {\n  return typeof arg === 'function';\n}\n\nfunction isNumber(arg) {\n  return typeof arg === 'number';\n}\n\nfunction isObject(arg) {\n  return typeof arg === 'object' && arg !== null;\n}\n\nfunction isUndefined(arg) {\n  return arg === void 0;\n}\n","// shim for using process in browser\nvar process = module.exports = {};\n\n// cached from whatever global is present so that test runners that stub it\n// don't break things.  But we need to wrap it in a try catch in case it is\n// wrapped in strict mode code which doesn't define any globals.  It's inside a\n// function because try/catches deoptimize in certain engines.\n\nvar cachedSetTimeout;\nvar cachedClearTimeout;\n\n(function () {\n    try {\n        cachedSetTimeout = setTimeout;\n    } catch (e) {\n        cachedSetTimeout = function () {\n            throw new Error('setTimeout is not defined');\n        }\n    }\n    try {\n        cachedClearTimeout = clearTimeout;\n    } catch (e) {\n        cachedClearTimeout = function () {\n            throw new Error('clearTimeout is not defined');\n        }\n    }\n} ())\nfunction runTimeout(fun) {\n    if (cachedSetTimeout === setTimeout) {\n        //normal enviroments in sane situations\n        return setTimeout(fun, 0);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedSetTimeout(fun, 0);\n    } catch(e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't trust the global object when called normally\n            return cachedSetTimeout.call(null, fun, 0);\n        } catch(e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error\n            return cachedSetTimeout.call(this, fun, 0);\n        }\n    }\n\n\n}\nfunction runClearTimeout(marker) {\n    if (cachedClearTimeout === clearTimeout) {\n        //normal enviroments in sane situations\n        return clearTimeout(marker);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedClearTimeout(marker);\n    } catch (e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't  trust the global object when called normally\n            return cachedClearTimeout.call(null, marker);\n        } catch (e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error.\n            // Some versions of I.E. have different rules for clearTimeout vs setTimeout\n            return cachedClearTimeout.call(this, marker);\n        }\n    }\n\n\n\n}\nvar queue = [];\nvar draining = false;\nvar currentQueue;\nvar queueIndex = -1;\n\nfunction cleanUpNextTick() {\n    if (!draining || !currentQueue) {\n        return;\n    }\n    draining = false;\n    if (currentQueue.length) {\n        queue = currentQueue.concat(queue);\n    } else {\n        queueIndex = -1;\n    }\n    if (queue.length) {\n        drainQueue();\n    }\n}\n\nfunction drainQueue() {\n    if (draining) {\n        return;\n    }\n    var timeout = runTimeout(cleanUpNextTick);\n    draining = true;\n\n    var len = queue.length;\n    while(len) {\n        currentQueue = queue;\n        queue = [];\n        while (++queueIndex < len) {\n            if (currentQueue) {\n                currentQueue[queueIndex].run();\n            }\n        }\n        queueIndex = -1;\n        len = queue.length;\n    }\n    currentQueue = null;\n    draining = false;\n    runClearTimeout(timeout);\n}\n\nprocess.nextTick = function (fun) {\n    var args = new Array(arguments.length - 1);\n    if (arguments.length > 1) {\n        for (var i = 1; i < arguments.length; i++) {\n            args[i - 1] = arguments[i];\n        }\n    }\n    queue.push(new Item(fun, args));\n    if (queue.length === 1 && !draining) {\n        runTimeout(drainQueue);\n    }\n};\n\n// v8 likes predictible objects\nfunction Item(fun, array) {\n    this.fun = fun;\n    this.array = array;\n}\nItem.prototype.run = function () {\n    this.fun.apply(null, this.array);\n};\nprocess.title = 'browser';\nprocess.browser = true;\nprocess.env = {};\nprocess.argv = [];\nprocess.version = ''; // empty string to avoid regexp issues\nprocess.versions = {};\n\nfunction noop() {}\n\nprocess.on = noop;\nprocess.addListener = noop;\nprocess.once = noop;\nprocess.off = noop;\nprocess.removeListener = noop;\nprocess.removeAllListeners = noop;\nprocess.emit = noop;\n\nprocess.binding = function (name) {\n    throw new Error('process.binding is not supported');\n};\n\nprocess.cwd = function () { return '/' };\nprocess.chdir = function (dir) {\n    throw new Error('process.chdir is not supported');\n};\nprocess.umask = function() { return 0; };\n","var bundleFn = arguments[3];\nvar sources = arguments[4];\nvar cache = arguments[5];\n\nvar stringify = JSON.stringify;\n\nmodule.exports = function (fn, options) {\n    var wkey;\n    var cacheKeys = Object.keys(cache);\n\n    for (var i = 0, l = cacheKeys.length; i < l; i++) {\n        var key = cacheKeys[i];\n        var exp = cache[key].exports;\n        // Using babel as a transpiler to use esmodule, the export will always\n        // be an object with the default export as a property of it. To ensure\n        // the existing api and babel esmodule exports are both supported we\n        // check for both\n        if (exp === fn || exp && exp.default === fn) {\n            wkey = key;\n            break;\n        }\n    }\n\n    if (!wkey) {\n        wkey = Math.floor(Math.pow(16, 8) * Math.random()).toString(16);\n        var wcache = {};\n        for (var i = 0, l = cacheKeys.length; i < l; i++) {\n            var key = cacheKeys[i];\n            wcache[key] = key;\n        }\n        sources[wkey] = [\n            Function(['require','module','exports'], '(' + fn + ')(self)'),\n            wcache\n        ];\n    }\n    var skey = Math.floor(Math.pow(16, 8) * Math.random()).toString(16);\n\n    var scache = {}; scache[wkey] = wkey;\n    sources[skey] = [\n        Function(['require'], (\n            // try to call default if defined to also support babel esmodule\n            // exports\n            'var f = require(' + stringify(wkey) + ');' +\n            '(f.default ? f.default : f)(self);'\n        )),\n        scache\n    ];\n\n    var src = '(' + bundleFn + ')({'\n        + Object.keys(sources).map(function (key) {\n            return stringify(key) + ':['\n                + sources[key][0]\n                + ',' + stringify(sources[key][1]) + ']'\n            ;\n        }).join(',')\n        + '},{},[' + stringify(skey) + '])'\n    ;\n\n    var URL = window.URL || window.webkitURL || window.mozURL || window.msURL;\n\n    var blob = new Blob([src], { type: 'text/javascript' });\n    if (options && options.bare) { return blob; }\n    var workerUrl = URL.createObjectURL(blob);\n    var worker = new Worker(workerUrl);\n    worker.objectURL = workerUrl;\n    return worker;\n};\n","export const defaultConfig = {\n    enableWorker: false,\n    enableStashBuffer: true,\n    stashInitialSize: undefined,\n\n    isLive: false,\n\n    lazyLoad: true,\n    lazyLoadMaxDuration: 3 * 60,\n    deferLoadAfterSourceOpen: true,\n\n    statisticsInfoReportInterval: 600,\n\n    accurateSeek: false,\n    seekType: 'range',  // [range, param, custom]\n    seekParamStart: 'bstart',\n    seekParamEnd: 'bend',\n    rangeLoadZeroStart: false,\n    customSeekHandler: undefined\n};\n\nexport function createDefaultConfig() {\n    return Object.assign({}, defaultConfig);\n}","import IOController from '../io/io-controller.js';\nimport {createDefaultConfig} from '../config.js';\n\nclass Features {\n\n    static supportMSEH264Playback() {\n        return window.MediaSource &&\n               window.MediaSource.isTypeSupported('video/mp4; codecs=\"avc1.42E01E,mp4a.40.2\"');\n    }\n\n    static supportNetworkStreamIO() {\n        let ioctl = new IOController({}, createDefaultConfig());\n        let loaderType = ioctl.loaderType;\n        ioctl.destroy();\n        return loaderType == 'fetch-stream-loader' || loaderType == 'xhr-moz-chunked-loader';\n    }\n\n    static getNetworkLoaderTypeName() {\n        let ioctl = new IOController({}, createDefaultConfig());\n        let loaderType = ioctl.loaderType;\n        ioctl.destroy();\n        return loaderType;\n    }\n\n    static supportNativeMediaPlayback(mimeType) {\n        if (Features.videoElement == undefined) {\n            Features.videoElement = window.document.createElement('video');\n        }\n        let canPlay = Features.videoElement.canPlayType(mimeType);\n        return canPlay === 'probably' || canPlay == 'maybe';\n    }\n\n    static getFeatureList() {\n        let features = {\n            mseFlvPlayback: false,\n            mseLiveFlvPlayback: false,\n            networkStreamIO: false,\n            networkLoaderName: '',\n            nativeMP4H264Playback: false,\n            nativeWebmVP8Playback: false,\n            nativeWebmVP9Playback: false\n        };\n\n        features.mseFlvPlayback = Features.supportMSEH264Playback();\n        features.networkStreamIO = Features.supportNetworkStreamIO();\n        features.networkLoaderName = Features.getNetworkLoaderTypeName();\n        features.mseLiveFlvPlayback = features.mseFlvPlayback && features.networkStreamIO;\n        features.nativeMP4H264Playback = Features.supportNativeMediaPlayback('video/mp4; codecs=\"avc1.42001E, mp4a.40.2\"');\n        features.nativeWebmVP8Playback = Features.supportNativeMediaPlayback('video/webm; codecs=\"vp8.0, vorbis\"');\n        features.nativeWebmVP9Playback = Features.supportNativeMediaPlayback('video/webm; codecs=\"vp9\"');\n\n        return features;\n    }\n\n}\n\nexport default Features;","class MediaInfo {\n\n    constructor() {\n        this.mimeType = null;\n        this.duration = null;\n\n        this.hasAudio = null;\n        this.hasVideo = null;\n        this.audioCodec = null;\n        this.videoCodec = null;\n        this.audioDataRate = null;\n        this.videoDataRate = null;\n\n        this.audioSampleRate = null;\n        this.audioChannelCount = null;\n\n        this.width = null;\n        this.height = null;\n        this.fps = null;\n        this.profile = null;\n        this.level = null;\n        this.chromaFormat = null;\n        this.sarNum = null;\n        this.sarDen = null;\n\n        this.metadata = null;\n        this.segments = null;  // MediaInfo[]\n        this.segmentCount = null;\n        this.hasKeyframesIndex = null;\n        this.keyframesIndex = null;\n    }\n\n    isComplete() {\n        let audioInfoComplete = (this.hasAudio === false) ||\n                                (this.hasAudio === true &&\n                                 this.audioCodec != null &&\n                                 this.audioSampleRate != null &&\n                                 this.audioChannelCount != null);\n\n        let videoInfoComplete = (this.hasVideo === false) ||\n                                (this.hasVideo === true &&\n                                 this.videoCodec != null &&\n                                 this.width != null &&\n                                 this.height != null &&\n                                 this.fps != null &&\n                                 this.profile != null &&\n                                 this.level != null &&\n                                 this.chromaFormat != null &&\n                                 this.sarNum != null &&\n                                 this.sarDen != null);\n\n        // keyframesIndex may not be present\n        return this.mimeType != null &&\n               this.duration != null &&\n               this.metadata != null &&\n               this.hasKeyframesIndex != null &&\n               audioInfoComplete &&\n               videoInfoComplete;\n    }\n\n    isSeekable() {\n        return this.hasKeyframesIndex === true;\n    }\n\n    getNearestKeyframe(milliseconds) {\n        if (this.keyframesIndex == null) {\n            return null;\n        }\n\n        let table = this.keyframesIndex;\n        let keyframeIdx = this._search(table.times, milliseconds);\n\n        return {\n            index: keyframeIdx,\n            milliseconds: table.times[keyframeIdx],\n            fileposition: table.filepositions[keyframeIdx]\n        };\n    }\n\n    _search(list, value) {\n        let idx = 0;\n\n        let last = list.length - 1;\n        let mid = 0;\n        let lbound = 0;\n        let ubound = last;\n\n        if (value < list[0]) {\n            idx = 0;\n            lbound = ubound + 1;  // skip search\n        }\n\n        while (lbound <= ubound) {\n            mid = lbound + Math.floor((ubound - lbound) / 2);\n            if (mid === last || (value >= list[mid] && value < list[mid + 1])) {\n                idx = mid;\n                break;\n            } else if (list[mid] < value) {\n                lbound = mid + 1;\n            } else {\n                ubound = mid - 1;\n            }\n        }\n\n        return idx;\n    }\n\n}\n\nexport default MediaInfo;","// Represents an media sample (audio / video)\nexport class SampleInfo {\n\n    constructor(dts, pts, duration, originalDts, isSync) {\n        this.dts = dts;\n        this.pts = pts;\n        this.duration = duration;\n        this.originalDts = originalDts;\n        this.isSyncPoint = isSync;\n        this.fileposition = null;\n    }\n\n}\n\n// Media Segment concept is defined in Media Source Extensions spec.\n// Particularly in ISO BMFF format, an Media Segment contains a moof box followed by a mdat box.\nexport class MediaSegmentInfo {\n\n    constructor() {\n        this.beginDts = 0;\n        this.endDts = 0;\n        this.beginPts = 0;\n        this.endPts = 0;\n        this.originalBeginDts = 0;\n        this.originalEndDts = 0;\n        this.syncPoints = [];     // SampleInfo[n], for video IDR frames only\n        this.firstSample = null;  // SampleInfo\n        this.lastSample = null;   // SampleInfo\n    }\n\n    appendSyncPoint(sampleInfo) {  // also called Random Access Point\n        sampleInfo.isSyncPoint = true;\n        this.syncPoints.push(sampleInfo);\n    }\n\n}\n\n// Ordered list for recording video IDR frames, sorted by originalDts\nexport class IDRSampleList {\n\n    constructor() {\n        this._list = [];\n    }\n\n    clear() {\n        this._list = [];\n    }\n\n    appendArray(syncPoints) {\n        let list = this._list;\n\n        if (syncPoints.length === 0) {\n            return;\n        }\n\n        if (list.length > 0 && syncPoints[0].originalDts < list[list.length - 1].originalDts) {\n            this.clear();\n        }\n\n        Array.prototype.push.apply(list, syncPoints);\n    }\n\n    getLastSyncPointBeforeDts(dts) {\n        if (this._list.length == 0) {\n            return null;\n        }\n\n        let list = this._list;\n        let idx = 0;\n        let last = list.length - 1;\n        let mid = 0;\n        let lbound = 0;\n        let ubound = last;\n\n        if (dts < list[0].dts) {\n            idx = 0;\n            lbound = ubound + 1;\n        }\n\n        while (lbound <= ubound) {\n            mid = lbound + Math.floor((ubound - lbound) / 2);\n            if (mid === last || (dts >= list[mid].dts && dts < list[mid + 1].dts)) {\n                idx = mid;\n                break;\n            } else if (list[mid].dts < dts) {\n                lbound = mid + 1;\n            } else {\n                ubound = mid - 1;\n            }\n        }\n        return this._list[idx];\n    }\n\n}\n\n// Data structure for recording information of media segments in single track.\nexport class MediaSegmentInfoList {\n\n    constructor(type) {\n        this._type = type;\n        this._list = [];\n        this._lastAppendLocation = -1;  // cached last insert location\n    }\n\n    get type() {\n        return this._type;\n    }\n\n    get length() {\n        return this._list.length;\n    }\n\n    isEmpty() {\n        return this._list.length === 0;\n    }\n\n    clear() {\n        this._list = [];\n        this._lastAppendLocation = -1;\n    }\n\n    _searchNearestSegmentBefore(originalBeginDts) {\n        let list = this._list;\n        if (list.length === 0) {\n            return -2;\n        }\n        let last = list.length - 1;\n        let mid = 0;\n        let lbound = 0;\n        let ubound = last;\n\n        let idx = 0;\n\n        if (originalBeginDts < list[0].originalBeginDts) {\n            idx = -1;\n            return idx;\n        }\n\n        while (lbound <= ubound) {\n            mid = lbound + Math.floor((ubound - lbound) / 2);\n            if (mid === last || (originalBeginDts > list[mid].lastSample.originalDts &&\n                                (originalBeginDts < list[mid + 1].originalBeginDts))) {\n                idx = mid;\n                break;\n            } else if (list[mid].originalBeginDts < originalBeginDts) {\n                lbound = mid + 1;\n            } else {\n                ubound = mid - 1;\n            }\n        }\n        return idx;\n    }\n\n    _searchNearestSegmentAfter(originalBeginDts) {\n        return this._searchNearestSegmentBefore(originalBeginDts) + 1;\n    }\n\n    append(mediaSegmentInfo) {\n        let list = this._list;\n        let msi = mediaSegmentInfo;\n        let lastAppendIdx = this._lastAppendLocation;\n        let insertIdx = 0;\n\n        if (lastAppendIdx !== -1 && lastAppendIdx < list.length &&\n                                    msi.originalBeginDts >= list[lastAppendIdx].lastSample.originalDts &&\n                                    ((lastAppendIdx === list.length - 1) ||\n                                    (lastAppendIdx < list.length - 1 &&\n                                    msi.originalBeginDts < list[lastAppendIdx + 1].originalBeginDts))) {\n            insertIdx = lastAppendIdx + 1;  // use cached location idx\n        } else {\n            if (list.length > 0) {\n                insertIdx = this._searchNearestSegmentBefore(msi.originalBeginDts) + 1;\n            }\n        }\n\n        this._lastAppendLocation = insertIdx;\n        this._list.splice(insertIdx, 0, msi);\n    }\n\n    removeSegmentsAfter(originalDts) {\n        let list = this._list;\n        if (list.length === 0) {\n            return;\n        }\n        let last = list.length - 1;\n        let mid = 0;\n        let lbound = 0;\n        let ubound = last;\n\n        let idx = 0;\n\n        if (originalDts < list[0].originalBeginDts) {\n            idx = 0;\n            lbound = ubound + 1;\n        }\n\n        while (lbound <= ubound) {\n            mid = lbound + Math.floor((ubound - lbound) / 2);\n            if (mid === last) {  // no segments need to be remove\n                return;\n            } else if (list[mid].lastSample.originalDts < originalDts && originalDts <= list[mid + 1].originalBeginDts) {\n                idx = mid + 1;\n                break;\n            } else if (list[mid].originalBeginDts <= originalDts && originalDts < list[mid].originalEndDts) {\n                idx = mid;\n                break;\n            } else if (originalDts > list[mid].lastSample.originalDts) {\n                lbound = mid + 1;\n            } else {\n                ubound = mid - 1;\n            }\n        }\n\n        this._list.splice(idx, this._list.length - idx);\n    }\n\n    getLastSegmentBefore(originalBeginDts) {\n        let idx = this._searchNearestSegmentBefore(originalBeginDts);\n        if (idx >= 0) {\n            return this._list[idx];\n        } else {  // -1\n            return null;\n        }\n    }\n\n    getLastSampleBefore(originalBeginDts) {\n        let segment = this.getLastSegmentBefore(originalBeginDts);\n        if (segment != null) {\n            return segment.lastSample;\n        } else {\n            return null;\n        }\n    }\n\n    getLastSyncPointBefore(originalBeginDts) {\n        let segmentIdx = this._searchNearestSegmentBefore(originalBeginDts);\n        let syncPoints = this._list[segmentIdx].syncPoints;\n        while (syncPoints.length === 0 && segmentIdx > 0) {\n            segmentIdx--;\n            syncPoints = this._list[segmentIdx].syncPoints;\n        }\n        if (syncPoints.length > 0) {\n            return syncPoints[syncPoints.length - 1];\n        } else {\n            return null;\n        }\n    }\n\n}","import EventEmitter from 'events';\nimport Log from '../utils/logger.js';\nimport Browser from '../utils/browser.js';\nimport MSEEvents from './mse-events.js';\nimport {SampleInfo, IDRSampleList} from './media-segment-info.js';\nimport {IllegalStateException} from '../utils/exception.js';\n\n// Media Source Extensions controller\nclass MSEController {\n\n    constructor() {\n        this.TAG = this.constructor.name;\n\n        this._emitter = new EventEmitter();\n\n        this.e = {\n            onSourceOpen: this._onSourceOpen.bind(this),\n            onSourceEnded: this._onSourceEnded.bind(this),\n            onSourceClose: this._onSourceClose.bind(this),\n            onSourceBufferError: this._onSourceBufferError.bind(this),\n            onSourceBufferUpdateEnd: this._onSourceBufferUpdateEnd.bind(this)\n        };\n\n        this._mediaSource = null;\n        this._mediaSourceObjectURL = null;\n        this._mediaElement = null;\n\n        this._isBufferFull = false;\n        this._hasPendingEos = false;\n\n        this._pendingSourceBufferInit = [];\n        this._mimeTypes = {\n            video: null,\n            audio: null\n        };\n        this._sourceBuffers = {\n            video: null,\n            audio: null\n        };\n        this._lastInitSegments = {\n            video: null,\n            audio: null\n        };\n        this._pendingSegments = {\n            video: [],\n            audio: []\n        };\n        this._pendingRemoveRanges = {\n            video: [],\n            audio: []\n        };\n        this._idrList = new IDRSampleList();\n    }\n\n    destroy() {\n        if (this._mediaElement || this._mediaSource) {\n            this.detachMediaElement();\n        }\n        this.e = null;\n        this._emitter.removeAllListeners();\n        this._emitter = null;\n    }\n\n    on(event, listener) {\n        this._emitter.addListener(event, listener);\n    }\n\n    off(event, listener) {\n        this._emitter.removeListener(event, listener);\n    }\n\n    attachMediaElement(mediaElement) {\n        if (this._mediaSource) {\n            throw new IllegalStateException('MediaSource has been attached to an HTMLMediaElement!');\n        }\n        let ms = this._mediaSource = new window.MediaSource();\n        ms.addEventListener('sourceopen', this.e.onSourceOpen);\n        ms.addEventListener('sourceended', this.e.onSourceEnded);\n        ms.addEventListener('sourceclose', this.e.onSourceClose);\n\n        this._mediaElement = mediaElement;\n        this._mediaSourceObjectURL = window.URL.createObjectURL(this._mediaSource);\n        mediaElement.src = this._mediaSourceObjectURL;\n    }\n\n    detachMediaElement() {\n        if (this._mediaSource) {\n            let ms = this._mediaSource;\n            for (let type in this._sourceBuffers) {\n                // pending segments should be discard\n                let ps = this._pendingSegments[type];\n                ps.splice(0, ps.length);\n                this._pendingSegments[type] = null;\n                this._pendingRemoveRanges[type] = null;\n                this._lastInitSegments[type] = null;\n\n                // remove all sourcebuffers\n                let sb = this._sourceBuffers[type];\n                if (sb) {\n                    if (ms.readyState !== 'closed') {\n                        ms.removeSourceBuffer(sb);\n                        sb.removeEventListener('error', this.e.onSourceBufferError);\n                        sb.removeEventListener('updateend', this.e.onSourceBufferUpdateEnd);\n                    }\n                    this._mimeTypes[type] = null;\n                    this._sourceBuffers[type] = null;\n                }\n            }\n            if (ms.readyState === 'open') {\n                try {\n                    ms.endOfStream();\n                } catch (error) {\n                    Log.e(this.TAG, error.message);\n                }\n            }\n            ms.removeEventListener('sourceopen', this.e.onSourceOpen);\n            ms.removeEventListener('sourceended', this.e.onSourceEnded);\n            ms.removeEventListener('sourceclose', this.e.onSourceClose);\n            this._pendingSourceBufferInit = [];\n            this._isBufferFull = false;\n            this._idrList.clear();\n            this._mediaSource = null;\n        }\n\n        if (this._mediaElement) {\n            this._mediaElement.src = '';\n            this._mediaElement.removeAttribute('src');\n            this._mediaElement = null;\n        }\n        if (this._mediaSourceObjectURL) {\n            window.URL.revokeObjectURL(this._mediaSourceObjectURL);\n            this._mediaSourceObjectURL = null;\n        }\n    }\n\n    appendInitSegment(initSegment, deferred) {\n        if (!this._mediaSource || this._mediaSource.readyState !== 'open') {\n            // sourcebuffer creation requires mediaSource.readyState === 'open'\n            // so we defer the sourcebuffer creation, until sourceopen event triggered\n            this._pendingSourceBufferInit.push(initSegment);\n            // make sure that this InitSegment is in the front of pending segments queue\n            this._pendingSegments[initSegment.type].push(initSegment);\n            return;\n        }\n\n        let is = initSegment;\n        let mimeType = `${is.container};codecs=${is.codec}`;\n        let firstInitSegment = false;\n\n        Log.v(this.TAG, 'Received Initialization Segment, mimeType: ' + mimeType);\n        this._lastInitSegments[is.type] = is;\n\n        if (mimeType !== this._mimeTypes[is.type]) {\n            if (!this._mimeTypes[is.type]) {  // empty, first chance create sourcebuffer\n                firstInitSegment = true;\n                try {\n                    let sb = this._sourceBuffers[is.type] = this._mediaSource.addSourceBuffer(mimeType);\n                    sb.addEventListener('error', this.e.onSourceBufferError);\n                    sb.addEventListener('updateend', this.e.onSourceBufferUpdateEnd);\n                } catch (error) {\n                    Log.e(this.TAG, error.message);\n                    this._emitter.emit(MSEEvents.ERROR, {code: error.code, msg: error.message});\n                    return;\n                }\n            } else {\n                Log.v(this.TAG, `Notice: ${is.type} mimeType changed, origin: ${this._mimeTypes[is.type]}, target: ${mimeType}`);\n            }\n            this._mimeTypes[is.type] = mimeType;\n        }\n\n        if (!deferred) {\n            // deferred means this InitSegment has been pushed to pendingSegments queue\n            this._pendingSegments[is.type].push(is);\n        }\n        if (!firstInitSegment) {  // append immediately only if init segment in subsequence\n            if (this._sourceBuffers[is.type] && !this._sourceBuffers[is.type].updating) {\n                this._doAppendSegments();\n            }\n        }\n    }\n\n    appendMediaSegment(mediaSegment) {\n        let ms = mediaSegment;\n        this._pendingSegments[ms.type].push(ms);\n\n        let sb = this._sourceBuffers[ms.type];\n        if (sb && !sb.updating && !this._hasPendingRemoveRanges()) {\n            this._doAppendSegments();\n        }\n    }\n\n    seek(seconds) {\n        // remove all appended buffers\n        for (let type in this._sourceBuffers) {\n            if (!this._sourceBuffers[type]) {\n                continue;\n            }\n\n            // abort current buffer append algorithm\n            let sb = this._sourceBuffers[type];\n            if (this._mediaSource.readyState === 'open') {\n                try {\n                    // If range removal algorithm is running, InvalidStateError will be throwed\n                    // Ignore it.\n                    sb.abort();\n                } catch (error) {\n                    Log.e(this.TAG, error.message);\n                }\n            }\n\n            // IDRList should be clear\n            this._idrList.clear();\n\n            // pending segments should be discard\n            let ps = this._pendingSegments[type];\n            ps.splice(0, ps.length);\n\n            if (this._mediaSource.readyState === 'closed') {\n                // Parent MediaSource object has been detached from HTMLMediaElement\n                continue;\n            }\n\n            // record ranges to be remove from SourceBuffer\n            for (let i = 0; i < sb.buffered.length; i++) {\n                let start = sb.buffered.start(i);\n                let end = sb.buffered.end(i);\n                this._pendingRemoveRanges[type].push({start, end});\n            }\n\n            // if sb is not updating, let's remove ranges now!\n            if (!sb.updating) {\n                this._doRemoveRanges();\n            }\n\n            // Safari 10 may get InvalidStateError in the later appendBuffer() after SourceBuffer.remove() call\n            // Internal parser's state may be invalid at this time. Re-append last InitSegment to workaround.\n            // Related issue: https://bugs.webkit.org/show_bug.cgi?id=159230\n            if (Browser.safari) {\n                let lastInitSegment = this._lastInitSegments[type];\n                if (lastInitSegment) {\n                    this._pendingSegments[type].push(lastInitSegment);\n                    if (!sb.updating) {\n                        this._doAppendSegments();\n                    }\n                }\n            }\n        }\n    }\n\n    endOfStream() {\n        let ms = this._mediaSource;\n        let sb = this._sourceBuffers;\n        if (!ms || ms.readyState !== 'open') {\n            if (ms && ms.readyState === 'closed' && this._hasPendingSegments()) {\n                // If MediaSource hasn't turned into open state, and there're pending segments\n                // Mark pending endOfStream, defer call until all pending segments appended complete\n                this._hasPendingEos = true;\n            }\n            return;\n        }\n        if (sb.video && sb.video.updating || sb.audio && sb.audio.updating) {\n            // If any sourcebuffer is updating, defer endOfStream operation\n            // See _onSourceBufferUpdateEnd()\n            this._hasPendingEos = true;\n        } else {\n            this._hasPendingEos = false;\n            // Notify media data loading complete\n            // This is helpful for correcting total duration to match last media segment\n            // Otherwise MediaElement's ended event may not be triggered\n            ms.endOfStream();\n        }\n    }\n\n    getNearestKeyframe(dts) {\n        return this._idrList.getLastSyncPointBeforeDts(dts);\n    }\n\n    _doRemoveRanges() {\n        for (let type in this._pendingRemoveRanges) {\n            if (!this._sourceBuffers[type] || this._sourceBuffers[type].updating) {\n                continue;\n            }\n            let sb = this._sourceBuffers[type];\n            let ranges = this._pendingRemoveRanges[type];\n            while (ranges.length && !sb.updating) {\n                let range = ranges.shift();\n                sb.remove(range.start, range.end);\n            }\n        }\n    }\n\n    _doAppendSegments() {\n        let pendingSegments = this._pendingSegments;\n\n        for (let type in pendingSegments) {\n            if (!this._sourceBuffers[type] || this._sourceBuffers[type].updating) {\n                continue;\n            }\n            if (pendingSegments[type].length > 0) {\n                let segment = pendingSegments[type].shift();\n                try {\n                    this._sourceBuffers[type].appendBuffer(segment.data);\n                    this._isBufferFull = false;\n                    if (type === 'video' && segment.hasOwnProperty('info')) {\n                        this._idrList.appendArray(segment.info.syncPoints);\n                    }\n                } catch (error) {\n                    this._pendingSegments[type].unshift(segment);\n                    if (error.code === 22) {  // QuotaExceededError\n                        /* Notice that FireFox may not throw QuotaExceededError if SourceBuffer is full\n                         * Currently we can only do lazy-load to avoid SourceBuffer become scattered.\n                         * SourceBuffer eviction policy may be changed in future version of FireFox.\n                         *\n                         * Related issues:\n                         * https://bugzilla.mozilla.org/show_bug.cgi?id=1279885\n                         * https://bugzilla.mozilla.org/show_bug.cgi?id=1280023\n                         */\n\n                        // report buffer full, abort network IO\n                        if (!this._isBufferFull) {\n                            this._emitter.emit(MSEEvents.BUFFER_FULL);\n                        }\n                        this._isBufferFull = true;\n                    } else {\n                        Log.e(this.TAG, error.message);\n                        this._emitter.emit(MSEEvents.ERROR, {code: error.code, msg: error.message});\n                    }\n                }\n            }\n        }\n    }\n\n    _onSourceOpen() {\n        Log.v(this.TAG, 'MediaSource onSourceOpen');\n        this._mediaSource.removeEventListener('sourceopen', this.e.onSourceOpen);\n        // deferred sourcebuffer creation / initialization\n        if (this._pendingSourceBufferInit.length > 0) {\n            let pendings = this._pendingSourceBufferInit;\n            while (pendings.length) {\n                let segment = pendings.shift();\n                this.appendInitSegment(segment, true);\n            }\n        }\n        // there may be some pending media segments, append them\n        if (this._hasPendingSegments()) {\n            this._doAppendSegments();\n        }\n        this._emitter.emit(MSEEvents.SOURCE_OPEN);\n    }\n\n    _onSourceEnded() {\n        // fired on endOfStream\n        Log.v(this.TAG, 'MediaSource onSourceEnded');\n    }\n\n    _onSourceClose() {\n        // fired on detaching from media element\n        Log.v(this.TAG, 'MediaSource onSourceClose');\n        if (this._mediaSource && this.e != null) {\n            this._mediaSource.removeEventListener('sourceopen', this.e.onSourceOpen);\n            this._mediaSource.removeEventListener('sourceended', this.e.onSourceEnded);\n            this._mediaSource.removeEventListener('sourceclose', this.e.onSourceClose);\n        }\n    }\n\n    _hasPendingSegments() {\n        let ps = this._pendingSegments;\n        return ps.video.length > 0 || ps.audio.length > 0;\n    }\n\n    _hasPendingRemoveRanges() {\n        let prr = this._pendingRemoveRanges;\n        return prr.video.length > 0 || prr.audio.length > 0;\n    }\n\n    _onSourceBufferUpdateEnd() {\n        if (this._hasPendingRemoveRanges()) {\n            this._doRemoveRanges();\n        } else if (this._hasPendingSegments()) {\n            this._doAppendSegments();\n        } else if (this._hasPendingEos) {\n            this.endOfStream();\n        }\n        this._emitter.emit(MSEEvents.UPDATE_END);\n    }\n\n    _onSourceBufferError(e) {\n        Log.e(this.TAG, `SourceBuffer Error: ${e}`);\n        // this error might not always be fatal, just ignore it\n    }\n\n}\n\nexport default MSEController;","const MSEEvents = {\n    ERROR: 'error',\n    SOURCE_OPEN: 'source_open',\n    UPDATE_END: 'update_end',\n    BUFFER_FULL: 'buffer_full'\n};\n\nexport default MSEEvents;","import EventEmitter from 'events';\nimport Log from '../utils/logger.js';\nimport LoggingControl from '../utils/logging-control.js';\nimport TransmuxingController from './transmuxing-controller.js';\nimport TransmuxingEvents from './transmuxing-events.js';\nimport TransmuxingWorker from './transmuxing-worker.js';\nimport MediaInfo from './media-info.js';\n\nclass Transmuxer {\n\n    constructor(mediaDataSource, config) {\n        this.TAG = this.constructor.name;\n        this._emitter = new EventEmitter();\n\n        if (config.enableWorker && typeof (Worker) !== 'undefined') {\n            try {\n                let work = require('webworkify');\n                this._worker = work(TransmuxingWorker);\n                this._workerDestroying = false;\n                this._worker.addEventListener('message', this._onWorkerMessage.bind(this));\n                this._worker.postMessage({cmd: 'init', param: [mediaDataSource, config]});\n                this.e = {\n                    onLoggingConfigChanged: this._onLoggingConfigChanged.bind(this)\n                };\n                LoggingControl.registerListener(this.e.onLoggingConfigChanged);\n                this._worker.postMessage({cmd: 'logging_config', param: LoggingControl.getConfig()});\n            } catch (error) {\n                Log.e(this.TAG, 'Error while initialize transmuxing worker, fallback to inline transmuxing');\n                this._worker = null;\n                this._controller = new TransmuxingController(mediaDataSource, config);\n            }\n        } else {\n            this._controller = new TransmuxingController(mediaDataSource, config);\n        }\n\n        if (this._controller) {\n            let ctl = this._controller;\n            ctl.on(TransmuxingEvents.IO_ERROR, this._onIOError.bind(this));\n            ctl.on(TransmuxingEvents.DEMUX_ERROR, this._onDemuxError.bind(this));\n            ctl.on(TransmuxingEvents.INIT_SEGMENT, this._onInitSegment.bind(this));\n            ctl.on(TransmuxingEvents.MEDIA_SEGMENT, this._onMediaSegment.bind(this));\n            ctl.on(TransmuxingEvents.LOADING_COMPLETE, this._onLoadingComplete.bind(this));\n            ctl.on(TransmuxingEvents.RECOVERED_EARLY_EOF, this._onRecoveredEarlyEof.bind(this));\n            ctl.on(TransmuxingEvents.MEDIA_INFO, this._onMediaInfo.bind(this));\n            ctl.on(TransmuxingEvents.STATISTICS_INFO, this._onStatisticsInfo.bind(this));\n            ctl.on(TransmuxingEvents.RECOMMEND_SEEKPOINT, this._onRecommendSeekpoint.bind(this));\n        }\n    }\n\n    destroy() {\n        if (this._worker) {\n            if (!this._workerDestroying) {\n                this._workerDestroying = true;\n                this._worker.postMessage({cmd: 'destroy'});\n                LoggingControl.removeListener(this.e.onLoggingConfigChanged);\n                this.e = null;\n            }\n        } else {\n            this._controller.destroy();\n            this._controller = null;\n        }\n        this._emitter.removeAllListeners();\n        this._emitter = null;\n    }\n\n    on(event, listener) {\n        this._emitter.addListener(event, listener);\n    }\n\n    off(event, listener) {\n        this._emitter.removeListener(event, listener);\n    }\n\n    hasWorker() {\n        return this._worker != null;\n    }\n\n    open() {\n        if (this._worker) {\n            this._worker.postMessage({cmd: 'start'});\n        } else {\n            this._controller.start();\n        }\n    }\n\n    close() {\n        if (this._worker) {\n            this._worker.postMessage({cmd: 'stop'});\n        } else {\n            this._controller.stop();\n        }\n    }\n\n    seek(milliseconds) {\n        if (this._worker) {\n            this._worker.postMessage({cmd: 'seek', param: milliseconds});\n        } else {\n            this._controller.seek(milliseconds);\n        }\n    }\n\n    pause() {\n        if (this._worker) {\n            this._worker.postMessage({cmd: 'pause'});\n        } else {\n            this._controller.pause();\n        }\n    }\n\n    resume() {\n        if (this._worker) {\n            this._worker.postMessage({cmd: 'resume'});\n        } else {\n            this._controller.resume();\n        }\n    }\n\n    _onInitSegment(type, initSegment) {\n        // do async invoke\n        Promise.resolve().then(() => {\n            this._emitter.emit(TransmuxingEvents.INIT_SEGMENT, type, initSegment);\n        });\n    }\n\n    _onMediaSegment(type, mediaSegment) {\n        Promise.resolve().then(() => {\n            this._emitter.emit(TransmuxingEvents.MEDIA_SEGMENT, type, mediaSegment);\n        });\n    }\n\n    _onLoadingComplete() {\n        Promise.resolve().then(() => {\n            this._emitter.emit(TransmuxingEvents.LOADING_COMPLETE);\n        });\n    }\n\n    _onRecoveredEarlyEof() {\n        Promise.resolve().then(() => {\n            this._emitter.emit(TransmuxingEvents.RECOVERED_EARLY_EOF);\n        });\n    }\n\n    _onMediaInfo(mediaInfo) {\n        Promise.resolve().then(() => {\n            this._emitter.emit(TransmuxingEvents.MEDIA_INFO, mediaInfo);\n        });\n    }\n\n    _onStatisticsInfo(statisticsInfo) {\n        Promise.resolve().then(() => {\n            this._emitter.emit(TransmuxingEvents.STATISTICS_INFO, statisticsInfo);\n        });\n    }\n\n    _onIOError(type, info) {\n        Promise.resolve().then(() => {\n            this._emitter.emit(TransmuxingEvents.IO_ERROR, type, info);\n        });\n    }\n\n    _onDemuxError(type, info) {\n        Promise.resolve().then(() => {\n            this._emitter.emit(TransmuxingEvents.DEMUX_ERROR, type, info);\n        });\n    }\n\n    _onRecommendSeekpoint(milliseconds) {\n        Promise.resolve().then(() => {\n            this._emitter.emit(TransmuxingEvents.RECOMMEND_SEEKPOINT, milliseconds);\n        });\n    }\n\n    _onLoggingConfigChanged(config) {\n        if (this._worker) {\n            this._worker.postMessage({cmd: 'logging_config', param: config});\n        }\n    }\n\n    _onWorkerMessage(e) {\n        let message = e.data;\n        let data = message.data;\n\n        if (message.msg === 'destroyed' || this._workerDestroying) {\n            this._workerDestroying = false;\n            this._worker.terminate();\n            this._worker = null;\n            return;\n        }\n\n        switch (message.msg) {\n            case TransmuxingEvents.INIT_SEGMENT:\n            case TransmuxingEvents.MEDIA_SEGMENT:\n                this._emitter.emit(message.msg, data.type, data.data);\n                break;\n            case TransmuxingEvents.LOADING_COMPLETE:\n            case TransmuxingEvents.RECOVERED_EARLY_EOF:\n                this._emitter.emit(message.msg);\n                break;\n            case TransmuxingEvents.MEDIA_INFO:\n                Object.setPrototypeOf(data, MediaInfo.prototype);\n                this._emitter.emit(message.msg, data);\n                break;\n            case TransmuxingEvents.STATISTICS_INFO:\n                this._emitter.emit(message.msg, data);\n                break;\n            case TransmuxingEvents.IO_ERROR:\n            case TransmuxingEvents.DEMUX_ERROR:\n                this._emitter.emit(message.msg, data.type, data.info);\n                break;\n            case TransmuxingEvents.RECOMMEND_SEEKPOINT:\n                this._emitter.emit(message.msg, data);\n                break;\n            default:\n                break;\n        }\n    }\n\n}\n\nexport default Transmuxer;","import EventEmitter from 'events';\nimport Log from '../utils/logger.js';\nimport Browser from '../utils/browser.js';\nimport MediaInfo from './media-info.js';\nimport FLVDemuxer from '../demux/flv-demuxer.js';\nimport MP4Remuxer from '../remux/mp4-remuxer.js';\nimport DemuxErrors from '../demux/demux-errors.js';\nimport IOController from '../io/io-controller.js';\nimport TransmuxingEvents from './transmuxing-events.js';\nimport {LoaderStatus, LoaderErrors} from '../io/loader.js';\n\n// Transmuxing (IO, Demuxing, Remuxing) controller, with multipart support\nclass TransmuxingController {\n\n    constructor(mediaDataSource, config) {\n        this.TAG = this.constructor.name;\n        this._emitter = new EventEmitter();\n\n        this._config = config;\n\n        // treat single part media as multipart media, which has only one segment\n        if (!mediaDataSource.segments) {\n            mediaDataSource.segments = [{\n                duration: mediaDataSource.duration,\n                filesize: mediaDataSource.filesize,\n                url: mediaDataSource.url\n            }];\n        }\n\n        // fill in default IO params if not exists\n        if (typeof mediaDataSource.cors !== 'boolean') {\n            mediaDataSource.cors = true;\n        }\n        if (typeof mediaDataSource.withCredentials !== 'boolean') {\n            mediaDataSource.withCredentials = false;\n        }\n\n        this._mediaDataSource = mediaDataSource;\n        this._currentSegmentIndex = 0;\n        let totalDuration = 0;\n\n        this._mediaDataSource.segments.forEach((segment) => {\n            // timestampBase for each segment, and calculate total duration\n            segment.timestampBase = totalDuration;\n            totalDuration += segment.duration;\n            // params needed by IOController\n            segment.cors = mediaDataSource.cors;\n            segment.withCredentials = mediaDataSource.withCredentials;\n        });\n\n        if (!isNaN(totalDuration) && this._mediaDataSource.duration !== totalDuration) {\n            this._mediaDataSource.duration = totalDuration;\n        }\n\n        this._mediaInfo = null;\n        this._demuxer = null;\n        this._remuxer = null;\n        this._ioctl = null;\n\n        this._pendingSeekTime = null;\n        this._pendingResolveSeekPoint = null;\n    }\n\n    destroy() {\n        this._mediaInfo = null;\n        this._mediaDataSource = null;\n\n        if (this._ioctl) {\n            this._ioctl.destroy();\n            this._ioctl = null;\n        }\n        if (this._demuxer) {\n            this._demuxer.destroy();\n            this._demuxer = null;\n        }\n        if (this._remuxer) {\n            this._remuxer.destroy();\n            this._remuxer = null;\n        }\n\n        this._emitter.removeAllListeners();\n        this._emitter = null;\n    }\n\n    on(event, listener) {\n        this._emitter.addListener(event, listener);\n    }\n\n    off(event, listener) {\n        this._emitter.removeListener(event, listener);\n    }\n\n    start() {\n        this._loadSegment(0);\n    }\n\n    _loadSegment(segmentIndex, optionalFrom) {\n        this._currentSegmentIndex = segmentIndex;\n        let dataSource = this._mediaDataSource.segments[segmentIndex];\n\n        let ioctl = this._ioctl = new IOController(dataSource, this._config, segmentIndex);\n        ioctl.onError = this._onIOException.bind(this);\n        ioctl.onSeeked = this._onIOSeeked.bind(this);\n        ioctl.onComplete = this._onIOComplete.bind(this);\n        ioctl.onRecoveredEarlyEof = this._onIORecoveredEarlyEof.bind(this);\n\n        if (optionalFrom) {\n            this._demuxer.bindDataSource(this._ioctl);\n        } else {\n            ioctl.onDataArrival = this._onInitChunkArrival.bind(this);\n        }\n\n        ioctl.open(optionalFrom);\n    }\n\n    stop() {\n        this._internalAbort();\n    }\n\n    _internalAbort() {\n        if (this._ioctl) {\n            this._ioctl.destroy();\n            this._ioctl = null;\n        }\n    }\n\n    pause() {  // take a rest\n        if (this._ioctl && this._ioctl.isWorking()) {\n            this._ioctl.pause();\n        }\n    }\n\n    resume() {\n        if (this._ioctl && this._ioctl.isPaused()) {\n            this._ioctl.resume();\n        }\n    }\n\n    seek(milliseconds) {\n        if (this._mediaInfo == null) {\n            return;\n        }\n        if (!this._mediaInfo.isSeekable()) {\n            return;\n        }\n\n        let targetSegmentIndex = this._searchSegmentIndexContains(milliseconds);\n\n        if (targetSegmentIndex === this._currentSegmentIndex) {\n            // intra-segment seeking\n            let segmentInfo = this._mediaInfo.segments[targetSegmentIndex];\n\n            if (segmentInfo == undefined) {\n                // current segment loading started, but mediainfo hasn't received yet\n                // wait for the metadata loaded, then seek to expected position\n                this._pendingSeekTime = milliseconds;\n            } else {\n                let keyframe = segmentInfo.getNearestKeyframe(milliseconds);\n                this._remuxer.seek(keyframe.milliseconds);\n                this._ioctl.seek(keyframe.fileposition);\n                // Will be resolved in _onRemuxerMediaSegmentArrival()\n                this._pendingResolveSeekPoint = keyframe.milliseconds;\n            }\n        } else {\n            // cross-segment seeking\n            let targetSegmentInfo = this._mediaInfo.segments[targetSegmentIndex];\n\n            if (targetSegmentInfo == undefined) {\n                // target segment hasn't been loaded. We need metadata then seek to expected time\n                this._pendingSeekTime = milliseconds;\n                this._internalAbort();\n                this._remuxer.seek();\n                this._remuxer.insertDiscontinuity();\n                this._loadSegment(targetSegmentIndex);\n                // Here we wait for the metadata loaded, then seek to expected position\n            } else {\n                // We have target segment's metadata, direct seek to target position\n                let keyframe = targetSegmentInfo.getNearestKeyframe(milliseconds);\n                this._internalAbort();\n                this._remuxer.seek(milliseconds);\n                this._remuxer.insertDiscontinuity();\n                this._demuxer.timestampBase = this._mediaDataSource.segments[targetSegmentIndex].timestampBase;\n                this._loadSegment(targetSegmentIndex, keyframe.fileposition);\n                this._pendingResolveSeekPoint = keyframe.milliseconds;\n            }\n        }\n    }\n\n    _searchSegmentIndexContains(milliseconds) {\n        let segments = this._mediaDataSource.segments;\n        let idx = segments.length - 1;\n\n        for (let i = 0; i < segments.length; i++) {\n            if (milliseconds < segments[i].timestampBase) {\n                idx = i - 1;\n                break;\n            }\n        }\n        return idx;\n    }\n\n    _onInitChunkArrival(data, byteStart) {\n        let probeData = null;\n\n        if (byteStart > 0) {\n            // IOController seeked immediately after opened, byteStart > 0 callback may received\n            this._demuxer.bindDataSource(this._ioctl);\n            this._demuxer.timestampBase = this._mediaDataSource.segments[this._currentSegmentIndex].timestampBase;\n        } else if ((probeData = FLVDemuxer.probe(data)).match) {\n            // Always create new FLVDemuxer\n            this._demuxer = new FLVDemuxer(probeData, this._config);\n\n            if (!this._remuxer) {\n                this._remuxer = new MP4Remuxer(this._config);\n            }\n\n            let mds = this._mediaDataSource;\n            if (mds.duration != undefined && !isNaN(mds.duration)) {\n                this._demuxer.overridedDuration = mds.duration;\n            }\n            this._demuxer.timestampBase = mds.segments[this._currentSegmentIndex].timestampBase;\n\n            this._demuxer.onError = this._onDemuxException.bind(this);\n            this._demuxer.onMediaInfo = this._onMediaInfo.bind(this);\n\n            this._remuxer.bindDataSource(this._demuxer\n                         .bindDataSource(this._ioctl\n            ));\n\n            this._remuxer.onInitSegment = this._onRemuxerInitSegmentArrival.bind(this);\n            this._remuxer.onMediaSegment = this._onRemuxerMediaSegmentArrival.bind(this);\n        } else {\n            probeData = null;\n            Log.e(this.TAG, 'Non-FLV, Unsupported media type!');\n            Promise.resolve().then(() => {\n                this._internalAbort();\n            });\n            this._emitter.emit(TransmuxingEvents.DEMUX_ERROR, DemuxErrors.FORMAT_UNSUPPORTED, 'Non-FLV, Unsupported media type');\n        }\n\n        return probeData != null ? probeData.consumed : 0;\n    }\n\n    _onMediaInfo(mediaInfo) {\n        if (this._mediaInfo == null) {\n            // Store first segment's mediainfo as global mediaInfo\n            this._mediaInfo = Object.assign({}, mediaInfo);\n            this._mediaInfo.keyframesIndex = null;\n            this._mediaInfo.segments = [];\n            this._mediaInfo.segmentCount = this._mediaDataSource.segments.length;\n            Object.setPrototypeOf(this._mediaInfo, MediaInfo.prototype);\n\n            let exportInfo = Object.assign({}, this._mediaInfo);\n            delete exportInfo.segments;\n            delete exportInfo.keyframesIndex;\n            this._emitter.emit(TransmuxingEvents.MEDIA_INFO, exportInfo);\n        }\n\n        if (this._mediaInfo.segments[this._currentSegmentIndex] == undefined) {\n            let segmentInfo = Object.assign({}, mediaInfo);\n            Object.setPrototypeOf(segmentInfo, MediaInfo.prototype);\n\n            this._mediaInfo.segments[this._currentSegmentIndex] = segmentInfo;\n        }\n\n        if (this._pendingSeekTime != null) {\n            Promise.resolve().then(() => {\n                let target = this._pendingSeekTime;\n                this._pendingSeekTime = null;\n                this.seek(target);\n            });\n        }\n    }\n\n    _onIOSeeked() {\n        this._remuxer.insertDiscontinuity();\n    }\n\n    _onIOComplete(extraData) {\n        let segmentIndex = extraData;\n        let nextSegmentIndex = segmentIndex + 1;\n\n        if (nextSegmentIndex < this._mediaDataSource.segments.length) {\n            this._internalAbort();\n            this._loadSegment(nextSegmentIndex);\n        } else {\n            this._emitter.emit(TransmuxingEvents.LOADING_COMPLETE);\n        }\n    }\n\n    _onIORecoveredEarlyEof() {\n        this._emitter.emit(TransmuxingEvents.RECOVERED_EARLY_EOF);\n    }\n\n    _onIOException(type, info) {\n        Log.e(this.TAG, `IOException: type = ${type}, code = ${info.code}, msg = ${info.msg}`);\n        this._emitter.emit(TransmuxingEvents.IO_ERROR, type, info);\n    }\n\n    _onDemuxException(type, info) {\n        Log.e(this.TAG, `DemuxException: type = ${type}, info = ${info}`);\n        this._emitter.emit(TransmuxingEvents.DEMUX_ERROR, type, info);\n    }\n\n    _onRemuxerInitSegmentArrival(type, initSegment) {\n        this._emitter.emit(TransmuxingEvents.INIT_SEGMENT, type, initSegment);\n    }\n\n    _onRemuxerMediaSegmentArrival(type, mediaSegment) {\n        if (this._pendingSeekTime != null) {\n            // Media segments after new-segment cross-seeking should be dropped.\n            return;\n        }\n        this._emitter.emit(TransmuxingEvents.MEDIA_SEGMENT, type, mediaSegment);\n\n        if (this._pendingResolveSeekPoint != null && type === 'video') {\n            let syncPoints = mediaSegment.info.syncPoints;\n            let seekpoint = this._pendingResolveSeekPoint;\n            this._pendingResolveSeekPoint = null;\n\n            // Safari: Pass PTS for recommend_seekpoint\n            if (Browser.safari && syncPoints.length > 0 && syncPoints[0].originalDts === seekpoint) {\n                seekpoint = syncPoints[0].pts;\n            }\n            // else: use original DTS (keyframe.milliseconds)\n\n            this._emitter.emit(TransmuxingEvents.RECOMMEND_SEEKPOINT, seekpoint);\n        }\n\n        if (type === 'video') {\n            this._reportStatisticsInfo();\n        }\n    }\n\n    _reportStatisticsInfo() {\n        let info = {};\n        info.url = this._ioctl.currentUrl;\n        info.speed = this._ioctl.currentSpeed;\n        info.loaderType = this._ioctl.loaderType;\n        info.currentSegmentIndex = this._currentSegmentIndex;\n        info.totalSegmentCount = this._mediaDataSource.segments.length;\n\n        this._emitter.emit(TransmuxingEvents.STATISTICS_INFO, info);\n    }\n\n}\n\nexport default TransmuxingController;","const TransmuxingEvents = {\n    IO_ERROR: 'io_error',\n    DEMUX_ERROR: 'demux_error',\n    INIT_SEGMENT: 'init_segment',\n    MEDIA_SEGMENT: 'media_segment',\n    LOADING_COMPLETE: 'loading_complete',\n    RECOVERED_EARLY_EOF: 'recovered_early_eof',\n    MEDIA_INFO: 'media_info',\n    STATISTICS_INFO: 'statistics_info',\n    RECOMMEND_SEEKPOINT: 'recommend_seekpoint'\n};\n\nexport default TransmuxingEvents;","import Log from '../utils/logger.js';\nimport LoggingControl from '../utils/logging-control.js';\nimport Polyfill from '../utils/polyfill.js';\nimport TransmuxingController from './transmuxing-controller.js';\nimport TransmuxingEvents from './transmuxing-events.js';\n\n/* post message to worker:\n   data: {\n       cmd: string\n       param: any\n   }\n\n   post message from worker inside:\n   data: {\n       msg: string,\n       data: any\n   }\n */\n\nlet TransmuxingWorker = function (self) {\n\n    let TAG = 'TransmuxingWorker';\n    let controller = null;\n\n    Polyfill.install();\n\n    self.addEventListener('message', function (e) {\n        switch (e.data.cmd) {\n            case 'init':\n                controller = new TransmuxingController(e.data.param[0], e.data.param[1]);\n                controller.on(TransmuxingEvents.IO_ERROR, onIOError.bind(this));\n                controller.on(TransmuxingEvents.DEMUX_ERROR, onDemuxError.bind(this));\n                controller.on(TransmuxingEvents.INIT_SEGMENT, onInitSegment.bind(this));\n                controller.on(TransmuxingEvents.MEDIA_SEGMENT, onMediaSegment.bind(this));\n                controller.on(TransmuxingEvents.LOADING_COMPLETE, onLoadingComplete.bind(this));\n                controller.on(TransmuxingEvents.RECOVERED_EARLY_EOF, onRecoveredEarlyEof.bind(this));\n                controller.on(TransmuxingEvents.MEDIA_INFO, onMediaInfo.bind(this));\n                controller.on(TransmuxingEvents.STATISTICS_INFO, onStatisticsInfo.bind(this));\n                controller.on(TransmuxingEvents.RECOMMEND_SEEKPOINT, onRecommendSeekpoint.bind(this));\n                break;\n            case 'destroy':\n                if (controller) {\n                    controller.destroy();\n                    controller = null;\n                }\n                self.postMessage({msg: 'destroyed'});\n                break;\n            case 'start':\n                controller.start();\n                break;\n            case 'stop':\n                controller.stop();\n                break;\n            case 'seek':\n                controller.seek(e.data.param);\n                break;\n            case 'pause':\n                controller.pause();\n                break;\n            case 'resume':\n                controller.resume();\n                break;\n            case 'logging_config':\n                LoggingControl.applyConfig(e.data.param);\n                break;\n        }\n    });\n\n    function onInitSegment(type, initSegment) {\n        let obj = {\n            msg: TransmuxingEvents.INIT_SEGMENT,\n            data: {\n                type: type,\n                data: initSegment\n            }\n        };\n        self.postMessage(obj, [initSegment.data]);  // data: ArrayBuffer\n    }\n\n    function onMediaSegment(type, mediaSegment) {\n        let obj = {\n            msg: TransmuxingEvents.MEDIA_SEGMENT,\n            data: {\n                type: type,\n                data: mediaSegment\n            }\n        };\n        self.postMessage(obj, [mediaSegment.data]);  // data: ArrayBuffer\n    }\n\n    function onLoadingComplete() {\n        let obj = {\n            msg: TransmuxingEvents.LOADING_COMPLETE\n        };\n        self.postMessage(obj);\n    }\n\n    function onRecoveredEarlyEof() {\n        let obj = {\n            msg: TransmuxingEvents.RECOVERED_EARLY_EOF\n        };\n        self.postMessage(obj);\n    }\n\n    function onMediaInfo(mediaInfo) {\n        let obj = {\n            msg: TransmuxingEvents.MEDIA_INFO,\n            data: mediaInfo\n        };\n        self.postMessage(obj);\n    }\n\n    function onStatisticsInfo(statInfo) {\n        let obj = {\n            msg: TransmuxingEvents.STATISTICS_INFO,\n            data: statInfo\n        };\n        self.postMessage(obj);\n    }\n\n    function onIOError(type, info) {\n        self.postMessage({\n            msg: TransmuxingEvents.IO_ERROR,\n            data: {\n                type: type,\n                info: info\n            }\n        });\n    }\n\n    function onDemuxError(type, info) {\n        self.postMessage({\n            msg: TransmuxingEvents.DEMUX_ERROR,\n            data: {\n                type: type,\n                info: info\n            }\n        });\n    }\n\n    function onRecommendSeekpoint(milliseconds) {\n        self.postMessage({\n            msg: TransmuxingEvents.RECOMMEND_SEEKPOINT,\n            data: milliseconds\n        });\n    }\n\n};\n\nexport default TransmuxingWorker;","import Log from '../utils/logger.js';\nimport decodeUTF8 from '../utils/utf8-conv.js';\nimport {IllegalStateException} from '../utils/exception.js';\n\nlet le = (function () {\n    let buf = new ArrayBuffer(2);\n    (new DataView(buf)).setInt16(0, 256, true);  // little-endian write\n    return (new Int16Array(buf))[0] === 256;  // platform-spec read, if equal then LE\n})();\n\nclass AMF {\n\n    static parseScriptData(arrayBuffer, dataOffset, dataSize) {\n        let data = {};\n\n        try {\n            let name = AMF.parseValue(arrayBuffer, dataOffset, dataSize);\n            let value = AMF.parseValue(arrayBuffer, dataOffset + name.size, dataSize - name.size);\n\n            data[name.data] = value.data;\n        } catch (e) {\n            Log.e('AMF', e.toString());\n        }\n\n        return data;\n    }\n\n    static parseObject(arrayBuffer, dataOffset, dataSize) {\n        if (dataSize < 3) {\n            throw new IllegalStateException('Data not enough when parse ScriptDataObject');\n        }\n        let name = AMF.parseString(arrayBuffer, dataOffset, dataSize);\n        let value = AMF.parseValue(arrayBuffer, dataOffset + name.size, dataSize - name.size);\n        let isObjectEnd = value.objectEnd;\n\n        return {\n            data: {\n                name: name.data,\n                value: value.data\n            },\n            size: name.size + value.size,\n            objectEnd: isObjectEnd\n        };\n    }\n\n    static parseVariable(arrayBuffer, dataOffset, dataSize) {\n        return AMF.parseObject(arrayBuffer, dataOffset, dataSize);\n    }\n\n    static parseString(arrayBuffer, dataOffset, dataSize) {\n        if (dataSize < 2) {\n            throw new IllegalStateException('Data not enough when parse String');\n        }\n        let v = new DataView(arrayBuffer, dataOffset, dataSize);\n        let length = v.getUint16(0, !le);\n\n        let str;\n        if (length > 0) {\n            str = decodeUTF8(new Uint8Array(arrayBuffer, dataOffset + 2, length));\n        } else {\n            str = '';\n        }\n\n        return {\n            data: str,\n            size: 2 + length\n        };\n    }\n\n    static parseLongString(arrayBuffer, dataOffset, dataSize) {\n        if (dataSize < 4) {\n            throw new IllegalStateException('Data not enough when parse LongString');\n        }\n        let v = new DataView(arrayBuffer, dataOffset, dataSize);\n        let length = v.getUint32(0, !le);\n\n        let str;\n        if (length > 0) {\n            str = decodeUTF8(new Uint8Array(arrayBuffer, dataOffset + 4, length));\n        } else {\n            str = '';\n        }\n\n        return {\n            data: str,\n            size: 4 + length\n        };\n    }\n\n    static parseDate(arrayBuffer, dataOffset, dataSize) {\n        if (dataSize < 10) {\n            throw new IllegalStateException('Data size invalid when parse Date');\n        }\n        let v = new DataView(arrayBuffer, dataOffset, dataSize);\n        let timestamp = v.getFloat64(0, !le);\n        let localTimeOffset = v.getInt16(8, !le);\n        timestamp += localTimeOffset * 60 * 1000;  // get UTC time\n\n        return {\n            data: new Date(timestamp),\n            size: 8 + 2\n        };\n    }\n\n    static parseValue(arrayBuffer, dataOffset, dataSize) {\n        if (dataSize < 1) {\n            throw new IllegalStateException('Data not enough when parse Value');\n        }\n\n        let v = new DataView(arrayBuffer, dataOffset, dataSize);\n\n        let offset = 1;\n        let type = v.getUint8(0);\n        let value;\n        let objectEnd = false;\n\n        try {\n            switch (type) {\n                case 0:  // Number(Double) type\n                    value = v.getFloat64(1, !le);\n                    offset += 8;\n                    break;\n                case 1: {  // Boolean type\n                    let b = v.getUint8(1);\n                    value = b ? true : false;\n                    offset += 1;\n                    break;\n                }\n                case 2: {  // String type\n                    let amfstr = AMF.parseString(arrayBuffer, dataOffset + 1, dataSize - 1);\n                    value = amfstr.data;\n                    offset += amfstr.size;\n                    break;\n                }\n                case 3: { // Object(s) type\n                    value = {};\n                    let terminal = 0;  // workaround for malformed Objects which has missing ScriptDataObjectEnd\n                    if ((v.getUint32(dataSize - 4, !le) & 0x00FFFFFF) === 9) {\n                        terminal = 3;\n                    }\n                    while (offset < dataSize - 4) {  // 4 === type(UI8) + ScriptDataObjectEnd(UI24)\n                        let amfobj = AMF.parseObject(arrayBuffer, dataOffset + offset, dataSize - offset - terminal);\n                        if (amfobj.objectEnd)\n                            break;\n                        value[amfobj.data.name] = amfobj.data.value;\n                        offset += amfobj.size;\n                    }\n                    if (offset <= dataSize - 3) {\n                        let marker = v.getUint32(offset - 1, !le) & 0x00FFFFFF;\n                        if (marker === 9) {\n                            offset += 3;\n                        }\n                    }\n                    break;\n                }\n                case 8: { // ECMA array type (Mixed array)\n                    value = {};\n                    offset += 4;  // ECMAArrayLength(UI32)\n                    let terminal = 0;  // workaround for malformed MixedArrays which has missing ScriptDataObjectEnd\n                    if ((v.getUint32(dataSize - 4, !le) & 0x00FFFFFF) === 9) {\n                        terminal = 3;\n                    }\n                    while (offset < dataSize - 8) {  // 8 === type(UI8) + ECMAArrayLength(UI32) + ScriptDataVariableEnd(UI24)\n                        let amfvar = AMF.parseVariable(arrayBuffer, dataOffset + offset, dataSize - offset - terminal);\n                        if (amfvar.objectEnd)\n                            break;\n                        value[amfvar.data.name] = amfvar.data.value;\n                        offset += amfvar.size;\n                    }\n                    if (offset <= dataSize - 3) {\n                        let marker = v.getUint32(offset - 1, !le) & 0x00FFFFFF;\n                        if (marker === 9) {\n                            offset += 3;\n                        }\n                    }\n                    break;\n                }\n                case 9:  // ScriptDataObjectEnd\n                    value = undefined;\n                    offset = 1;\n                    objectEnd = true;\n                    break;\n                case 10: {  // Strict array type\n                    // ScriptDataValue[n]. NOTE: according to video_file_format_spec_v10_1.pdf\n                    value = [];\n                    let strictArrayLength = v.getUint32(1, !le);\n                    offset += 4;\n                    for (let i = 0; i < strictArrayLength; i++) {\n                        let val = AMF.parseValue(arrayBuffer, dataOffset + offset, dataSize - offset);\n                        value.push(val.data);\n                        offset += val.size;\n                    }\n                    break;\n                }\n                case 11: {  // Date type\n                    let date = AMF.parseDate(arrayBuffer, dataOffset + 1, dataSize - 1);\n                    value = date.data;\n                    offset += date.size;\n                    break;\n                }\n                case 12: {  // Long string type\n                    let amfLongStr = AMF.parseString(arrayBuffer, dataOffset + 1, dataSize - 1);\n                    value = amfLongStr.data;\n                    offset += amfLongStr.size;\n                    break;\n                }\n                default:\n                    // ignore and skip\n                    offset = dataSize;\n                    Log.w('AMF', 'Unsupported AMF value type ' + type);\n            }\n        } catch (e) {\n            Log.e('AMF', e.toString());\n        }\n\n        return {\n            data: value,\n            size: offset,\n            objectEnd: objectEnd\n        };\n    }\n\n}\n\nexport default AMF;","const DemuxErrors = {\n    OK: 'OK',\n    FORMAT_ERROR: 'FormatError',\n    FORMAT_UNSUPPORTED: 'FormatUnsupported',\n    CODEC_UNSUPPORTED: 'CodecUnsupported'\n};\n\nexport default DemuxErrors;","import {IllegalStateException, InvalidArgumentException} from '../utils/exception.js';\n\n// Exponential-Golomb buffer decoder\n\nclass ExpGolomb {\n\n    constructor(uint8array) {\n        this.TAG = this.constructor.name;\n\n        this._buffer = uint8array;\n        this._buffer_index = 0;\n        this._total_bytes = uint8array.byteLength;\n        this._total_bits = uint8array.byteLength * 8;\n        this._current_word = 0;\n        this._current_word_bits_left = 0;\n    }\n\n    destroy() {\n        this._buffer = null;\n    }\n\n    _fillCurrentWord() {\n        let buffer_bytes_left = this._total_bytes - this._buffer_index;\n        if (buffer_bytes_left <= 0)\n            throw new IllegalStateException('ExpGolomb: _fillCurrentWord() but no bytes available');\n\n        let bytes_read = Math.min(4, buffer_bytes_left);\n        let word = new Uint8Array(4);\n        word.set(this._buffer.subarray(this._buffer_index, this._buffer_index + bytes_read));\n        this._current_word = new DataView(word.buffer).getUint32(0, false);\n\n        this._buffer_index += bytes_read;\n        this._current_word_bits_left = bytes_read * 8;\n    }\n\n    readBits(bits) {\n        if (bits > 32)\n            throw new InvalidArgumentException('ExpGolomb: readBits() bits exceeded max 32bits!');\n\n        if (bits <= this._current_word_bits_left) {\n            let result = this._current_word >>> (32 - bits);\n            this._current_word <<= bits;\n            this._current_word_bits_left -= bits;\n            return result;\n        }\n\n        let result = this._current_word_bits_left ? this._current_word : 0;\n        result = result >>> (32 - this._current_word_bits_left);\n        let bits_need_left = bits - this._current_word_bits_left;\n\n        this._fillCurrentWord();\n        let bits_read_next = Math.min(bits_need_left, this._current_word_bits_left);\n\n        let result2 = this._current_word >>> (32 - bits_read_next);\n        this._current_word <<= bits_read_next;\n        this._current_word_bits_left -= bits_read_next;\n\n        result = (result << bits_read_next) | result2;\n        return result;\n    }\n\n    readBool() {\n        return this.readBits(1) === 1;\n    }\n\n    readByte() {\n        return this.readBits(8);\n    }\n\n    _skipLeadingZero() {\n        let zero_count;\n        for (zero_count = 0; zero_count < this._current_word_bits_left; zero_count++) {\n            if (0 !== (this._current_word & (0x80000000 >>> zero_count))) {\n                this._current_word <<= zero_count;\n                this._current_word_bits_left -= zero_count;\n                return zero_count;\n            }\n        }\n        this._fillCurrentWord();\n        return zero_count + this._skipLeadingZero();\n    }\n\n    readUEG() {  // unsigned exponential golomb\n        let leading_zeros = this._skipLeadingZero();\n        return this.readBits(leading_zeros + 1) - 1;\n    }\n\n    readSEG() {  // signed exponential golomb\n        let value = this.readUEG();\n        if (value & 0x01) {\n            return (value + 1) >>> 1;\n        } else {\n            return -1 * (value >>> 1);\n        }\n    }\n\n}\n\nexport default ExpGolomb;","import Log from '../utils/logger.js';\nimport AMF from './amf-parser.js';\nimport BSearch from '../utils/bsearch.js';\nimport SPSParser from './sps-parser.js';\nimport DemuxErrors from './demux-errors.js';\nimport MediaInfo from '../core/media-info.js';\nimport {IllegalStateException} from '../utils/exception.js';\n\nfunction Swap16(src) {\n    return (((src >>> 8) & 0xFF) |\n            ((src & 0xFF) << 8));\n}\n\nfunction Swap32(src) {\n    return (((src & 0xFF000000) >>> 24) |\n            ((src & 0x00FF0000) >>> 8)  |\n            ((src & 0x0000FF00) << 8)   |\n            ((src & 0x000000FF) << 24));\n}\n\nfunction ReadBig32(array, index) {\n    return ((array[index] << 24)     |\n            (array[index + 1] << 16) |\n            (array[index + 2] << 8)  |\n            (array[index + 3]));\n}\n\n\nclass FLVDemuxer {\n\n    constructor(probeData, config) {\n        this.TAG = this.constructor.name;\n\n        this._config = config;\n\n        this._onError = null;\n        this._onMediaInfo = null;\n        this._onTrackMetadata = null;\n        this._onDataAvailable = null;\n\n        this._dataOffset = probeData.dataOffset;\n        this._firstParse = true;\n        this._dispatch = false;\n\n        this._hasAudio = probeData.hasAudioTrack;\n        this._hasVideo = probeData.hasVideoTrack;\n\n        this._audioInitialMetadataDispatched = false;\n        this._videoInitialMetadataDispatched = false;\n\n        this._mediaInfo = new MediaInfo();\n        this._mediaInfo.hasAudio = this._hasAudio;\n        this._mediaInfo.hasVideo = this._hasVideo;\n        this._metadata = null;\n        this._audioMetadata = null;\n        this._videoMetadata = null;\n\n        this._naluLengthSize = 4;\n        this._timestampBase = 0;  // int32, in milliseconds\n        this._timescale = 1000;\n        this._duration = 0;  // int32, in milliseconds\n        this._durationOverrided = false;\n        this._referenceFrameRate = {\n            fixed: true,\n            fps: 23.976,\n            fps_num: 23976,\n            fps_den: 1000\n        };\n\n        this._videoTrack = {type: 'video', id: 1, sequenceNumber: 0, samples: [], length: 0};\n        this._audioTrack = {type: 'audio', id: 2, sequenceNumber: 0, samples: [], length: 0};\n\n        this._littleEndian = (function () {\n            let buf = new ArrayBuffer(2);\n            (new DataView(buf)).setInt16(0, 256, true);  // little-endian write\n            return (new Int16Array(buf))[0] === 256;  // platform-spec read, if equal then LE\n        })();\n    }\n\n    destroy() {\n        this._mediaInfo = null;\n        this._metadata = null;\n        this._audioMetadata = null;\n        this._videoMetadata = null;\n        this._videoTrack = null;\n        this._audioTrack = null;\n\n        this._onError = null;\n        this._onMediaInfo = null;\n        this._onTrackMetadata = null;\n        this._onDataAvailable = null;\n    }\n\n    static probe(buffer) {\n        let data = new Uint8Array(buffer);\n        let mismatch = {match: false};\n\n        if (data[0] !== 0x46 || data[1] !== 0x4C || data[2] !== 0x56 || data[3] !== 0x01) {\n            return mismatch;\n        }\n\n        let hasAudio = ((data[4] & 4) >>> 2) !== 0;\n        let hasVideo = (data[4] & 1) !== 0;\n\n        if (!hasAudio && !hasVideo) {\n            return mismatch;\n        }\n\n        let offset = ReadBig32(data, 5);\n\n        if (offset < 9) {\n            return mismatch;\n        }\n\n        return {\n            match: true,\n            consumed: offset,\n            dataOffset: offset,\n            hasAudioTrack: hasAudio,\n            hasVideoTrack: hasVideo\n        };\n    }\n\n    bindDataSource(loader) {\n        loader.onDataArrival = this.parseChunks.bind(this);\n        return this;\n    }\n\n    // prototype: function(type: string, metadata: any): void\n    get onTrackMetadata() {\n        return this._onTrackMetadata;\n    }\n\n    set onTrackMetadata(callback) {\n        this._onTrackMetadata = callback;\n    }\n\n    // prototype: function(mediaInfo: MediaInfo): void\n    get onMediaInfo() {\n        return this._onMediaInfo;\n    }\n\n    set onMediaInfo(callback) {\n        this._onMediaInfo = callback;\n    }\n\n    // prototype: function(type: number, info: string): void\n    get onError() {\n        return this._onError;\n    }\n\n    set onError(callback) {\n        this._onError = callback;\n    }\n\n    // prototype: function(videoTrack: any, audioTrack: any): void\n    get onDataAvailable() {\n        return this._onDataAvailable;\n    }\n\n    set onDataAvailable(callback) {\n        this._onDataAvailable = callback;\n    }\n\n    // timestamp base for output samples, must be in milliseconds\n    get timestampBase() {\n        return this._timestampBase;\n    }\n\n    set timestampBase(base) {\n        this._timestampBase = base;\n    }\n\n    get overridedDuration() {\n        return this._duration;\n    }\n\n    // Force-override media duration. Must be in milliseconds, int32\n    set overridedDuration(duration) {\n        this._durationOverrided = true;\n        this._duration = duration;\n        this._mediaInfo.duration = duration;\n    }\n\n    _isInitialMetadataDispatched() {\n        if (this._hasAudio && this._hasVideo) {  // both audio & video\n            return this._audioInitialMetadataDispatched && this._videoInitialMetadataDispatched;\n        }\n        if (this._hasAudio && !this._hasVideo) {  // audio only\n            return this._audioInitialMetadataDispatched;\n        }\n        if (!this._hasAudio && this._hasVideo) {  // video only\n            return this._videoInitialMetadataDispatched;\n        }\n    }\n\n    // function parseChunks(chunk: ArrayBuffer, byteStart: number): number;\n    parseChunks(chunk, byteStart) {\n        if (!this._onError || !this._onMediaInfo || !this._onTrackMetadata || !this._onDataAvailable) {\n            throw new IllegalStateException('Flv: onError & onMediaInfo & onTrackMetadata & onDataAvailable callback must be specified');\n        }\n\n        let offset = 0;\n        let le = this._littleEndian;\n\n        if (this._firstParse) {  // handle PreviousTagSize0 before Tag1\n            this._firstParse = false;\n            if (byteStart !== this._dataOffset) {\n                Log.w(this.TAG, 'First time parsing but chunk byteStart invalid!');\n            }\n\n            let v = new DataView(chunk);\n            let prevTagSize0 = v.getUint32(0, !le);\n            if (prevTagSize0 !== 0) {\n                Log.w(this.TAG, 'PrevTagSize0 !== 0 !!!');\n            }\n            offset += 4;\n        }\n\n        while (offset < chunk.byteLength) {\n            this._dispatch = true;\n\n            let v = new DataView(chunk, offset);\n\n            if (offset + 11 + 4 > chunk.byteLength) {\n                // data not enough for parsing an flv tag\n                break;\n            }\n\n            let tagType = v.getUint8(0);\n            let dataSize = v.getUint32(0, !le) & 0x00FFFFFF;\n\n            if (offset + 11 + dataSize + 4 > chunk.byteLength) {\n                // data not enough for parsing actual data body\n                break;\n            }\n\n            if (tagType !== 8 && tagType !== 9 && tagType !== 18) {\n                Log.w(this.TAG, `Unsupported tag type ${tagType}, skipped`);\n                // consume the whole tag (skip it)\n                offset += 11 + dataSize + 4;\n                continue;\n            }\n\n            let ts2 = v.getUint8(4);\n            let ts1 = v.getUint8(5);\n            let ts0 = v.getUint8(6);\n            let ts3 = v.getUint8(7);\n\n            let timestamp = ts0 | (ts1 << 8) | (ts2 << 16) | (ts3 << 24);\n\n            let streamId = v.getUint32(7, !le) & 0x00FFFFFF;\n            if (streamId !== 0) {\n                Log.w(this.TAG, 'Meet tag which has StreamID != 0!');\n            }\n\n            let dataOffset = offset + 11;\n\n            switch (tagType) {\n                case 8:  // Audio\n                    this._parseAudioData(chunk, dataOffset, dataSize, timestamp);\n                    break;\n                case 9:  // Video\n                    this._parseVideoData(chunk, dataOffset, dataSize, timestamp, byteStart + offset);\n                    break;\n                case 18:  // ScriptDataObject\n                    this._parseScriptData(chunk, dataOffset, dataSize);\n                    break;\n            }\n\n            let prevTagSize = v.getUint32(11 + dataSize, !le);\n            if (prevTagSize !== 11 + dataSize) {\n                Log.w(this.TAG, `Invalid PrevTagSize ${prevTagSize}`);\n            }\n\n            offset += 11 + dataSize + 4;  // tagBody + dataSize + prevTagSize\n        }\n\n        // dispatch parsed frames to consumer (typically, the remuxer)\n        if (this._isInitialMetadataDispatched()) {\n            if (this._dispatch && (this._audioTrack.length || this._videoTrack.length)) {\n                this._onDataAvailable(this._audioTrack, this._videoTrack);\n            }\n        }\n\n        return offset;  // consumed bytes, just equals latest offset index\n    }\n\n    _parseScriptData(arrayBuffer, dataOffset, dataSize) {\n        let scriptData = AMF.parseScriptData(arrayBuffer, dataOffset, dataSize);\n\n        if (scriptData.hasOwnProperty('onMetaData')) {\n            if (this._metadata) {\n                Log.w(this.TAG, 'Found another onMetaData tag!');\n            }\n            this._metadata = scriptData;\n            let onMetaData = this._metadata.onMetaData;\n\n            if (typeof onMetaData.hasAudio === 'boolean') {  // hasAudio\n                this._hasAudio = onMetaData.hasAudio;\n                this._mediaInfo.hasAudio = this._hasAudio;\n            }\n            if (typeof onMetaData.hasVideo === 'boolean') {  // hasVideo\n                this._hasVideo = onMetaData.hasVideo;\n                this._mediaInfo.hasVideo = this._hasVideo;\n            }\n            if (typeof onMetaData.audiodatarate === 'number') {  // audiodatarate\n                this._mediaInfo.audioDataRate = onMetaData.audiodatarate;\n            }\n            if (typeof onMetaData.videodatarate === 'number') {  // videodatarate\n                this._mediaInfo.videoDataRate = onMetaData.videodatarate;\n            }\n            if (typeof onMetaData.width === 'number') {  // width\n                this._mediaInfo.width = onMetaData.width;\n            }\n            if (typeof onMetaData.height === 'number') {  // height\n                this._mediaInfo.height = onMetaData.height;\n            }\n            if (typeof onMetaData.duration === 'number') {  // duration\n                if (!this._durationOverrided) {\n                    let duration = Math.floor(onMetaData.duration * this._timescale);\n                    this._duration = duration;\n                    this._mediaInfo.duration = duration;\n                }\n            } else {\n                this._mediaInfo.duration = 0;\n            }\n            if (typeof onMetaData.framerate === 'number') {  // framerate\n                let fps_num = Math.floor(onMetaData.framerate * 1000);\n                if (fps_num > 0) {\n                    let fps = fps_num / 1000;\n                    this._referenceFrameRate.fixed = true;\n                    this._referenceFrameRate.fps = fps;\n                    this._referenceFrameRate.fps_num = fps_num;\n                    this._referenceFrameRate.fps_den = 1000;\n                    this._mediaInfo.fps = fps;\n                }\n            }\n            if (typeof onMetaData.keyframes === 'object') {  // keyframes\n                this._mediaInfo.hasKeyframesIndex = true;\n                let keyframes = onMetaData.keyframes;\n                this._mediaInfo.keyframesIndex = this._parseKeyframesIndex(keyframes);\n                onMetaData.keyframes = null;  // keyframes has been extracted, remove it\n            } else {\n                this._mediaInfo.hasKeyframesIndex = false;\n            }\n            this._dispatch = false;\n            this._mediaInfo.metadata = onMetaData;\n            Log.v(this.TAG, 'Parsed onMetaData');\n            if (this._mediaInfo.isComplete()) {\n                this._onMediaInfo(this._mediaInfo);\n            }\n        }\n    }\n\n    _parseKeyframesIndex(keyframes) {\n        let times = [];\n        let filepositions = [];\n\n        // ignore first keyframe which is actually AVC Sequence Header (AVCDecoderConfigurationRecord)\n        for (let i = 1; i < keyframes.times.length; i++) {\n            let time = this._timestampBase + Math.floor(keyframes.times[i] * 1000);\n            times.push(time);\n            filepositions.push(keyframes.filepositions[i]);\n        }\n\n        return {\n            times: times,\n            filepositions: filepositions\n        };\n    }\n\n    _parseAudioData(arrayBuffer, dataOffset, dataSize, tagTimestamp) {\n        if (dataSize <= 1) {\n            Log.w(this.TAG, 'Flv: Invalid audio packet, missing SoundData payload!');\n            return;\n        }\n\n        let meta = this._audioMetadata;\n        let track = this._audioTrack;\n\n        if (!meta || !meta.codec) {\n            // initial metadata\n            meta = this._audioMetadata = {};\n            meta.type = 'audio';\n            meta.id = track.id;\n            meta.timescale = this._timescale;\n            meta.duration = this._duration;\n\n            let le = this._littleEndian;\n            let v = new DataView(arrayBuffer, dataOffset, dataSize);\n\n            let soundSpec = v.getUint8(0);\n\n            let soundFormat = soundSpec >>> 4;\n            if (soundFormat !== 10) {  // AAC\n                // TODO: support MP3 audio codec\n                this._onError(DemuxErrors.CODEC_UNSUPPORTED, 'Flv: Unsupported audio codec idx: ' + soundFormat);\n                return;\n            }\n\n            let soundRate = 0;\n            let soundRateIndex = (soundSpec & 12) >>> 2;\n\n            let soundRateTable = [5500, 11025, 22050, 44100, 48000];\n\n            if (soundRateIndex < soundRateTable.length) {\n                soundRate = soundRateTable[soundRateIndex];\n            } else {\n                this._onError(DemuxErrors.FORMAT_ERROR, 'Flv: Invalid audio sample rate idx: ' + soundRateIndex);\n                return;\n            }\n\n            let soundSize = (soundSpec & 2) >>> 1;  // unused\n            let soundType = (soundSpec & 1);\n\n            meta.audioSampleRate = soundRate;\n            meta.channelCount = (soundType === 0 ? 1 : 2);\n            meta.refSampleDuration = Math.floor(1024 / meta.audioSampleRate * meta.timescale);\n            meta.codec = 'mp4a.40.5';\n        }\n\n        let aacData = this._parseAACAudioData(arrayBuffer, dataOffset + 1, dataSize - 1);\n        if (aacData == undefined) {\n            return;\n        }\n\n        if (aacData.packetType === 0) {  // AAC sequence header (AudioSpecificConfig)\n            if (meta.config) {\n                Log.w(this.TAG, 'Found another AudioSpecificConfig!');\n            }\n            let misc = aacData.data;\n            meta.audioSampleRate = misc.samplingRate;\n            meta.channelCount = misc.channelCount;\n            meta.codec = misc.codec;\n            meta.config = misc.config;\n            // The decode result of an aac sample is 1024 PCM samples\n            meta.refSampleDuration = Math.floor(1024 / meta.audioSampleRate * meta.timescale);\n            Log.v(this.TAG, 'Parsed AudioSpecificConfig');\n\n            if (this._isInitialMetadataDispatched()) {\n                // Non-initial metadata, force dispatch (or flush) parsed frames to remuxer\n                if (this._dispatch && (this._audioTrack.length || this._videoTrack.length)) {\n                    this._onDataAvailable(this._audioTrack, this._videoTrack);\n                }\n            } else {\n                this._audioInitialMetadataDispatched = true;\n            }\n            // then notify new metadata\n            this._dispatch = false;\n            this._onTrackMetadata('audio', meta);\n\n            let mi = this._mediaInfo;\n            mi.audioCodec = 'mp4a.40.' + misc.originalAudioObjectType;\n            mi.audioSampleRate = meta.audioSampleRate;\n            mi.audioChannelCount = meta.channelCount;\n            if (mi.hasVideo) {\n                if (mi.videoCodec != null) {\n                    mi.mimeType = 'video/x-flv; codecs=\"' + mi.videoCodec + ',' + mi.audioCodec + '\"';\n                }\n            } else {\n                mi.mimeType = 'video/x-flv; codecs=\"' + mi.audioCodec + '\"';\n            }\n            if (mi.isComplete()) {\n                this._onMediaInfo(mi);\n            }\n            return;\n        } else if (aacData.packetType === 1) {  // AAC raw frame data\n            let dts = this._timestampBase + tagTimestamp;\n            let aacSample = {unit: aacData.data, dts: dts, pts: dts};\n            track.samples.push(aacSample);\n            track.length += aacData.data.length;\n        } else {\n            Log.e(this.TAG, `Flv: Unsupported AAC data type ${aacData.packetType}`);\n        }\n    }\n\n    _parseAACAudioData(arrayBuffer, dataOffset, dataSize) {\n        if (dataSize <= 1) {\n            Log.w(this.TAG, 'Flv: Invalid AAC packet, missing AACPacketType or/and Data!');\n            return;\n        }\n\n        let result = {};\n        let array = new Uint8Array(arrayBuffer, dataOffset, dataSize);\n\n        result.packetType = array[0];\n\n        if (array[0] === 0) {\n            result.data = this._parseAACAudioSpecificConfig(arrayBuffer, dataOffset + 1, dataSize - 1);\n        } else {\n            result.data = array.subarray(1);\n        }\n\n        return result;\n    }\n\n    _parseAACAudioSpecificConfig(arrayBuffer, dataOffset, dataSize) {\n        let array = new Uint8Array(arrayBuffer, dataOffset, dataSize);\n        let config = null;\n\n        let mpegSamplingRates = [\n            96000, 88200, 64000, 48000, 44100, 32000,\n            24000, 22050, 16000, 12000, 11025, 8000, 7350\n        ];\n\n        /* Audio Object Type:\n           0: Null\n           1: AAC Main\n           2: AAC LC\n           3: AAC SSR (Scalable Sample Rate)\n           4: AAC LTP (Long Term Prediction)\n           5: HE-AAC / SBR (Spectral Band Replication)\n           6: AAC Scalable\n        */\n\n        let audioObjectType = 0;\n        let originalAudioObjectType = 0;\n        let audioExtensionObjectType = null;\n        let samplingIndex = 0;\n        let extensionSamplingIndex = null;\n\n        // 5 bits\n        audioObjectType = originalAudioObjectType = array[0] >>> 3;\n        // 4 bits\n        samplingIndex = ((array[0] & 0x07) << 1) | (array[1] >>> 7);\n        if (samplingIndex < 0 || samplingIndex >= mpegSamplingRates.length) {\n            this._onError(DemuxErrors.FORMAT_ERROR, 'Flv: AAC invalid sampling frequency index!');\n            return;\n        }\n\n        let samplingFrequence = mpegSamplingRates[samplingIndex];\n\n        // 4 bits\n        let channelConfig = (array[1] & 0x78) >>> 3;\n        if (channelConfig < 0 || channelConfig >= 8) {\n            this._onError(DemuxErrors.FORMAT_ERROR, 'Flv: AAC invalid channel configuration');\n            return;\n        }\n\n        if (audioObjectType === 5) {  // HE-AAC?\n            // 4 bits\n            extensionSamplingIndex = ((array[1] & 0x07) << 1) | (array[2] >>> 7);\n            // 5 bits\n            audioExtensionObjectType = (array[2] & 0x7C) >>> 2;\n        }\n\n        // workarounds for various browsers\n        let userAgent = self.navigator.userAgent.toLowerCase();\n\n        if (userAgent.indexOf('firefox') !== -1) {\n            // firefox: use SBR (HE-AAC) if freq less than 24kHz\n            if (samplingIndex >= 6) {\n                audioObjectType = 5;\n                config = new Array(4);\n                extensionSamplingIndex = samplingIndex - 3;\n            } else {  // use LC-AAC\n                audioObjectType = 2;\n                config = new Array(2);\n                extensionSamplingIndex = samplingIndex;\n            }\n        } else if (userAgent.indexOf('android') !== -1) {\n            // android: always use LC-AAC\n            audioObjectType = 2;\n            config = new Array(2);\n            extensionSamplingIndex = samplingIndex;\n        } else {\n            // for other browsers, e.g. chrome...\n            // Always use HE-AAC to make it easier to switch aac codec profile\n            audioObjectType = 5;\n            extensionSamplingIndex = samplingIndex;\n            config = new Array(4);\n\n            if (samplingIndex >= 6) {\n                extensionSamplingIndex = samplingIndex - 3;\n            } else if (channelConfig === 1) {  // Mono channel\n                audioObjectType = 2;\n                config = new Array(2);\n                extensionSamplingIndex = samplingIndex;\n            }\n        }\n\n        config[0]  = audioObjectType << 3;\n        config[0] |= (samplingIndex & 0x0F) >>> 1;\n        config[1]  = (samplingIndex & 0x0F) << 7;\n        config[1] |= (channelConfig & 0x0F) << 3;\n        if (audioObjectType === 5) {\n            config[1] |= ((extensionSamplingIndex & 0x0F) >>> 1);\n            config[2]  = (extensionSamplingIndex & 0x01) << 7;\n            // extended audio object type: force to 2 (LC-AAC)\n            config[2] |= (2 << 2);\n            config[3]  = 0;\n        }\n\n        return {\n            config: config,\n            samplingRate: samplingFrequence,\n            channelCount: channelConfig,\n            codec: 'mp4a.40.' + audioObjectType,\n            originalAudioObjectType: originalAudioObjectType\n        };\n    }\n\n    _parseVideoData(arrayBuffer, dataOffset, dataSize, tagTimestamp, tagPosition) {\n        if (dataSize <= 1) {\n            Log.w(this.TAG, 'Flv: Invalid video packet, missing VideoData payload!');\n            return;\n        }\n\n        let spec = (new Uint8Array(arrayBuffer, dataOffset, dataSize))[0];\n\n        let frameType = (spec & 240) >>> 4;\n        let codecId = spec & 15;\n\n        if (codecId !== 7) {\n            this._onError(DemuxErrors.CODEC_UNSUPPORTED, `Flv: Unsupported codec in video frame: ${codecId}`);\n            return;\n        }\n\n        this._parseAVCVideoPacket(arrayBuffer, dataOffset + 1, dataSize - 1, tagTimestamp, tagPosition, frameType);\n    }\n\n    _parseAVCVideoPacket(arrayBuffer, dataOffset, dataSize, tagTimestamp, tagPosition, frameType) {\n        if (dataSize < 4) {\n            Log.w(this.TAG, 'Flv: Invalid AVC packet, missing AVCPacketType or/and CompositionTime');\n            return;\n        }\n\n        let le = this._littleEndian;\n        let v = new DataView(arrayBuffer, dataOffset, dataSize);\n\n        let packetType = v.getUint8(0);\n        let cts = v.getUint32(0, !le) & 0x00FFFFFF;\n\n        if (packetType === 0) {  // AVCDecoderConfigurationRecord\n            this._parseAVCDecoderConfigurationRecord(arrayBuffer, dataOffset + 4, dataSize - 4);\n        } else if (packetType === 1) {  // One or more Nalus\n            this._parseAVCVideoData(arrayBuffer, dataOffset + 4, dataSize - 4, tagTimestamp, tagPosition, frameType, cts);\n        } else if (packetType === 2) {\n            // empty, AVC end of sequence\n        } else {\n            this._onError(DemuxErrors.FORMAT_ERROR, `Flv: Invalid video packet type ${packetType}`);\n            return;\n        }\n    }\n\n    _parseAVCDecoderConfigurationRecord(arrayBuffer, dataOffset, dataSize) {\n        if (dataSize < 7) {\n            Log.w(this.TAG, 'Flv: Invalid AVCDecoderConfigurationRecord, lack of data!');\n            return;\n        }\n\n        let meta = this._videoMetadata;\n        let track = this._videoTrack;\n        let le = this._littleEndian;\n        let v = new DataView(arrayBuffer, dataOffset, dataSize);\n\n        if (!meta) {\n            meta = this._videoMetadata = {};\n            meta.type = 'video';\n            meta.id = track.id;\n            meta.timescale = this._timescale;\n            meta.duration = this._duration;\n        } else {\n            if (typeof meta.avcc !== 'undefined') {\n                Log.w(this.TAG, 'Found another AVCDecoderConfigurationRecord!');\n            }\n        }\n\n        let version = v.getUint8(0);  // configurationVersion\n        let avcProfile = v.getUint8(1);  // avcProfileIndication\n        let profileCompatibility = v.getUint8(2);  // profile_compatibility\n        let avcLevel = v.getUint8(3);  // AVCLevelIndication\n\n        if (version !== 1 || avcProfile === 0) {\n            this._onError(DemuxErrors.FORMAT_ERROR, 'Flv: Invalid AVCDecoderConfigurationRecord');\n            return;\n        }\n\n        this._naluLengthSize = (v.getUint8(4) & 3) + 1;  // lengthSizeMinusOne\n        if (this._naluLengthSize !== 3 && this._naluLengthSize !== 4) {  // holy shit!!!\n            this._onError(DemuxErrors.FORMAT_ERROR, `Flv: Strange NaluLengthSizeMinusOne: ${this._naluLengthSize - 1}`);\n            return;\n        }\n\n        let spsCount = v.getUint8(5) & 31;  // numOfSequenceParameterSets\n        if (spsCount === 0 || spsCount > 1) {\n            this._onError(DemuxErrors.FORMAT_ERROR, `Flv: Invalid H264 SPS count: ${spsCount}`);\n            return;\n        }\n\n        let offset = 6;\n\n        for (let i = 0; i < spsCount; i++) {\n            let len = v.getUint16(offset, !le);  // sequenceParameterSetLength\n            offset += 2;\n\n            if (len === 0) {\n                continue;\n            }\n\n            // Notice: Nalu without startcode header (00 00 00 01)\n            let sps = new Uint8Array(arrayBuffer, dataOffset + offset, len);\n            offset += len;\n\n            let config = SPSParser.parseSPS(sps);\n            meta.codecWidth = config.codec_size.width;\n            meta.codecHeight = config.codec_size.height;\n            meta.presentWidth = config.present_size.width;\n            meta.presentHeight = config.present_size.height;\n\n            meta.profile = config.profile_string;\n            meta.level = config.level_string;\n            meta.bitDepth = config.bit_depth;\n            meta.chromaFormat = config.chroma_format;\n            meta.sarRatio = config.sar_ratio;\n            meta.frameRate = config.frame_rate;\n\n            if (config.frame_rate.fixed === false ||\n                config.frame_rate.fps_num === 0 ||\n                config.frame_rate.fps_den === 0) {\n                meta.frameRate = this._referenceFrameRate;\n            }\n\n            let fps_den = meta.frameRate.fps_den;\n            let fps_num = meta.frameRate.fps_num;\n            meta.refSampleDuration = Math.floor(meta.timescale * (fps_den / fps_num));\n\n            let codecArray = sps.subarray(1, 4);\n            let codecString = 'avc1.';\n            for (let j = 0; j < 3; j++) {\n                let h = codecArray[j].toString(16);\n                if (h.length < 2) {\n                    h = '0' + h;\n                }\n                codecString += h;\n            }\n            meta.codec = codecString;\n\n            let mi = this._mediaInfo;\n            mi.width = meta.codecWidth;\n            mi.height = meta.codecHeight;\n            mi.fps = meta.frameRate.fps;\n            mi.profile = meta.profile;\n            mi.level = meta.level;\n            mi.chromaFormat = config.chroma_format_string;\n            mi.sarNum = meta.sarRatio.width;\n            mi.sarDen = meta.sarRatio.height;\n            mi.videoCodec = codecString;\n\n            if (mi.hasAudio) {\n                if (mi.audioCodec != null) {\n                    mi.mimeType = 'video/x-flv; codecs=\"' + mi.videoCodec + ',' + mi.audioCodec + '\"';\n                }\n            } else {\n                mi.mimeType = 'video/x-flv; codecs=\"' + mi.videoCodec + '\"';\n            }\n            if (mi.isComplete()) {\n                this._onMediaInfo(mi);\n            }\n        }\n\n        let ppsCount = v.getUint8(offset);  // numOfPictureParameterSets\n        if (ppsCount === 0 || ppsCount > 1) {\n            this._onError(DemuxErrors.FORMAT_ERROR, `Flv: Invalid H264 PPS count: ${ppsCount}`);\n            return;\n        }\n\n        offset++;\n\n        for (let i = 0; i < ppsCount; i++) {\n            let len = v.getUint16(offset, !le);  // pictureParameterSetLength\n            offset += 2;\n\n            if (len === 0) {\n                continue;\n            }\n\n            // pps is useless for extracting video information\n            offset += len;\n        }\n\n        meta.avcc = new Uint8Array(dataSize);\n        meta.avcc.set(new Uint8Array(arrayBuffer, dataOffset, dataSize), 0);\n        Log.v(this.TAG, 'Parsed AVCDecoderConfigurationRecord');\n\n        if (this._isInitialMetadataDispatched()) {\n            // flush parsed frames\n            if (this._dispatch && (this._audioTrack.length || this._videoTrack.length)) {\n                this._onDataAvailable(this._audioTrack, this._videoTrack);\n            }\n        } else {\n            this._videoInitialMetadataDispatched = true;\n        }\n        // notify new metadata\n        this._dispatch = false;\n        this._onTrackMetadata('video', meta);\n    }\n\n    _parseAVCVideoData(arrayBuffer, dataOffset, dataSize, tagTimestamp, tagPosition, frameType, cts) {\n        let le = this._littleEndian;\n        let v = new DataView(arrayBuffer, dataOffset, dataSize);\n\n        let units = [], length = 0;\n\n        let offset = 0;\n        const lengthSize = this._naluLengthSize;\n        let dts = this._timestampBase + tagTimestamp;\n        let keyframe = (frameType === 1);  // from FLV Frame Type constants\n\n        while (offset < dataSize) {\n            if (offset + 4 >= dataSize) {\n                Log.w(this.TAG, `Malformed Nalu near timestamp ${dts}, offset = ${offset}, dataSize = ${dataSize}`);\n                break;  // data not enough for next Nalu\n            }\n            // Nalu with length-header (AVC1)\n            let naluSize = v.getUint32(offset, !le);  // Big-Endian read\n            if (lengthSize === 3) {\n                naluSize >>>= 8;\n            }\n            if (naluSize > dataSize - lengthSize) {\n                Log.w(this.TAG, `Malformed Nalus near timestamp ${dts}, NaluSize > DataSize!`);\n                return;\n            }\n\n            let unitType = v.getUint8(offset + lengthSize) & 0x1F;\n\n            if (unitType === 5) {  // IDR\n                keyframe = true;\n            }\n\n            let data = new Uint8Array(arrayBuffer, dataOffset + offset, lengthSize + naluSize);\n            let unit = {type: unitType, data: data};\n            units.push(unit);\n            length += data.byteLength;\n\n            offset += lengthSize + naluSize;\n        }\n\n        if (units.length) {\n            let track = this._videoTrack;\n            let avcSample = {\n                units: units,\n                length: length,\n                isKeyframe: keyframe,\n                dts: dts,\n                cts: cts,\n                pts: (dts + cts)\n            };\n            if (keyframe) {\n                avcSample.fileposition = tagPosition;\n            }\n            track.samples.push(avcSample);\n            track.length += length;\n        }\n    }\n\n}\n\nexport default FLVDemuxer;","import ExpGolomb from './exp-golomb.js';\n\nclass SPSParser {\n\n    static _ebsp2rbsp(uint8array) {\n        let src = uint8array;\n        let src_length = src.byteLength;\n        let dst = new Uint8Array(src_length);\n        let dst_idx = 0;\n\n        for (let i = 0; i < src_length; i++) {\n            if (i >= 2) {\n                // Unescape: Skip 0x03 after 00 00\n                if (src[i] === 0x03 && src[i - 1] === 0x00 && src[i - 2] === 0x00) {\n                    continue;\n                }\n            }\n            dst[dst_idx] = src[i];\n            dst_idx++;\n        }\n\n        return new Uint8Array(dst.buffer, 0, dst_idx);\n    }\n\n    static parseSPS(uint8array) {\n        let rbsp = SPSParser._ebsp2rbsp(uint8array);\n        let gb = new ExpGolomb(rbsp);\n\n        gb.readByte();\n        let profile_idc = gb.readByte();  // profile_idc\n        gb.readByte();  // constraint_set_flags[5] + reserved_zero[3]\n        let level_idc = gb.readByte();  // level_idc\n        gb.readUEG();  // seq_parameter_set_id\n\n        let profile_string = SPSParser.getProfileString(profile_idc);\n        let level_string = SPSParser.getLevelString(level_idc);\n        let chroma_format_idc = 1;\n        let chroma_format = 420;\n        let chroma_format_table = [0, 420, 422, 444];\n        let bit_depth = 8;\n\n        if (profile_idc === 100 || profile_idc === 110 || profile_idc === 122 ||\n            profile_idc === 244 || profile_idc === 44 || profile_idc === 83 ||\n            profile_idc === 86 || profile_idc === 118 || profile_idc === 128 ||\n            profile_idc === 138 || profile_idc === 144) {\n\n            chroma_format_idc = gb.readUEG();\n            if (chroma_format_idc === 3) {\n                gb.readBits(1);  // separate_colour_plane_flag\n            }\n            if (chroma_format_idc <= 3) {\n                chroma_format = chroma_format_table[chroma_format_idc];\n            }\n\n            bit_depth = gb.readUEG() + 8;  // bit_depth_luma_minus8\n            gb.readUEG();  // bit_depth_chroma_minus8\n            gb.readBits(1);  // qpprime_y_zero_transform_bypass_flag\n            if (gb.readBool()) {  // seq_scaling_matrix_present_flag\n                let scaling_list_count = (chroma_format_idc !== 3) ? 8 : 12;\n                for (let i = 0; i < scaling_list_count; i++) {\n                    if (gb.readBool()) {  // seq_scaling_list_present_flag\n                        if (i < 6) {\n                            SPSParser._skipScalingList(gb, 16);\n                        } else {\n                            SPSParser._skipScalingList(gb, 64);\n                        }\n                    }\n                }\n            }\n        }\n        gb.readUEG();  // log2_max_frame_num_minus4\n        let pic_order_cnt_type = gb.readUEG();\n        if (pic_order_cnt_type === 0) {\n            gb.readUEG();  // log2_max_pic_order_cnt_lsb_minus_4\n        } else if (pic_order_cnt_type === 1) {\n            gb.readBits(1);  // delta_pic_order_always_zero_flag\n            gb.readSEG();  // offset_for_non_ref_pic\n            gb.readSEG();  // offset_for_top_to_bottom_field\n            let num_ref_frames_in_pic_order_cnt_cycle = gb.readUEG();\n            for (let i = 0; i < num_ref_frames_in_pic_order_cnt_cycle; i++) {\n                gb.readSEG();  // offset_for_ref_frame\n            }\n        }\n        gb.readUEG();  // max_num_ref_frames\n        gb.readBits(1);  // gaps_in_frame_num_value_allowed_flag\n\n        let pic_width_in_mbs_minus1 = gb.readUEG();\n        let pic_height_in_map_units_minus1 = gb.readUEG();\n\n        let frame_mbs_only_flag = gb.readBits(1);\n        if (frame_mbs_only_flag === 0) {\n            gb.readBits(1);  // mb_adaptive_frame_field_flag\n        }\n        gb.readBits(1);  // direct_8x8_inference_flag\n\n        let frame_crop_left_offset = 0;\n        let frame_crop_right_offset = 0;\n        let frame_crop_top_offset = 0;\n        let frame_crop_bottom_offset = 0;\n\n        let frame_cropping_flag = gb.readBool();\n        if (frame_cropping_flag) {\n            frame_crop_left_offset = gb.readUEG();\n            frame_crop_right_offset = gb.readUEG();\n            frame_crop_top_offset = gb.readUEG();\n            frame_crop_bottom_offset = gb.readUEG();\n        }\n\n        let sar_width = 1, sar_height = 1;\n        let fps = 0, fps_fixed = true, fps_num = 0, fps_den = 0;\n\n        let vui_parameters_present_flag = gb.readBool();\n        if (vui_parameters_present_flag) {\n            if (gb.readBool()) {  // aspect_ratio_info_present_flag\n                let aspect_ratio_idc = gb.readByte();\n                let sar_w_table = [1, 12, 10, 16, 40, 24, 20, 32, 80, 18, 15, 64, 160, 4, 3, 2];\n                let sar_h_table = [1, 11, 11, 11, 33, 11, 11, 11, 33, 11, 11, 33,  99, 3, 2, 1];\n\n                if (aspect_ratio_idc > 0 && aspect_ratio_idc < 16) {\n                    sar_width = sar_w_table[aspect_ratio_idc - 1];\n                    sar_height = sar_h_table[aspect_ratio_idc - 1];\n                } else if (aspect_ratio_idc === 255) {\n                    sar_width = gb.readByte() << 8 | gb.readByte();\n                    sar_height = gb.readByte() << 8 | gb.readByte();\n                }\n            }\n\n            if (gb.readBool()) {  // overscan_info_present_flag\n                gb.readBool();  // overscan_appropriate_flag\n            }\n            if (gb.readBool()) {  // video_signal_type_present_flag\n                gb.readBits(4);  // video_format & video_full_range_flag\n                if (gb.readBool()) {  // colour_description_present_flag\n                    gb.readBits(24);  // colour_primaries & transfer_characteristics & matrix_coefficients\n                }\n            }\n            if (gb.readBool()) {  // chroma_loc_info_present_flag\n                gb.readUEG();  // chroma_sample_loc_type_top_field\n                gb.readUEG();  // chroma_sample_loc_type_bottom_field\n            }\n            if (gb.readBool()) {  // timing_info_present_flag\n                let num_units_in_tick = gb.readBits(32);\n                let time_scale = gb.readBits(32);\n                fps_fixed = gb.readBool();  // fixed_frame_rate_flag\n\n                fps_num = time_scale;\n                fps_den = num_units_in_tick * 2;\n                fps = fps_num / fps_den;\n            }\n        }\n\n        let sarScale = 1;\n        if (sar_width !== 1 || sar_height !== 1) {\n            sarScale = sar_width / sar_height;\n        }\n\n        let crop_unit_x = 0, crop_unit_y = 0;\n        if (chroma_format_idc === 0) {\n            crop_unit_x = 1;\n            crop_unit_y = 2 - frame_mbs_only_flag;\n        } else {\n            let sub_wc = (chroma_format_idc === 3) ? 1 : 2;\n            let sub_hc = (chroma_format_idc === 1) ? 2 : 1;\n            crop_unit_x = sub_wc;\n            crop_unit_y = sub_hc * (2 - frame_mbs_only_flag);\n        }\n\n        let codec_width = (pic_width_in_mbs_minus1 + 1) * 16;\n        let codec_height = (2 - frame_mbs_only_flag) * ((pic_height_in_map_units_minus1 + 1) * 16);\n\n        codec_width -= (frame_crop_left_offset + frame_crop_right_offset) * crop_unit_x;\n        codec_height -= (frame_crop_top_offset + frame_crop_bottom_offset) * crop_unit_y;\n\n        let present_width = Math.ceil(codec_width * sarScale);\n\n        gb.destroy();\n        gb = null;\n\n        return {\n            profile_string: profile_string,  // baseline, high, high10, ...\n            level_string: level_string,  // 3, 3.1, 4, 4.1, 5, 5.1, ...\n            bit_depth: bit_depth,  // 8bit, 10bit, ...\n            chroma_format: chroma_format,  // 4:2:0, 4:2:2, ...\n            chroma_format_string: SPSParser.getChromaFormatString(chroma_format),\n\n            frame_rate: {\n                fixed: fps_fixed,\n                fps: fps,\n                fps_den: fps_den,\n                fps_num: fps_num\n            },\n\n            sar_ratio: {\n                width: sar_width,\n                height: sar_height\n            },\n\n            codec_size: {\n                width: codec_width,\n                height: codec_height\n            },\n\n            present_size: {\n                width: present_width,\n                height: codec_height\n            }\n        };\n    }\n\n    static _skipScalingList(gb, count) {\n        let last_scale = 8, next_scale = 8;\n        let delta_scale = 0;\n        for (let i = 0; i < count; i++) {\n            if (next_scale !== 0) {\n                delta_scale = gb.readSEG();\n                next_scale = (last_scale + delta_scale + 256) % 256;\n            }\n            last_scale = (next_scale === 0) ? last_scale : next_scale;\n        }\n    }\n\n    static getProfileString(profile_idc) {\n        switch (profile_idc) {\n            case 66:\n                return 'Baseline';\n            case 77:\n                return 'Main';\n            case 88:\n                return 'Extended';\n            case 100:\n                return 'High';\n            case 110:\n                return 'High10';\n            case 122:\n                return 'High422';\n            case 244:\n                return 'High444';\n            default:\n                return 'Unknown';\n        }\n    }\n\n    static getLevelString(level_idc) {\n        return (level_idc / 10).toFixed(1);\n    }\n\n    static getChromaFormatString(chroma) {\n        switch (chroma) {\n            case 420:\n                return '4:2:0';\n            case 422:\n                return '4:2:2';\n            case 444:\n                return '4:4:4';\n            default:\n                return 'Unknown';\n        }\n    }\n\n}\n\nexport default SPSParser;","import Polyfill from './utils/polyfill.js';\nimport Features from './core/features.js';\nimport FlvPlayer from './player/flv-player.js';\nimport NativePlayer from './player/native-player.js';\nimport PlayerEvents from './player/player-events.js';\nimport {ErrorTypes, ErrorDetails} from './player/player-errors.js';\nimport LoggingControl from './utils/logging-control.js';\nimport {InvalidArgumentException} from './utils/exception.js';\n\n// entry/index file\n\n// install polyfills\nPolyfill.install();\n\n\n// factory method\nfunction createPlayer(mediaDataSource, optionalConfig) {\n    let mds = mediaDataSource;\n    if (mds == null || typeof mds !== 'object') {\n        throw new InvalidArgumentException('MediaDataSource must be an javascript object!');\n    }\n\n    if (!mds.hasOwnProperty('type')) {\n        throw new InvalidArgumentException('MediaDataSource must has type field to indicate video file type!');\n    }\n\n    switch (mds.type) {\n        case 'flv':\n            return new FlvPlayer(mds, optionalConfig);\n        default:\n            return new NativePlayer(mds, optionalConfig);\n    }\n}\n\n\n// feature detection\nfunction isSupported() {\n    return Features.supportMSEH264Playback();\n}\n\nfunction getFeatureList() {\n    return Features.getFeatureList();\n}\n\n\n// interfaces\nlet flvjs = {};\n\nflvjs.createPlayer = createPlayer;\nflvjs.isSupported = isSupported;\nflvjs.getFeatureList = getFeatureList;\n\nflvjs.Events = PlayerEvents;\nflvjs.ErrorTypes = ErrorTypes;\nflvjs.ErrorDetails = ErrorDetails;\n\nflvjs.FlvPlayer = FlvPlayer;\nflvjs.NativePlayer = NativePlayer;\nflvjs.LoggingControl = LoggingControl;\n\n\n// export interfaces to global context\nwindow.flvjs = flvjs;\nexport default flvjs;","import Log from '../utils/logger.js';\nimport Browser from '../utils/browser.js';\nimport {BaseLoader, LoaderStatus, LoaderErrors} from './loader.js';\nimport {RuntimeException} from '../utils/exception.js';\n\n/* fetch + stream IO loader. Currently working on chrome 43+.\n * fetch provides a better alternative http API to XMLHttpRequest\n *\n * fetch spec   https://fetch.spec.whatwg.org/\n * stream spec  https://streams.spec.whatwg.org/\n */\nclass FetchStreamLoader extends BaseLoader {\n\n    static isSupported() {\n        try {\n            // fetch + stream is broken on Microsoft Edge. Disable for now.\n            // see https://developer.microsoft.com/en-us/microsoft-edge/platform/issues/8196907/\n            return (self.fetch && self.ReadableStream && !Browser.msedge);\n        } catch (e) {\n            return false;\n        }\n    }\n\n    constructor(seekHandler) {\n        super('fetch-stream-loader');\n        this.TAG = this.constructor.name;\n\n        this._seekHandler = seekHandler;\n        this._needStash = true;\n\n        this._requestAbort = false;\n        this._contentLength = null;\n        this._receivedLength = 0;\n    }\n\n    destroy() {\n        if (this.isWorking()) {\n            this.abort();\n        }\n        super.destroy();\n    }\n\n    open(dataSource, range) {\n        this._dataSource = dataSource;\n        this._range = range;\n\n        let seekConfig = this._seekHandler.getConfig(dataSource.url, range);\n\n        let headers = new self.Headers();\n\n        if (typeof seekConfig.headers === 'object') {\n            let configHeaders = seekConfig.headers;\n            for (let key in configHeaders) {\n                if (configHeaders.hasOwnProperty(key)) {\n                    headers.append(key, configHeaders[key]);\n                }\n            }\n        }\n\n        let url = seekConfig.url;\n        let params = {\n            method: 'GET',\n            headers: headers,\n            mode: 'cors',\n            cache: 'default'\n        };\n\n        // cors is enabled by default\n        if (dataSource.cors === false) {\n            // no-cors means 'disregard cors policy', which can only be used in ServiceWorker\n            params.mode = 'same-origin';\n        }\n\n        // withCredentials is disabled by default\n        if (dataSource.withCredentials) {\n            params.credentials = 'include';\n        }\n\n        this._status = LoaderStatus.kConnecting;\n        self.fetch(url, params).then((res) => {\n            if (this._requestAbort) {\n                this._requestAbort = false;\n                this._status = LoaderStatus.kIdle;\n                return;\n            }\n            if (res.ok && (res.status >= 200 && res.status <= 299)) {\n                let lengthHeader = res.headers.get('Content-Length');\n                if (lengthHeader != null) {\n                    this._contentLength = parseInt(lengthHeader);\n                    if (this._contentLength !== 0) {\n                        if (this._onContentLengthKnown) {\n                            this._onContentLengthKnown(this._contentLength);\n                        }\n                    }\n                }\n                return this._pump.call(this, res.body.getReader());\n            } else {\n                this._status = LoaderStatus.kError;\n                if (this._onError) {\n                    this._onError(LoaderErrors.HTTP_STATUS_CODE_INVALID, {code: res.status, msg: res.statusText});\n                } else {\n                    throw new RuntimeException('FetchStreamLoader: Http code invalid, ' + res.status + ' ' + res.statusText);\n                }\n            }\n        }).catch((e) => {\n            this._status = LoaderStatus.kError;\n            if (this._onError) {\n                this._onError(LoaderErrors.EXCEPTION, {code: -1, msg: e.message});\n            } else {\n                throw e;\n            }\n        });\n    }\n\n    abort() {\n        this._requestAbort = true;\n    }\n\n    _pump(reader) {  // ReadableStreamReader\n        return reader.read().then((result) => {\n            if (result.done) {\n                this._status = LoaderStatus.kComplete;\n                if (this._onComplete) {\n                    this._onComplete(this._range.from, this._range.from + this._receivedLength - 1);\n                }\n            } else {\n                if (this._requestAbort === true) {\n                    this._requestAbort = false;\n                    this._status = LoaderStatus.kComplete;\n                    return reader.cancel();\n                }\n\n                this._status = LoaderStatus.kBuffering;\n\n                let chunk = result.value.buffer;\n                let byteStart = this._range.from + this._receivedLength;\n                this._receivedLength += chunk.byteLength;\n\n                if (this._onDataArrival) {\n                    this._onDataArrival(chunk, byteStart, this._receivedLength);\n                }\n\n                return this._pump(reader);\n            }\n        }).catch((e) => {\n            this._status = LoaderStatus.kError;\n            let type = 0;\n            let info = null;\n\n            if (e.code === 19 && // NETWORK_ERR\n                (this._contentLength === null ||\n                (this._contentLength !== null && this._receivedLength < this._contentLength))) {\n                type = LoaderErrors.EARLY_EOF;\n                info = {code: e.code, msg: 'Fetch stream meet Early-EOF'};\n            } else {\n                type = LoaderErrors.EXCEPTION;\n                info = {code: e.code, msg: e.message};\n            }\n\n            if (this._onError) {\n                this._onError(type, info);\n            } else {\n                throw new RuntimeException(info.msg);\n            }\n        });\n    }\n\n}\n\nexport default FetchStreamLoader;","import Log from '../utils/logger.js';\nimport SpeedSampler from './speed-sampler.js';\nimport {LoaderStatus, LoaderErrors} from './loader.js';\nimport FetchStreamLoader from './fetch-stream-loader.js';\nimport MozChunkedLoader from './xhr-moz-chunked-loader.js';\nimport MSStreamLoader from './xhr-msstream-loader.js';\nimport RangeLoader from './xhr-range-loader.js';\nimport WebSocketLoader from './websocket-loader.js';\nimport RangeSeekHandler from './range-seek-handler.js';\nimport ParamSeekHandler from './param-seek-handler.js';\nimport {RuntimeException, IllegalStateException, InvalidArgumentException} from '../utils/exception.js';\n\n/**\n * DataSource: {\n *     url: string,\n *     filesize: number,\n *     cors: boolean,\n *     withCredentials: boolean\n * }\n * \n */\n\n// Manage IO Loaders\nclass IOController {\n\n    constructor(dataSource, config, extraData) {\n        this.TAG = this.constructor.name;\n\n        this._config = config;\n        this._extraData = extraData;\n\n        this._stashInitialSize = 1024 * 384;  // default initial size: 384KB\n        if (config.isLive === true) {\n            this._stashInitialSize = 1024 * 512;  // default live initial size: 512KB\n        }\n        if (config.stashInitialSize != undefined && config.stashInitialSize > 0) {\n            // apply from config\n            this._stashInitialSize = config.stashInitialSize;\n        }\n\n        this._stashUsed = 0;\n        this._stashSize = this._stashInitialSize;\n        this._bufferSize = 1024 * 1024 * 3;  // initial size: 3MB\n        this._stashBuffer = new ArrayBuffer(this._bufferSize);\n        this._stashByteStart = 0;\n        this._enableStash = true;\n        if (config.enableStashBuffer === false) {\n            this._enableStash = false;\n        }\n\n        this._loader = null;\n        this._loaderClass = null;\n        this._seekHandler = null;\n\n        this._dataSource = dataSource;\n        this._isWebSocketURL = /wss?:\\/\\/(.+?)\\//.test(dataSource.url);\n        this._refTotalLength = dataSource.filesize ? dataSource.filesize : null;\n        this._totalLength = this._refTotalLength;\n        this._fullRequestFlag = false;\n        this._currentRange = null;\n\n        this._speed = 0;\n        this._speedNormalized = 0;\n        this._speedSampler = new SpeedSampler();\n        this._speedNormalizeList = [64, 128, 256, 384, 512, 768, 1024, 1536, 2048, 3072, 4096];\n\n        this._isEarlyEofReconnecting = false;\n\n        this._paused = false;\n        this._resumeFrom = 0;\n\n        this._onDataArrival = null;\n        this._onSeeked = null;\n        this._onError = null;\n        this._onComplete = null;\n        this._onRecoveredEarlyEof = null;\n\n        this._selectSeekHandler();\n        this._selectLoader();\n        this._createLoader();\n    }\n\n    destroy() {\n        if (this._loader.isWorking()) {\n            this._loader.abort();\n        }\n        this._loader.destroy();\n        this._loader = null;\n        this._loaderClass = null;\n        this._dataSource = null;\n        this._stashBuffer = null;\n        this._stashUsed = this._stashSize = this._bufferSize = this._stashByteStart = 0;\n        this._currentRange = null;\n        this._speedSampler = null;\n\n        this._isEarlyEofReconnecting = false;\n\n        this._onDataArrival = null;\n        this._onSeeked = null;\n        this._onError = null;\n        this._onComplete = null;\n        this._onRecoveredEarlyEof = null;\n\n        this._extraData = null;\n    }\n\n    isWorking() {\n        return this._loader && this._loader.isWorking() && !this._paused;\n    }\n\n    isPaused() {\n        return this._paused;\n    }\n\n    get status() {\n        return this._loader.status;\n    }\n\n    get extraData() {\n        return this._extraData;\n    }\n\n    set extraData(data) {\n        this._extraData = data;\n    }\n\n    // prototype: function onDataArrival(chunks: ArrayBuffer, byteStart: number): number\n    get onDataArrival() {\n        return this._onDataArrival;\n    }\n\n    set onDataArrival(callback) {\n        this._onDataArrival = callback;\n    }\n\n    get onSeeked() {\n        return this._onSeeked;\n    }\n\n    set onSeeked(callback) {\n        this._onSeeked = callback;\n    }\n\n    // prototype: function onError(type: number, info: {code: number, msg: string}): void\n    get onError() {\n        return this._onError;\n    }\n\n    set onError(callback) {\n        this._onError = callback;\n    }\n\n    get onComplete() {\n        return this._onComplete;\n    }\n\n    set onComplete(callback) {\n        this._onComplete = callback;\n    }\n\n    get onRecoveredEarlyEof() {\n        return this._onRecoveredEarlyEof;\n    }\n\n    set onRecoveredEarlyEof(callback) {\n        this._onRecoveredEarlyEof = callback;\n    }\n\n    get currentUrl() {\n        return this._dataSource.url;\n    }\n\n    // in KB/s\n    get currentSpeed() {\n        if (this._loaderClass === RangeLoader) {\n            // this._speed is inaccuracy if loader is RangeLoader\n            return this._loader.currentSpeed;\n        }\n        return this._speed;\n    }\n\n    get loaderType() {\n        return this._loader.type;\n    }\n\n    _selectSeekHandler() {\n        let config = this._config;\n\n        if (config.seekType === 'range') {\n            this._seekHandler = new RangeSeekHandler(this._config.rangeLoadZeroStart);\n        } else if (config.seekType === 'param') {\n            let paramStart = config.seekParamStart || 'bstart';\n            let paramEnd = config.seekParamEnd || 'bend';\n\n            this._seekHandler = new ParamSeekHandler(paramStart, paramEnd);\n        } else if (config.seekType === 'custom') {\n            if (typeof config.customSeekHandler !== 'function') {\n                throw new InvalidArgumentException('Custom seekType specified in config but invalid customSeekHandler!');\n            }\n            this._seekHandler = new config.customSeekHandler();\n        } else {\n            throw new InvalidArgumentException(`Invalid seekType in config: ${config.seekType}`);\n        }\n    }\n\n    _selectLoader() {\n        if (this._isWebSocketURL) {\n            this._loaderClass = WebSocketLoader;\n        } else if (FetchStreamLoader.isSupported()) {\n            this._loaderClass = FetchStreamLoader;\n        } else if (MozChunkedLoader.isSupported()) {\n            this._loaderClass = MozChunkedLoader;\n        } else if (RangeLoader.isSupported()) {\n            this._loaderClass = RangeLoader;\n        } else {\n            throw new RuntimeException('Your browser doesn\\'t support xhr with arraybuffer responseType!');\n        }\n    }\n\n    _createLoader() {\n        this._loader = new this._loaderClass(this._seekHandler);\n        if (this._loader.needStashBuffer === false) {\n            this._enableStash = false;\n        }\n        this._loader.onContentLengthKnown = this._onContentLengthKnown.bind(this);\n        this._loader.onDataArrival = this._onLoaderChunkArrival.bind(this);\n        this._loader.onComplete = this._onLoaderComplete.bind(this);\n        this._loader.onError = this._onLoaderError.bind(this);\n    }\n\n    open(optionalFrom) {\n        this._currentRange = {from: 0, to: -1};\n        if (optionalFrom) {\n            this._currentRange.from = optionalFrom;\n        }\n\n        this._speedSampler.reset();\n        if (!optionalFrom) {\n            this._fullRequestFlag = true;\n        }\n\n        this._loader.open(this._dataSource, Object.assign({}, this._currentRange));\n    }\n\n    abort() {\n        this._loader.abort();\n\n        if (this._paused) {\n            this._paused = false;\n            this._resumeFrom = 0;\n        }\n    }\n\n    pause() {\n        if (this.isWorking()) {\n            this._loader.abort();\n\n            if (this._stashUsed !== 0) {\n                this._resumeFrom = this._stashByteStart;\n                this._currentRange.to = this._stashByteStart - 1;\n            } else {\n                this._resumeFrom = this._currentRange.to + 1;\n            }\n            this._stashUsed = 0;\n            this._stashByteStart = 0;\n            this._paused = true;\n        }\n    }\n\n    resume() {\n        if (this._paused) {\n            this._paused = false;\n            let bytes = this._resumeFrom;\n            this._resumeFrom = 0;\n            this._internalSeek(bytes, true);\n        }\n    }\n\n    seek(bytes) {\n        this._paused = false;\n        this._stashUsed = 0;\n        this._stashByteStart = 0;\n        this._internalSeek(bytes, true);\n    }\n\n    /**\n     * When seeking request is from media seeking, unconsumed stash data should be dropped\n     * However, stash data shouldn't be dropped if seeking requested from http reconnection\n     *\n     * @dropUnconsumed: Ignore and discard all unconsumed data in stash buffer\n     */\n    _internalSeek(bytes, dropUnconsumed) {\n        if (this._loader.isWorking()) {\n            this._loader.abort();\n        }\n\n        // dispatch & flush stash buffer before seek\n        this._flushStashBuffer(dropUnconsumed);\n\n        this._loader.destroy();\n        this._loader = null;\n\n        let requestRange = {from: bytes, to: -1};\n        this._currentRange = {from: requestRange.from, to: -1};\n\n        this._speed = 0;\n        this._speedSampler.reset();\n        this._stashSize = this._stashInitialSize;\n        this._createLoader();\n        this._loader.open(this._dataSource, requestRange);\n\n        if (this._onSeeked) {\n            this._onSeeked();\n        }\n    }\n\n    updateUrl(url) {\n        if (!url || typeof url !== 'string' || url.length === 0) {\n            throw new InvalidArgumentException('Url must be a non-empty string!');\n        }\n\n        this._dataSource.url = url;\n\n        // TODO: replace with new url\n    }\n\n    _expandBuffer(expectedBytes) {\n        let bufferNewSize = this._stashSize;\n        while (bufferNewSize + 1024 * 1024 * 1 < expectedBytes) {\n            bufferNewSize *= 2;\n        }\n\n        bufferNewSize += 1024 * 1024 * 1;  // bufferSize = stashSize + 1MB\n        if (bufferNewSize === this._bufferSize) {\n            return;\n        }\n\n        let newBuffer = new ArrayBuffer(bufferNewSize);\n\n        if (this._stashUsed > 0) {  // copy existing data into new buffer\n            let stashOldArray = new Uint8Array(this._stashBuffer, 0, this._stashUsed);\n            let stashNewArray = new Uint8Array(newBuffer, 0, bufferNewSize);\n            stashNewArray.set(stashOldArray, 0);\n        }\n\n        this._stashBuffer = newBuffer;\n        this._bufferSize = bufferNewSize;\n    }\n\n    _normalizeSpeed(input) {\n        let list = this._speedNormalizeList;\n        let last = list.length - 1;\n        let mid = 0;\n        let lbound = 0;\n        let ubound = last;\n\n        if (input < list[0]) {\n            return list[0];\n        }\n\n        // binary search\n        while (lbound <= ubound) {\n            mid = lbound + Math.floor((ubound - lbound) / 2);\n            if (mid === last || (input >= list[mid] && input < list[mid + 1])) {\n                return list[mid];\n            } else if (list[mid] < input) {\n                lbound = mid + 1;\n            } else {\n                ubound = mid - 1;\n            }\n        }\n    }\n\n    _adjustStashSize(normalized) {\n        let stashSizeKB = 0;\n\n        if (this._config.isLive) {\n            // live stream: always use single normalized speed for size of stashSizeKB\n            stashSizeKB = normalized;\n        } else {\n            if (normalized < 512) {\n                stashSizeKB = normalized;\n            } else if (normalized >= 512 && normalized <= 1024) {\n                stashSizeKB = Math.floor(normalized * 1.5);\n            } else {\n                stashSizeKB = normalized * 2;\n            }\n        }\n\n        if (stashSizeKB > 8192) {\n            stashSizeKB = 8192;\n        }\n\n        let bufferSize = stashSizeKB * 1024 + 1024 * 1024 * 1;  // stashSize + 1MB\n        if (this._bufferSize < bufferSize) {\n            this._expandBuffer(bufferSize);\n        }\n        this._stashSize = stashSizeKB * 1024;\n    }\n\n    _dispatchChunks(chunks, byteStart) {\n        this._currentRange.to = byteStart + chunks.byteLength - 1;\n        return this._onDataArrival(chunks, byteStart);\n    }\n\n    _onContentLengthKnown(contentLength) {\n        if (contentLength && this._fullRequestFlag) {\n            this._totalLength = contentLength;\n            this._fullRequestFlag = false;\n        }\n    }\n\n    _onLoaderChunkArrival(chunk, byteStart, receivedLength) {\n        if (!this._onDataArrival) {\n            throw new IllegalStateException('IOController: No existing consumer (onDataArrival) callback!');\n        }\n        if (this._paused) {\n            return;\n        }\n        if (this._isEarlyEofReconnecting) {\n            // Auto-reconnect for EarlyEof succeed, notify to upper-layer by callback\n            this._isEarlyEofReconnecting = false;\n            if (this._onRecoveredEarlyEof) {\n                this._onRecoveredEarlyEof();\n            }\n        }\n\n        this._speedSampler.addBytes(chunk.byteLength);\n\n        // adjust stash buffer size according to network speed dynamically\n        let KBps = this._speedSampler.lastSecondKBps;\n        if (KBps !== 0) {\n            this._speed = KBps;\n            let normalized = this._normalizeSpeed(KBps);\n            if (this._speedNormalized !== normalized) {\n                this._speedNormalized = normalized;\n                this._adjustStashSize(normalized);\n            }\n        }\n\n        if (!this._enableStash) {  // disable stash\n            if (this._stashUsed === 0) {\n                // dispatch chunk directly to consumer;\n                // check ret value (consumed bytes) and stash unconsumed to stashBuffer\n                let consumed = this._dispatchChunks(chunk, byteStart);\n                if (consumed < chunk.byteLength) {  // unconsumed data remain.\n                    let remain = chunk.byteLength - consumed;\n                    if (remain > this._bufferSize) {\n                        this._expandBuffer(remain);\n                    }\n                    let stashArray = new Uint8Array(this._stashBuffer, 0, this._bufferSize);\n                    stashArray.set(new Uint8Array(chunk, consumed), 0);\n                    this._stashUsed += remain;\n                    this._stashByteStart = byteStart + consumed;\n                }\n            } else {\n                // else: Merge chunk into stashBuffer, and dispatch stashBuffer to consumer.\n                if (this._stashUsed + chunk.byteLength > this._bufferSize) {\n                    this._expandBuffer(this._stashUsed + chunk.byteLength);\n                }\n                let stashArray = new Uint8Array(this._stashBuffer, 0, this._bufferSize);\n                stashArray.set(new Uint8Array(chunk), this._stashUsed);\n                this._stashUsed += chunk.byteLength;\n                let consumed = this._dispatchChunks(this._stashBuffer.slice(0, this._stashUsed), this._stashByteStart);\n                if (consumed < this._stashUsed && consumed > 0) {  // unconsumed data remain\n                    let remainArray = new Uint8Array(this._stashBuffer, consumed);\n                    stashArray.set(remainArray, 0);\n                }\n                this._stashUsed -= consumed;\n                this._stashByteStart += consumed;\n            }\n        } else {  // enable stash\n            if (this._stashUsed === 0 && this._stashByteStart === 0) {  // seeked? or init chunk?\n                // This is the first chunk after seek action\n                this._stashByteStart = byteStart;\n            }\n            if (this._stashUsed + chunk.byteLength <= this._stashSize) {\n                // just stash\n                let stashArray = new Uint8Array(this._stashBuffer, 0, this._stashSize);\n                stashArray.set(new Uint8Array(chunk), this._stashUsed);\n                this._stashUsed += chunk.byteLength;\n            } else {  // stashUsed + chunkSize > stashSize, size limit exceeded\n                let stashArray = new Uint8Array(this._stashBuffer, 0, this._bufferSize);\n                if (this._stashUsed > 0) {  // There're stash datas in buffer\n                    // dispatch the whole stashBuffer, and stash remain data\n                    // then append chunk to stashBuffer (stash)\n                    let buffer = this._stashBuffer.slice(0, this._stashUsed);\n                    let consumed = this._dispatchChunks(buffer, this._stashByteStart);\n                    if (consumed < buffer.byteLength) {\n                        if (consumed > 0) {\n                            let remainArray = new Uint8Array(buffer, consumed);\n                            stashArray.set(remainArray, 0);\n                            this._stashUsed = remainArray.byteLength;\n                            this._stashByteStart += consumed;\n                        }\n                    } else {\n                        this._stashUsed = 0;\n                        this._stashByteStart += consumed;\n                    }\n                    if (this._stashUsed + chunk.byteLength > this._bufferSize) {\n                        this._expandBuffer(this._stashUsed + chunk.byteLength);\n                        stashArray = new Uint8Array(this._stashBuffer, 0, this._bufferSize);\n                    }\n                    stashArray.set(new Uint8Array(chunk), this._stashUsed);\n                    this._stashUsed += chunk.byteLength;\n                } else {  // stash buffer empty, but chunkSize > stashSize (oh, holy shit)\n                    // dispatch chunk directly and stash remain data\n                    let consumed = this._dispatchChunks(chunk, byteStart);\n                    if (consumed < chunk.byteLength) {\n                        let remain = chunk.byteLength - consumed;\n                        if (remain > this._bufferSize) {\n                            this._expandBuffer(remain);\n                            stashArray = new Uint8Array(this._stashBuffer, 0, this._bufferSize);\n                        }\n                        stashArray.set(new Uint8Array(chunk, consumed), 0);\n                        this._stashUsed += remain;\n                        this._stashByteStart = byteStart + consumed;\n                    }\n                }\n            }\n        }\n    }\n\n    _flushStashBuffer(dropUnconsumed) {\n        if (this._stashUsed > 0) {\n            let buffer = this._stashBuffer.slice(0, this._stashUsed);\n            let consumed = this._dispatchChunks(buffer, this._stashByteStart);\n            let remain = buffer.byteLength - consumed;\n\n            if (consumed < buffer.byteLength) {\n                if (dropUnconsumed) {\n                    Log.w(this.TAG, `${remain} bytes unconsumed data remain when flush buffer, dropped`);\n                } else {\n                    if (consumed > 0) {\n                        let stashArray = new Uint8Array(this._stashBuffer, 0, this._bufferSize);\n                        let remainArray = new Uint8Array(buffer, consumed);\n                        stashArray.set(remainArray, 0);\n                        this._stashUsed = remainArray.byteLength;\n                        this._stashByteStart += consumed;\n                    }\n                    return 0;\n                }\n            }\n            this._stashUsed = 0;\n            this._stashByteStart = 0;\n            return remain;\n        }\n        return 0;\n    }\n\n    _onLoaderComplete(from, to) {\n        // Force-flush stash buffer, and drop unconsumed data\n        this._flushStashBuffer(true);\n\n        if (this._onComplete) {\n            this._onComplete(this._extraData);\n        }\n    }\n\n    _onLoaderError(type, data) {\n        Log.e(this.TAG, `Loader error, code = ${data.code}, msg = ${data.msg}`);\n\n        this._flushStashBuffer(false);\n\n        if (this._isEarlyEofReconnecting) {\n            // Auto-reconnect for EarlyEof failed, throw UnrecoverableEarlyEof error to upper-layer\n            this._isEarlyEofReconnecting = false;\n            type = LoaderErrors.UNRECOVERABLE_EARLY_EOF;\n        }\n\n        switch (type) {\n            case LoaderErrors.EARLY_EOF: {\n                if (!this._config.isLive) {\n                    // Do internal http reconnect if not live stream\n                    if (this._totalLength) {\n                        let nextFrom = this._currentRange.to + 1;\n                        if (nextFrom < this._totalLength) {\n                            Log.w(this.TAG, 'Connection lost, trying reconnect...');\n                            this._isEarlyEofReconnecting = true;\n                            this._internalSeek(nextFrom, false);\n                        }\n                        return;\n                    }\n                    // else: We don't know totalLength, throw UnrecoverableEarlyEof\n                }\n                // live stream: throw UnrecoverableEarlyEof error to upper-layer\n                type = LoaderErrors.UNRECOVERABLE_EARLY_EOF;\n                break;\n            }\n            case LoaderErrors.UNRECOVERABLE_EARLY_EOF:\n            case LoaderErrors.CONNECTING_TIMEOUT:\n            case LoaderErrors.HTTP_STATUS_CODE_INVALID:\n            case LoaderErrors.EXCEPTION:\n                break;\n        }\n\n        if (this._onError) {\n            this._onError(type, data);\n        } else {\n            throw new RuntimeException('IOException: ' + data.msg);\n        }\n    }\n\n}\n\nexport default IOController;","import {NotImplementedException} from '../utils/exception.js';\n\nexport const LoaderStatus = {\n    kIdle: 0,\n    kConnecting: 1,\n    kBuffering: 2,\n    kError: 3,\n    kComplete: 4\n};\n\nexport const LoaderErrors = {\n    OK: 'OK',\n    EXCEPTION: 'Exception',\n    HTTP_STATUS_CODE_INVALID: 'HttpStatusCodeInvalid',\n    CONNECTING_TIMEOUT: 'ConnectingTimeout',\n    EARLY_EOF: 'EarlyEof',\n    UNRECOVERABLE_EARLY_EOF: 'UnrecoverableEarlyEof'\n};\n\n/* Loader has callbacks which have following prototypes:\n *     function onContentLengthKnown(contentLength: number): void\n *     function onDataArrival(chunk: ArrayBuffer, byteStart: number, receivedLength: number): void\n *     function onError(errorType: number, errorInfo: {code: number, msg: string}): void\n *     function onComplete(rangeFrom: number, rangeTo: number): void\n */\nexport class BaseLoader {\n\n    constructor(typeName) {\n        this._type = typeName || 'undefined';\n        this._status = LoaderStatus.kIdle;\n        this._needStash = false;\n        // callbacks\n        this._onContentLengthKnown = null;\n        this._onDataArrival = null;\n        this._onError = null;\n        this._onComplete = null;\n    }\n\n    destroy() {\n        this._status = LoaderStatus.kIdle;\n        this._onContentLengthKnown = null;\n        this._onDataArrival = null;\n        this._onError = null;\n        this._onComplete = null;\n    }\n\n    isWorking() {\n        return this._status === LoaderStatus.kConnecting || this._status === LoaderStatus.kBuffering;\n    }\n\n    get type() {\n        return this._type;\n    }\n\n    get status() {\n        return this._status;\n    }\n\n    get needStashBuffer() {\n        return this._needStash;\n    }\n\n    get onContentLengthKnown() {\n        return this._onContentLengthKnown;\n    }\n\n    set onContentLengthKnown(callback) {\n        this._onContentLengthKnown = callback;\n    }\n\n    get onDataArrival() {\n        return this._onDataArrival;\n    }\n\n    set onDataArrival(callback) {\n        this._onDataArrival = callback;\n    }\n\n    get onError() {\n        return this._onError;\n    }\n\n    set onError(callback) {\n        this._onError = callback;\n    }\n\n    get onComplete() {\n        return this._onComplete;\n    }\n\n    set onComplete(callback) {\n        this._onComplete = callback;\n    }\n\n    // pure virtual\n    open(dataSource, range) {\n        throw new NotImplementedException('Unimplemented abstract function!');\n    }\n\n    abort() {\n        throw new NotImplementedException('Unimplemented abstract function!');\n    }\n\n\n}","class ParamSeekHandler {\n\n    constructor(paramStart, paramEnd) {\n        this._startName = paramStart;\n        this._endName = paramEnd;\n    }\n\n    getConfig(baseUrl, range) {\n        let url = baseUrl;\n\n        if (range.from !== 0 || range.to !== -1) {\n            let needAnd = true;\n            if (url.indexOf('?') === -1) {\n                url += '?';\n                needAnd = false;\n            }\n\n            if (needAnd) {\n                url += '&';\n            }\n\n            url += `${this._startName}=${range.from.toString()}`;\n\n            if (range.to !== -1) {\n                url += `&${this._endName}=${range.to.toString()}`;\n            }\n        }\n\n        return {\n            url: url,\n            headers: {}\n        };\n    }\n}\n\nexport default ParamSeekHandler;","class RangeSeekHandler {\n\n    constructor(zeroStart) {\n        this._zeroStart = zeroStart || false;\n    }\n\n    getConfig(url, range) {\n        let headers = {};\n\n        if (range.from !== 0 || range.to !== -1) {\n            let param;\n            if (range.to !== -1) {\n                param = `bytes=${range.from.toString()}-${range.to.toString()}`;\n            } else {\n                param = `bytes=${range.from.toString()}-`;\n            }\n            headers['Range'] = param;\n        } else if (this._zeroStart) {\n            headers['Range'] = 'bytes=0-';\n        }\n\n        return {\n            url: url,\n            headers: headers\n        };\n    }\n\n}\n\nexport default RangeSeekHandler;","// Utility class to calculate realtime network I/O speed\n\nclass SpeedSampler {\n\n    constructor() {\n        // milliseconds\n        this._firstCheckpoint = 0;\n        this._lastCheckpoint = 0;\n        this._intervalBytes = 0;\n        this._totalBytes = 0;\n        this._lastSecondBytes = 0;\n\n        // compatibility detection\n        if (self.performance && self.performance.now) {\n            this._now = self.performance.now.bind(self.performance);\n        } else {\n            this._now = Date.now;\n        }\n    }\n\n    reset() {\n        this._firstCheckpoint = this._lastCheckpoint = 0;\n        this._totalBytes = this._intervalBytes = 0;\n        this._lastSecondBytes = 0;\n    }\n\n    addBytes(bytes) {\n        if (this._firstCheckpoint === 0) {\n            this._firstCheckpoint = this._now();\n            this._lastCheckpoint = this._firstCheckpoint;\n            this._intervalBytes += bytes;\n            this._totalBytes += bytes;\n        } else if (this._now() - this._lastCheckpoint < 1000) {\n            this._intervalBytes += bytes;\n            this._totalBytes += bytes;\n        } else {  // duration >= 1000\n            this._lastSecondBytes = this._intervalBytes;\n            this._intervalBytes = bytes;\n            this._totalBytes += bytes;\n            this._lastCheckpoint = this._now();\n        }\n    }\n\n    get currentKBps() {\n        let durationSeconds = (this._now() - this._lastCheckpoint) / 1000;\n        return (this._intervalBytes / durationSeconds) / 1024;\n    }\n\n    get lastSecondKBps() {\n        if (this._lastSecondBytes !== 0) {\n            return this._lastSecondBytes / 1024;\n        } else {  // lastSecondBytes === 0\n            if (this._now() - this._lastCheckpoint >= 500) {\n                // if time interval since last checkpoint has exceeded 500ms\n                // the speed is nearly accurate\n                return this.currentKBps;\n            } else {\n                // We don't know\n                return 0;\n            }\n        }\n    }\n\n    get averageKBps() {\n        let durationSeconds = (this._now() - this._firstCheckpoint) / 1000;\n        return (this._totalBytes / durationSeconds) / 1024;\n    }\n\n}\n\nexport default SpeedSampler;","import Log from '../utils/logger.js';\nimport {BaseLoader, LoaderStatus, LoaderErrors} from './loader.js';\nimport {RuntimeException} from '../utils/exception.js';\n\n// For FLV over WebSocket live stream\nclass WebSocketLoader extends BaseLoader {\n\n    static isSupported() {\n        try {\n            return (typeof self.WebSocket !== 'undefined');\n        } catch (e) {\n            return false;\n        }\n    }\n\n    constructor() {\n        super('websocket-loader');\n        this.TAG = this.constructor.name;\n\n        this._needStash = true;\n\n        this._ws = null;\n        this._requestAbort = false;\n        this._receivedLength = 0;\n    }\n\n    destroy() {\n        if (this._ws) {\n            this.abort();\n        }\n        super.destroy();\n    }\n\n    open(dataSource) {\n        try {\n            let ws = this._ws = new self.WebSocket(dataSource.url);\n            ws.binaryType = 'arraybuffer';\n            ws.onopen = this._onWebSocketOpen.bind(this);\n            ws.onclose = this._onWebSocketClose.bind(this);\n            ws.onmessage = this._onWebSocketMessage.bind(this);\n            ws.onerror = this._onWebSocketError.bind(this);\n\n            this._status = LoaderStatus.kConnecting;\n        } catch (e) {\n            this._status = LoaderStatus.kError;\n\n            let info = {code: e.code, msg: e.message};\n\n            if (this._onError) {\n                this._onError(LoaderErrors.EXCEPTION, info);\n            } else {\n                throw new RuntimeException(info.msg);\n            }\n        }\n    }\n\n    abort() {\n        let ws = this._ws;\n        if (ws && (ws.readyState === 0 || ws.readyState === 1)) {  // CONNECTING || OPEN\n            this._requestAbort = true;\n            ws.close();\n        }\n\n        this._ws = null;\n        this._status = LoaderStatus.kComplete;\n    }\n\n    _onWebSocketOpen(e) {\n        this._status = LoaderStatus.kBuffering;\n    }\n\n    _onWebSocketClose(e) {\n        if (this._requestAbort === true) {\n            this._requestAbort = false;\n            return;\n        }\n\n        this._status = LoaderStatus.kComplete;\n\n        if (this._onComplete) {\n            this._onComplete(0, this._receivedLength - 1);\n        }\n    }\n\n    _onWebSocketMessage(e) {\n        let chunk = e.data;\n        let byteStart = this._receivedLength;\n        this._receivedLength += chunk.byteLength;\n\n        if (this._onDataArrival) {\n            this._onDataArrival(chunk, byteStart, this._receivedLength);\n        }\n    }\n\n    _onWebSocketError(e) {\n        this._status = LoaderStatus.kError;\n\n        let info = {\n            code: e.code,\n            msg: e.message\n        };\n\n        if (this._onError) {\n            this._onError(LoaderErrors.EXCEPTION, info);\n        } else {\n            throw new RuntimeException(info.msg);\n        }\n    }\n\n}\n\nexport default WebSocketLoader;","import Log from '../utils/logger.js';\nimport {BaseLoader, LoaderStatus, LoaderErrors} from './loader.js';\nimport {RuntimeException} from '../utils/exception.js';\n\n// For FireFox browser which supports `xhr.responseType = 'moz-chunked-arraybuffer'`\nclass MozChunkedLoader extends BaseLoader {\n\n    static isSupported() {\n        try {\n            let xhr = new XMLHttpRequest();\n            // Firefox 37- requires .open() to be called before setting responseType\n            xhr.open('GET', 'https://example.com', true);\n            xhr.responseType = 'moz-chunked-arraybuffer';\n            return (xhr.responseType === 'moz-chunked-arraybuffer');\n        } catch (e) {\n            Log.w('MozChunkedLoader', e.message);\n            return false;\n        }\n    }\n\n    constructor(seekHandler) {\n        super('xhr-moz-chunked-loader');\n        this.TAG = this.constructor.name;\n\n        this._seekHandler = seekHandler;\n        this._needStash = true;\n\n        this._xhr = null;\n        this._requestAbort = false;\n        this._contentLength = null;\n        this._receivedLength = 0;\n    }\n\n    destroy() {\n        if (this.isWorking()) {\n            this.abort();\n        }\n        if (this._xhr) {\n            this._xhr.onreadystatechange = null;\n            this._xhr.onprogress = null;\n            this._xhr.onloadend = null;\n            this._xhr.onerror = null;\n            this._xhr = null;\n        }\n        super.destroy();\n    }\n\n    open(dataSource, range) {\n        this._dataSource = dataSource;\n        this._range = range;\n\n        let seekConfig = this._seekHandler.getConfig(dataSource.url, range);\n\n        let xhr = this._xhr = new XMLHttpRequest();\n        xhr.open('GET', seekConfig.url, true);\n        xhr.responseType = 'moz-chunked-arraybuffer';\n        xhr.onreadystatechange = this._onReadyStateChange.bind(this);\n        xhr.onprogress = this._onProgress.bind(this);\n        xhr.onloadend = this._onLoadEnd.bind(this);\n        xhr.onerror = this._onXhrError.bind(this);\n\n        // cors is auto detected and enabled by xhr\n\n        // withCredentials is disabled by default\n        if (dataSource.withCredentials && xhr['withCredentials']) {\n            xhr.withCredentials = true;\n        }\n\n        if (typeof seekConfig.headers === 'object') {\n            let headers = seekConfig.headers;\n\n            for (let key in headers) {\n                if (headers.hasOwnProperty(key)) {\n                    xhr.setRequestHeader(key, headers[key]);\n                }\n            }\n        }\n\n        this._status = LoaderStatus.kConnecting;\n        xhr.send();\n    }\n\n    abort() {\n        this._requestAbort = true;\n        if (this._xhr) {\n            this._xhr.abort();\n        }\n        this._status = LoaderStatus.kComplete;\n    }\n\n    _onReadyStateChange(e) {\n        let xhr = e.target;\n\n        if (xhr.readyState === 2) {  // HEADERS_RECEIVED\n            if (xhr.status !== 0 && (xhr.status < 200 || xhr.status > 299)) {\n                this._status = LoaderStatus.kError;\n                if (this._onError) {\n                    this._onError(LoaderErrors.HTTP_STATUS_CODE_INVALID, {code: xhr.status, msg: xhr.statusText});\n                } else {\n                    throw new RuntimeException('MozChunkedLoader: Http code invalid, ' + xhr.status + ' ' + xhr.statusText);\n                }\n            } else {\n                this._status = LoaderStatus.kBuffering;\n            }\n        }\n    }\n\n    _onProgress(e) {\n        if (this._contentLength === null) {\n            if (e.total !== null && e.total !== 0) {\n                this._contentLength = e.total;\n                if (this._onContentLengthKnown) {\n                    this._onContentLengthKnown(this._contentLength);\n                }\n            }\n        }\n\n        let chunk = e.target.response;\n        let byteStart = this._range.from + this._receivedLength;\n        this._receivedLength += chunk.byteLength;\n\n        if (this._onDataArrival) {\n            this._onDataArrival(chunk, byteStart, this._receivedLength);\n        }\n    }\n\n    _onLoadEnd(e) {\n        if (this._requestAbort === true) {\n            this._requestAbort = false;\n            return;\n        } else if (this._status === LoaderStatus.kError) {\n            return;\n        }\n\n        this._status = LoaderStatus.kComplete;\n        if (this._onComplete) {\n            this._onComplete(this._range.from, this._range.from + this._receivedLength - 1);\n        }\n    }\n\n    _onXhrError(e) {\n        this._status = LoaderStatus.kError;\n        let type = 0;\n        let info = null;\n\n        if (this._contentLength && e.loaded < this._contentLength) {\n            type = LoaderErrors.EARLY_EOF;\n            info = {code: -1, msg: 'Moz-Chunked stream meet Early-Eof'};\n        } else {\n            type = LoaderErrors.EXCEPTION;\n            info = {code: -1, msg: e.constructor.name + ' ' + e.type};\n        }\n\n        if (this._onError) {\n            this._onError(type, info);\n        } else {\n            throw new RuntimeException(info.msg);\n        }\n    }\n\n}\n\nexport default MozChunkedLoader;","import Log from '../utils/logger.js';\nimport {BaseLoader, LoaderStatus, LoaderErrors} from './loader.js';\nimport {RuntimeException} from '../utils/exception.js';\n\n/* Notice: ms-stream may cause IE/Edge browser crash if seek too frequently!!!\n * The browser may crash in wininet.dll. Disable for now.\n *\n * For IE11/Edge browser by microsoft which supports `xhr.responseType = 'ms-stream'`\n * Notice that ms-stream API sucks. The buffer is always expanding along with downloading.\n *\n * We need to abort the xhr if buffer size exceeded limit size (e.g. 16 MiB), then do reconnect.\n * in order to release previous ArrayBuffer to avoid memory leak\n *\n * Otherwise, the ArrayBuffer will increase to a terrible size that equals final file size.\n */\nclass MSStreamLoader extends BaseLoader {\n\n    static isSupported() {\n        try {\n            if (typeof self.MSStream === 'undefined' || typeof self.MSStreamReader === 'undefined') {\n                return false;\n            }\n\n            let xhr = new XMLHttpRequest();\n            xhr.open('GET', 'https://example.com', true);\n            xhr.responseType = 'ms-stream';\n            return (xhr.responseType === 'ms-stream');\n        } catch (e) {\n            Log.w('MSStreamLoader', e.message);\n            return false;\n        }\n    }\n\n    constructor(seekHandler) {\n        super('xhr-msstream-loader');\n        this.TAG = this.constructor.name;\n\n        this._seekHandler = seekHandler;\n        this._needStash = true;\n\n        this._xhr = null;\n        this._reader = null;  // MSStreamReader\n\n        this._totalRange = null;\n        this._currentRange = null;\n\n        this._contentLength = null;\n        this._receivedLength = 0;\n\n        this._bufferLimit = 16 * 1024 * 1024;  // 16MB\n        this._lastTimeBufferSize = 0;\n        this._isReconnecting = false;\n    }\n\n    destroy() {\n        if (this.isWorking()) {\n            this.abort();\n        }\n        if (this._reader) {\n            this._reader.onprogress = null;\n            this._reader.onload = null;\n            this._reader.onerror = null;\n            this._reader = null;\n        }\n        if (this._xhr) {\n            this._xhr.onreadystatechange = null;\n            this._xhr = null;\n        }\n        super.destroy();\n    }\n\n    open(dataSource, range) {\n        this._internalOpen(dataSource, range, false);\n    }\n\n    _internalOpen(dataSource, range, isSubrange) {\n        this._dataSource = dataSource;\n\n        if (!isSubrange) {\n            this._totalRange = range;\n        } else {\n            this._currentRange = range;\n        }\n\n        let seekConfig = this._seekHandler.getConfig(dataSource.url, range);\n\n        let reader = this._reader = new self.MSStreamReader();\n        reader.onprogress = this._msrOnProgress.bind(this);\n        reader.onload = this._msrOnLoad.bind(this);\n        reader.onerror = this._msrOnError.bind(this);\n\n        let xhr = this._xhr = new XMLHttpRequest();\n        xhr.open('GET', seekConfig.url, true);\n        xhr.responseType = 'ms-stream';\n        xhr.onreadystatechange = this._xhrOnReadyStateChange.bind(this);\n        xhr.onerror = this._xhrOnError.bind(this);\n\n        if (dataSource.withCredentials) {\n            xhr.withCredentials = true;\n        }\n\n        if (typeof seekConfig.headers === 'object') {\n            let headers = seekConfig.headers;\n\n            for (let key in headers) {\n                if (headers.hasOwnProperty(key)) {\n                    xhr.setRequestHeader(key, headers[key]);\n                }\n            }\n        }\n\n        if (this._isReconnecting) {\n            this._isReconnecting = false;\n        } else {\n            this._status = LoaderStatus.kConnecting;\n        }\n        xhr.send();\n    }\n\n    abort() {\n        this._internalAbort();\n        this._status = LoaderStatus.kComplete;\n    }\n\n    _internalAbort() {\n        if (this._reader) {\n            if (this._reader.readyState === 1) {  // LOADING\n                this._reader.abort();\n            }\n            this._reader.onprogress = null;\n            this._reader.onload = null;\n            this._reader.onerror = null;\n            this._reader = null;\n        }\n        if (this._xhr) {\n            this._xhr.abort();\n            this._xhr.onreadystatechange = null;\n            this._xhr = null;\n        }\n    }\n\n    _xhrOnReadyStateChange(e) {\n        let xhr = e.target;\n\n        if (xhr.readyState === 3) {\n            if (xhr.status >= 200 && xhr.status <= 299) {\n                this._status = LoaderStatus.kBuffering;\n\n                let lengthHeader = xhr.getResponseHeader('Content-Length');\n                if (lengthHeader != null && this._contentLength == null) {\n                    let length = parseInt(lengthHeader);\n                    if (length > 0) {\n                        this._contentLength = length;\n                        if (this._onContentLengthKnown) {\n                            this._onContentLengthKnown(this._contentLength);\n                        }\n                    }\n                }\n\n                let msstream = xhr.response;\n                this._reader.readAsArrayBuffer(msstream);\n            } else {\n                this._status = LoaderStatus.kError;\n                if (this._onError) {\n                    this._onError(LoaderErrors.HTTP_STATUS_CODE_INVALID, {code: xhr.status, msg: xhr.statusText});\n                } else {\n                    throw new RuntimeException('MSStreamLoader: Http code invalid, ' + xhr.status + ' ' + xhr.statusText);\n                }\n            }\n        }\n    }\n\n    _xhrOnError(e) {\n        this._status = LoaderStatus.kError;\n        let type = LoaderErrors.EXCEPTION;\n        let info = {code: -1, msg: e.constructor.name + ' ' + e.type};\n\n        if (this._onError) {\n            this._onError(type, info);\n        } else {\n            throw new RuntimeException(info.msg);\n        }\n    }\n\n    _msrOnProgress(e) {\n        let reader = e.target;\n        let bigbuffer = reader.result;\n        if (bigbuffer == null) {  // result may be null, workaround for buggy M$\n            this._doReconnectIfNeeded();\n            return;\n        }\n\n        let slice = bigbuffer.slice(this._lastTimeBufferSize);\n        this._lastTimeBufferSize = bigbuffer.byteLength;\n        let byteStart = this._totalRange.from + this._receivedLength;\n        this._receivedLength += slice.byteLength;\n\n        if (this._onDataArrival) {\n            this._onDataArrival(slice, byteStart, this._receivedLength);\n        }\n\n        if (bigbuffer.byteLength >= this._bufferLimit) {\n            Log.v(this.TAG, `MSStream buffer exceeded max size near ${byteStart + slice.byteLength}, reconnecting...`);\n            this._doReconnectIfNeeded();\n        }\n    }\n\n    _doReconnectIfNeeded() {\n        if (this._contentLength == null || this._receivedLength < this._contentLength) {\n            this._isReconnecting = true;\n            this._lastTimeBufferSize = 0;\n            this._internalAbort();\n\n            let range = {\n                from: this._totalRange.from + this._receivedLength,\n                to: -1\n            };\n            this._internalOpen(this._dataSource, range, true);\n        }\n    }\n\n    _msrOnLoad(e) {  // actually it is onComplete event\n        this._status = LoaderStatus.kComplete;\n        if (this._onComplete) {\n            this._onComplete(this._totalRange.from, this._totalRange.from + this._receivedLength - 1);\n        }\n    }\n\n    _msrOnError(e) {\n        this._status = LoaderStatus.kError;\n        let type = 0;\n        let info = null;\n\n        if (this._contentLength && this._receivedLength < this._contentLength) {\n            type = LoaderErrors.EARLY_EOF;\n            info = {code: -1, msg: 'MSStream meet Early-Eof'};\n        } else {\n            type = LoaderErrors.EARLY_EOF;\n            info = {code: -1, msg: e.constructor.name + ' ' + e.type};\n        }\n\n        if (this._onError) {\n            this._onError(type, info);\n        } else {\n            throw new RuntimeException(info.msg);\n        }\n    }\n}\n\nexport default MSStreamLoader;","import Log from '../utils/logger.js';\nimport SpeedSampler from './speed-sampler.js';\nimport {BaseLoader, LoaderStatus, LoaderErrors} from './loader.js';\nimport {RuntimeException} from '../utils/exception.js';\n\n// Universal IO Loader, implemented by adding Range header in xhr's request header\nclass RangeLoader extends BaseLoader {\n\n    static isSupported() {\n        try {\n            let xhr = new XMLHttpRequest();\n            xhr.open('GET', 'https://example.com', true);\n            xhr.responseType = 'arraybuffer';\n            return (xhr.responseType === 'arraybuffer');\n        } catch (e) {\n            Log.w('RangeLoader', e.message);\n            return false;\n        }\n    }\n\n    constructor(seekHandler) {\n        super('xhr-range-loader');\n        this.TAG = this.constructor.name;\n\n        this._seekHandler = seekHandler;\n        this._needStash = false;\n\n        this._chunkSizeKBList = [\n            128, 256, 384, 512, 768, 1024, 1536, 2048, 3072, 4096, 5120, 6144, 7168, 8192\n        ];\n        this._currentChunkSizeKB = 384;\n        this._currentSpeed = 0;\n        this._currentSpeedNormalized = 0;\n        this._zeroSpeedChunkCount = 0;\n\n        this._xhr = null;\n        this._speedSampler = new SpeedSampler();\n\n        this._requestAbort = false;\n        this._waitForTotalLength = false;\n        this._totalLengthReceived = false;\n\n        this._currentRequestRange = null;\n        this._totalLength = null;  // size of the entire file\n        this._contentLength = null;  // Content-Length of entire request range\n        this._receivedLength = 0;  // total received bytes\n        this._lastTimeLoaded = 0;  // received bytes of current request sub-range\n    }\n\n    destroy() {\n        if (this.isWorking()) {\n            this.abort();\n        }\n        if (this._xhr) {\n            this._xhr.onreadystatechange = null;\n            this._xhr.onprogress = null;\n            this._xhr.onload = null;\n            this._xhr.onerror = null;\n            this._xhr = null;\n        }\n        super.destroy();\n    }\n\n    get currentSpeed() {\n        return this._currentSpeed;\n    }\n\n    open(dataSource, range) {\n        this._dataSource = dataSource;\n        this._range = range;\n        this._status = LoaderStatus.kConnecting;\n\n        if (!this._totalLengthReceived) {\n            // We need total filesize\n            this._waitForTotalLength = true;\n            this._internalOpen(this._dataSource, {from: 0, to: -1});\n        } else {\n            // We have filesize, start loading\n            this._openSubRange();\n        }\n    }\n\n    _openSubRange() {\n        let chunkSize = this._currentChunkSizeKB * 1024;\n\n        let from = this._range.from + this._receivedLength;\n        let to = from + chunkSize;\n\n        if (this._contentLength != null) {\n            if (to - this._range.from >= this._contentLength) {\n                to = this._range.from + this._contentLength - 1;\n            }\n        }\n\n        this._currentRequestRange = {from, to};\n        this._internalOpen(this._dataSource, this._currentRequestRange);\n    }\n\n    _internalOpen(dataSource, range) {\n        this._lastTimeLoaded = 0;\n\n        let seekConfig = this._seekHandler.getConfig(dataSource.url, range);\n\n        let xhr = this._xhr = new XMLHttpRequest();\n        xhr.open('GET', seekConfig.url, true);\n        xhr.responseType = 'arraybuffer';\n        xhr.onreadystatechange = this._onReadyStateChange.bind(this);\n        xhr.onprogress = this._onProgress.bind(this);\n        xhr.onload = this._onLoad.bind(this);\n        xhr.onerror = this._onXhrError.bind(this);\n\n        if (dataSource.withCredentials && xhr['withCredentials']) {\n            xhr.withCredentials = true;\n        }\n\n        if (typeof seekConfig.headers === 'object') {\n            let headers = seekConfig.headers;\n\n            for (let key in headers) {\n                if (headers.hasOwnProperty(key)) {\n                    xhr.setRequestHeader(key, headers[key]);\n                }\n            }\n        }\n\n        xhr.send();\n    }\n\n    abort() {\n        this._requestAbort = true;\n        this._internalAbort();\n        this._status = LoaderStatus.kComplete;\n    }\n\n    _internalAbort() {\n        if (this._xhr) {\n            this._xhr.onreadystatechange = null;\n            this._xhr.onprogress = null;\n            this._xhr.onload = null;\n            this._xhr.onerror = null;\n            this._xhr.abort();\n            this._xhr = null;\n        }\n    }\n\n    _onReadyStateChange(e) {\n        let xhr = e.target;\n\n        if (xhr.readyState === 2) {  // HEADERS_RECEIVED\n            if ((xhr.status >= 200 && xhr.status < 300)) {\n                if (this._waitForTotalLength) {\n                    return;\n                }\n                this._status = LoaderStatus.kBuffering;\n            } else {\n                this._status = LoaderStatus.kError;\n                if (this._onError) {\n                    this._onError(LoaderErrors.HTTP_STATUS_CODE_INVALID, {code: xhr.status, msg: xhr.statusText});\n                } else {\n                    throw new RuntimeException('RangeLoader: Http code invalid, ' + xhr.status + ' ' + xhr.statusText);\n                }\n            }\n        }\n    }\n\n    _onProgress(e) {\n        if (this._contentLength === null) {\n            let openNextRange = false;\n\n            if (this._waitForTotalLength) {\n                this._waitForTotalLength = false;\n                this._totalLengthReceived = true;\n                openNextRange = true;\n\n                let total = e.total;\n                this._internalAbort();\n                if (total != null & total !== 0) {\n                    this._totalLength = total;\n                }\n            }\n\n            // calculate currrent request range's contentLength\n            if (this._range.to === -1) {\n                this._contentLength = this._totalLength - this._range.from;\n            } else {  // to !== -1\n                this._contentLength = this._range.to - this._range.from + 1;\n            }\n\n            if (openNextRange) {\n                this._openSubRange();\n                return;\n            }\n            if (this._onContentLengthKnown) {\n                this._onContentLengthKnown(this._contentLength);\n            }\n        }\n\n        let delta = e.loaded - this._lastTimeLoaded;\n        this._lastTimeLoaded = e.loaded;\n        this._speedSampler.addBytes(delta);\n    }\n\n    _normalizeSpeed(input) {\n        let list = this._chunkSizeKBList;\n        let last = list.length - 1;\n        let mid = 0;\n        let lbound = 0;\n        let ubound = last;\n\n        if (input < list[0]) {\n            return list[0];\n        }\n\n        while (lbound <= ubound) {\n            mid = lbound + Math.floor((ubound - lbound) / 2);\n            if (mid === last || (input >= list[mid] && input < list[mid + 1])) {\n                return list[mid];\n            } else if (list[mid] < input) {\n                lbound = mid + 1;\n            } else {\n                ubound = mid - 1;\n            }\n        }\n    }\n\n    _onLoad(e) {\n        if (this._waitForTotalLength) {\n            this._waitForTotalLength = false;\n            return;\n        }\n\n        this._lastTimeLoaded = 0;\n        let KBps = this._speedSampler.lastSecondKBps;\n        if (KBps === 0) {\n            this._zeroSpeedChunkCount++;\n            if (this._zeroSpeedChunkCount >= 3) {\n                // Try get currentKBps after 3 chunks\n                KBps = this._speedSampler.currentKBps;\n            }\n        }\n\n        if (KBps !== 0) {\n            this._currentSpeed = KBps;\n            let normalized = this._normalizeSpeed(KBps);\n            if (this._currentSpeedNormalized !== normalized) {\n                this._currentSpeedNormalized = normalized;\n                this._currentChunkSizeKB = normalized;\n            }\n        }\n\n        let chunk = e.target.response;\n        let byteStart = this._range.from + this._receivedLength;\n        this._receivedLength += chunk.byteLength;\n\n        let reportComplete = false;\n\n        if (this._contentLength != null && this._receivedLength < this._contentLength) {\n            // continue load next chunk\n            this._openSubRange();\n        } else {\n            reportComplete = true;\n        }\n\n        // dispatch received chunk\n        if (this._onDataArrival) {\n            this._onDataArrival(chunk, byteStart, this._receivedLength);\n        }\n\n        if (reportComplete) {\n            this._status = LoaderStatus.kComplete;\n            if (this._onComplete) {\n                this._onComplete(this._range.from, this._range.from + this._receivedLength - 1);\n            }\n        }\n    }\n\n    _onXhrError(e) {\n        this._status = LoaderStatus.kError;\n        let type = 0;\n        let info = null;\n\n        if (this._contentLength && this._receivedLength > 0\n                                && this._receivedLength < this._contentLength) {\n            type = LoaderErrors.EARLY_EOF;\n            info = {code: -1, msg: 'RangeLoader meet Early-Eof'};\n        } else {\n            type = LoaderErrors.EXCEPTION;\n            info = {code: -1, msg: e.constructor.name + ' ' + e.type};\n        }\n\n        if (this._onError) {\n            this._onError(type, info);\n        } else {\n            throw new RuntimeException(info.msg);\n        }\n    }\n\n}\n\nexport default RangeLoader;","import EventEmitter from 'events';\nimport Log from '../utils/logger.js';\nimport Browser from '../utils/browser.js';\nimport PlayerEvents from './player-events.js';\nimport Transmuxer from '../core/transmuxer.js';\nimport TransmuxingEvents from '../core/transmuxing-events.js';\nimport MSEController from '../core/mse-controller.js';\nimport MSEEvents from '../core/mse-events.js';\nimport {ErrorTypes, ErrorDetails} from './player-errors.js';\nimport {createDefaultConfig} from '../config.js';\nimport {InvalidArgumentException, IllegalStateException} from '../utils/exception.js';\n\nclass FlvPlayer {\n\n    constructor(mediaDataSource, config) {\n        this.TAG = this.constructor.name;\n        this._type = 'FlvPlayer';\n        this._emitter = new EventEmitter();\n\n        this._config = createDefaultConfig();\n        if (typeof config === 'object') {\n            Object.assign(this._config, config);\n        }\n\n        if (mediaDataSource.type.toLowerCase() !== 'flv') {\n            throw new InvalidArgumentException('FlvPlayer requires an flv MediaDataSource input!');\n        }\n\n        if (mediaDataSource.isLive === true) {\n            this._config.isLive = true;\n        }\n\n        this.e = {\n            onvLoadedMetadata: this._onvLoadedMetadata.bind(this),\n            onvSeeking: this._onvSeeking.bind(this),\n            onvCanPlay: this._onvCanPlay.bind(this),\n            onvStalled: this._onvStalled.bind(this),\n            onvProgress: this._onvProgress.bind(this)\n        };\n\n        if (self.performance && self.performance.now) {\n            this._now = self.performance.now.bind(self.performance);\n        } else {\n            this._now = Date.now;\n        }\n\n        this._pendingSeekTime = null;  // in seconds\n        this._requestSetTime = false;\n        this._seekpointRecord = null;\n        this._statisticsReporter = null;\n        this._progressChecker = null;\n\n        this._hasStatisticsListener = false;\n\n        this._mediaDataSource = mediaDataSource;\n        this._mediaElement = null;\n        this._msectl = null;\n        this._transmuxer = null;\n\n        this._mseSourceOpened = false;\n        this._hasPendingLoad = false;\n        this._receivedCanPlay = false;\n\n        this._mediaInfo = null;\n        this._statisticsInfo = null;\n\n        let chromeNeedIDRFix = (Browser.chrome &&\n                               (Browser.version.major < 50 ||\n                               (Browser.version.major === 50 && Browser.version.build < 2661)));\n        this._alwaysSeekKeyframe = (chromeNeedIDRFix || Browser.msedge || Browser.msie) ? true : false;\n\n        if (this._alwaysSeekKeyframe) {\n            this._config.accurateSeek = false;\n        }\n    }\n\n    destroy() {\n        if (this._progressChecker != null) {\n            window.clearInterval(this._progressChecker);\n            this._progressChecker = null;\n        }\n        if (this._transmuxer) {\n            this.unload();\n        }\n        if (this._mediaElement) {\n            this.detachMediaElement();\n        }\n        this.e = null;\n        this._mediaDataSource = null;\n\n        this._emitter.removeAllListeners();\n        this._emitter = null;\n    }\n\n    on(event, listener) {\n        if (event === PlayerEvents.MEDIA_INFO) {\n            if (this._mediaInfo != null) {\n                Promise.resolve().then(() => {\n                    this._emitter.emit(PlayerEvents.MEDIA_INFO, this.mediaInfo);\n                });\n            }\n        } else if (event === PlayerEvents.STATISTICS_INFO) {\n            this._hasStatisticsListener = true;\n            if (this._statisticsInfo != null) {\n                Promise.resolve().then(() => {\n                    this._emitter.emit(PlayerEvents.STATISTICS_INFO, this.statisticsInfo);\n                });\n            }\n            if (this._statisticsReporter == null) {\n                this._statisticsReporter = window.setInterval(\n                    this._reportStatisticsInfo.bind(this),\n                this._config.statisticsInfoReportInterval);\n            }\n        }\n        this._emitter.addListener(event, listener);\n    }\n\n    off(event, listener) {\n        if (event === PlayerEvents.STATISTICS_INFO) {\n            this._hasStatisticsListener = false;\n            if (this._statisticsReporter != null) {\n                window.clearInterval(this._statisticsReporter);\n                this._statisticsReporter = null;\n            }\n        }\n        this._emitter.removeListener(event, listener);\n    }\n\n    attachMediaElement(mediaElement) {\n        this._mediaElement = mediaElement;\n        mediaElement.addEventListener('loadedmetadata', this.e.onvLoadedMetadata);\n        mediaElement.addEventListener('seeking', this.e.onvSeeking);\n        mediaElement.addEventListener('canplay', this.e.onvCanPlay);\n        mediaElement.addEventListener('stalled', this.e.onvStalled);\n        mediaElement.addEventListener('progress', this.e.onvProgress);\n\n        this._msectl = new MSEController();\n\n        this._msectl.on(MSEEvents.UPDATE_END, this._onmseUpdateEnd.bind(this));\n        this._msectl.on(MSEEvents.BUFFER_FULL, this._onmseBufferFull.bind(this));\n        this._msectl.on(MSEEvents.SOURCE_OPEN, () => {\n            this._mseSourceOpened = true;\n            if (this._hasPendingLoad) {\n                this._hasPendingLoad = false;\n                this.load();\n            }\n        });\n        this._msectl.on(MSEEvents.ERROR, (info) => {\n            this._emitter.emit(PlayerEvents.ERROR,\n                               ErrorTypes.MEDIA_ERROR,\n                               ErrorDetails.MEDIA_MSE_ERROR,\n                               info\n            );\n        });\n\n        this._msectl.attachMediaElement(mediaElement);\n\n        if (this._pendingSeekTime != null) {\n            try {\n                mediaElement.currentTime = this._pendingSeekTime;\n                this._pendingSeekTime = null;\n            } catch (e) {\n                // IE11 may throw InvalidStateError if readyState === 0\n                // We can defer set currentTime operation after loadedmetadata\n            }\n        }\n    }\n\n    detachMediaElement() {\n        if (this._mediaElement) {\n            this._msectl.detachMediaElement();\n            this._mediaElement.removeEventListener('loadedmetadata', this.e.onvLoadedMetadata);\n            this._mediaElement.removeEventListener('seeking', this.e.onvSeeking);\n            this._mediaElement.removeEventListener('canplay', this.e.onvCanPlay);\n            this._mediaElement.removeEventListener('stalled', this.e.onvStalled);\n            this._mediaElement.removeEventListener('progress', this.e.onvProgress);\n            this._mediaElement = null;\n        }\n        if (this._msectl) {\n            this._msectl.destroy();\n            this._msectl = null;\n        }\n    }\n\n    load() {\n        if (!this._mediaElement) {\n            throw new IllegalStateException('HTMLMediaElement must be attached before load()!');\n        }\n        if (this._transmuxer) {\n            throw new IllegalStateException('FlvPlayer.load() has been called, please call unload() first!');\n        }\n        if (this._hasPendingLoad) {\n            return;\n        }\n\n        if (this._config.deferLoadAfterSourceOpen && this._mseSourceOpened === false) {\n            this._hasPendingLoad = true;\n            return;\n        }\n\n        if (this._mediaElement.readyState > 0) {\n            this._requestSetTime = true;\n            // IE11 may throw InvalidStateError if readyState === 0\n            this._mediaElement.currentTime = 0;\n        }\n\n        this._transmuxer = new Transmuxer(this._mediaDataSource, this._config);\n\n        this._transmuxer.on(TransmuxingEvents.INIT_SEGMENT, (type, is) => {\n            this._msectl.appendInitSegment(is);\n        });\n        this._transmuxer.on(TransmuxingEvents.MEDIA_SEGMENT, (type, ms) => {\n            this._msectl.appendMediaSegment(ms);\n\n            if (this._hasStatisticsListener && this._statisticsReporter == null) {\n                if (this._progressChecker == null) {\n                    this._statisticsReporter = window.setInterval(\n                        this._reportStatisticsInfo.bind(this),\n                    this._config.statisticsInfoReportInterval);\n                }\n            }\n\n            // lazyLoad check\n            if (this._config.lazyLoad && !this._config.isLive) {\n                let currentTime = this._mediaElement.currentTime;\n                if (ms.info.endDts >= (currentTime + this._config.lazyLoadMaxDuration) * 1000) {\n                    if (this._progressChecker == null) {\n                        Log.v(this.TAG, 'Maximum buffering duration exceeded, suspend transmuxing task');\n                        this._suspendTransmuxer();\n                    }\n                }\n            }\n        });\n        this._transmuxer.on(TransmuxingEvents.LOADING_COMPLETE, () => {\n            this._msectl.endOfStream();\n            if (this._statisticsReporter != null) {\n                window.clearInterval(this._statisticsReporter);\n                this._statisticsReporter = null;\n            }\n            this._emitter.emit(PlayerEvents.LOADING_COMPLETE);\n        });\n        this._transmuxer.on(TransmuxingEvents.RECOVERED_EARLY_EOF, () => {\n            this._emitter.emit(PlayerEvents.RECOVERED_EARLY_EOF);\n        });\n        this._transmuxer.on(TransmuxingEvents.IO_ERROR, (detail, info) => {\n            this._emitter.emit(PlayerEvents.ERROR, ErrorTypes.NETWORK_ERROR, detail, info);\n        });\n        this._transmuxer.on(TransmuxingEvents.DEMUX_ERROR, (detail, info) => {\n            this._emitter.emit(PlayerEvents.ERROR, ErrorTypes.MEDIA_ERROR, detail, {code: -1, msg: info});\n        });\n        this._transmuxer.on(TransmuxingEvents.MEDIA_INFO, (mediaInfo) => {\n            this._mediaInfo = mediaInfo;\n            this._emitter.emit(PlayerEvents.MEDIA_INFO, mediaInfo);\n        });\n        this._transmuxer.on(TransmuxingEvents.STATISTICS_INFO, (statInfo) => {\n            this._statisticsInfo = this._fillStatisticsInfo(statInfo);\n        });\n        this._transmuxer.on(TransmuxingEvents.RECOMMEND_SEEKPOINT, (milliseconds) => {\n            if (this._mediaElement && !this._config.accurateSeek) {\n                this._requestSetTime = true;\n                this._mediaElement.currentTime = milliseconds / 1000;\n            }\n        });\n\n        this._transmuxer.open();\n    }\n\n    unload() {\n        if (this._statisticsReporter != null) {\n            window.clearInterval(this._statisticsReporter);\n            this._statisticsReporter = null;\n        }\n        if (this._mediaElement) {\n            this._mediaElement.pause();\n        }\n        if (this._msectl) {\n            this._msectl.seek(0);\n        }\n        if (this._transmuxer) {\n            this._transmuxer.close();\n            this._transmuxer.destroy();\n            this._transmuxer = null;\n        }\n    }\n\n    play() {\n        this._mediaElement.play();\n    }\n\n    pause() {\n        this._mediaElement.pause();\n    }\n\n    get type() {\n        return this._type;\n    }\n\n    get buffered() {\n        return this._mediaElement.buffered;\n    }\n\n    get duration() {\n        return this._mediaElement.duration;\n    }\n\n    get volume() {\n        return this._mediaElement.volume;\n    }\n\n    set volume(value) {\n        this._mediaElement.volume = value;\n    }\n\n    get muted() {\n        return this._mediaElement.muted;\n    }\n\n    set muted(muted) {\n        this._mediaElement.muted = muted;\n    }\n\n    get currentTime() {\n        if (this._mediaElement) {\n            return this._mediaElement.currentTime;\n        }\n        return 0;\n    }\n\n    set currentTime(seconds) {\n        if (this._mediaElement) {\n            this._internalSeek(seconds);\n        } else {\n            this._pendingSeekTime = seconds;\n        }\n    }\n\n    get mediaInfo() {\n        return Object.assign({}, this._mediaInfo);\n    }\n\n    get statisticsInfo() {\n        if (this._statisticsInfo == null) {\n            this._statisticsInfo = {};\n        }\n        this._statisticsInfo = this._fillStatisticsInfo(this._statisticsInfo);\n        return Object.assign({}, this._statisticsInfo);\n    }\n\n    _fillStatisticsInfo(statInfo) {\n        statInfo.playerType = this._type;\n\n        let hasQualityInfo = true;\n        let decoded = 0;\n        let dropped = 0;\n\n        if (this._mediaElement.getVideoPlaybackQuality) {\n            let quality = this._mediaElement.getVideoPlaybackQuality();\n            decoded = quality.totalVideoFrames;\n            dropped = quality.droppedVideoFrames;\n        } else if (this._mediaElement.webkitDecodedFrameCount != undefined) {\n            decoded = this._mediaElement.webkitDecodedFrameCount;\n            dropped = this._mediaElement.webkitDroppedFrameCount;\n        } else {\n            hasQualityInfo = false;\n        }\n\n        if (hasQualityInfo) {\n            statInfo.decodedFrames = decoded;\n            statInfo.droppedFrames = dropped;\n        }\n\n        return statInfo;\n    }\n\n    _reportStatisticsInfo() {\n        if (this._statisticsInfo != null) {\n            this._emitter.emit(PlayerEvents.STATISTICS_INFO, this.statisticsInfo);\n        }\n    }\n\n    _onmseUpdateEnd() {\n        if (!this._config.lazyLoad || this._config.isLive) {\n            return;\n        }\n\n        let buffered = this._mediaElement.buffered;\n        let currentTime = this._mediaElement.currentTime;\n        let currentRangeStart = 0;\n        let currentRangeEnd = 0;\n\n        for (let i = 0; i < buffered.length; i++) {\n            let start = buffered.start(i);\n            let end = buffered.end(i);\n            if (start <= currentTime && currentTime < end) {\n                currentRangeStart = start;\n                currentRangeEnd = end;\n                break;\n            }\n        }\n\n        if (currentRangeEnd >= currentTime + this._config.lazyLoadMaxDuration && this._progressChecker == null) {\n            Log.v(this.TAG, 'Maximum buffering duration exceeded, suspend transmuxing task');\n            this._suspendTransmuxer();\n        }\n    }\n\n    _onmseBufferFull() {\n        Log.v(this.TAG, 'MSE SourceBuffer is full, suspend transmuxing task');\n        if (this._progressChecker == null) {\n            this._suspendTransmuxer();\n        }\n    }\n\n    _suspendTransmuxer() {\n        if (this._transmuxer) {\n            this._transmuxer.pause();\n\n            if (this._statisticsReporter != null) {\n                window.clearInterval(this._statisticsReporter);\n                this._statisticsReporter = null;\n            }\n\n            if (this._progressChecker == null) {\n                this._progressChecker = window.setInterval(this._checkProgressAndResume.bind(this), 1000);\n            }\n        }\n    }\n\n    _checkProgressAndResume() {\n        let currentTime = this._mediaElement.currentTime;\n        let buffered = this._mediaElement.buffered;\n\n        let needResume = false;\n\n        for (let i = 0; i < buffered.length; i++) {\n            let from = buffered.start(i);\n            let to = buffered.end(i);\n            if (currentTime >= from && currentTime < to) {\n                if (currentTime >= to - 30) {\n                    needResume = true;\n                }\n                break;\n            }\n        }\n\n        if (needResume) {\n            window.clearInterval(this._progressChecker);\n            this._progressChecker = null;\n            if (needResume) {\n                Log.v(this.TAG, 'Continue loading from paused position');\n                this._transmuxer.resume();\n            }\n        }\n    }\n\n    _isTimepointBuffered(seconds) {\n        let buffered = this._mediaElement.buffered;\n\n        for (let i = 0; i < buffered.length; i++) {\n            let from = buffered.start(i);\n            let to = buffered.end(i);\n            if (seconds >= from && seconds < to) {\n                return true;\n            }\n        }\n        return false;\n    }\n\n    _internalSeek(seconds) {\n        let directSeek = this._isTimepointBuffered(seconds);\n\n        let directSeekBegin = false;\n        let directSeekBeginTime = 0;\n\n        if (seconds < 1.0 && this._mediaElement.buffered.length > 0) {\n            let videoBeginTime = this._mediaElement.buffered.start(0);\n            if ((videoBeginTime < 1.0 && seconds < videoBeginTime) || Browser.safari) {\n                directSeekBegin = true;\n                // also workaround for Safari: Seek to 0 may cause video stuck, use 0.1 to avoid\n                directSeekBeginTime = Browser.safari ? 0.1 : videoBeginTime;\n            }\n        }\n\n        if (directSeekBegin) {  // seek to video begin, set currentTime directly if beginPTS buffered\n            this._requestSetTime = true;\n            this._mediaElement.currentTime = directSeekBeginTime;\n        }  else if (directSeek) {  // buffered position\n            if (!this._alwaysSeekKeyframe) {\n                this._requestSetTime = true;\n                this._mediaElement.currentTime = seconds;\n            } else {\n                let idr = this._msectl.getNearestKeyframe(Math.floor(seconds * 1000));\n                this._requestSetTime = true;\n                if (idr != null) {\n                    this._mediaElement.currentTime = idr.dts / 1000;\n                } else {\n                    this._mediaElement.currentTime = seconds;\n                }\n            }\n            if (this._progressChecker != null) {\n                this._checkProgressAndResume();\n            }\n        } else {\n            if (this._progressChecker != null) {\n                window.clearInterval(this._progressChecker);\n                this._progressChecker = null;\n            }\n            this._msectl.seek(seconds);\n            this._transmuxer.seek(Math.floor(seconds * 1000));  // in milliseconds\n            // no need to set mediaElement.currentTime if non-accurateSeek,\n            // just wait for the recommend_seekpoint callback\n            if (this._config.accurateSeek) {\n                this._requestSetTime = true;\n                this._mediaElement.currentTime = seconds;\n            }\n        }\n    }\n\n    _checkAndApplyUnbufferedSeekpoint() {\n        if (this._seekpointRecord) {\n            if (this._seekpointRecord.recordTime <= this._now() - 100) {\n                let target = this._mediaElement.currentTime;\n                this._seekpointRecord = null;\n                if (!this._isTimepointBuffered(target)) {\n                    if (this._progressChecker != null) {\n                        window.clearTimeout(this._progressChecker);\n                        this._progressChecker = null;\n                    }\n                    // .currentTime is consists with .buffered timestamp\n                    // Chrome/Edge use DTS, while FireFox/Safari use PTS\n                    this._msectl.seek(target);\n                    this._transmuxer.seek(Math.floor(target * 1000));\n                    // set currentTime if accurateSeek, or wait for recommend_seekpoint callback\n                    if (this._config.accurateSeek) {\n                        this._requestSetTime = true;\n                        this._mediaElement.currentTime = target;\n                    }\n                }\n            } else {\n                window.setTimeout(this._checkAndApplyUnbufferedSeekpoint.bind(this), 50);\n            }\n        }\n    }\n\n    _checkAndResumeStuckPlayback(stalled) {\n        let media = this._mediaElement;\n        if (stalled || !this._receivedCanPlay || media.readyState < 2) {  // HAVE_CURRENT_DATA\n            let buffered = media.buffered;\n            if (buffered.length > 0 && media.currentTime < buffered.start(0)) {\n                Log.w(this.TAG, `Playback seems stuck at ${media.currentTime}, seek to ${buffered.start(0)}`);\n                this._requestSetTime = true;\n                this._mediaElement.currentTime = buffered.start(0);\n                this._mediaElement.removeEventListener('progress', this.e.onvProgress);\n            }\n        } else {\n            // Playback didn't stuck, remove progress event listener\n            this._mediaElement.removeEventListener('progress', this.e.onvProgress);\n        }\n    }\n\n    _onvLoadedMetadata(e) {\n        if (this._pendingSeekTime != null) {\n            this._mediaElement.currentTime = this._pendingSeekTime;\n            this._pendingSeekTime = null;\n        }\n    }\n\n    _onvSeeking(e) {  // handle seeking request from browser's progress bar\n        let target = this._mediaElement.currentTime;\n        let buffered = this._mediaElement.buffered;\n\n        if (this._requestSetTime) {\n            this._requestSetTime = false;\n            return;\n        }\n\n        if (target < 1.0 && buffered.length > 0) {\n            // seek to video begin, set currentTime directly if beginPTS buffered\n            let videoBeginTime = buffered.start(0);\n            if ((videoBeginTime < 1.0 && target < videoBeginTime) || Browser.safari) {\n                this._requestSetTime = true;\n                // also workaround for Safari: Seek to 0 may cause video stuck, use 0.1 to avoid\n                this._mediaElement.currentTime = Browser.safari ? 0.1 : videoBeginTime;\n                return;\n            }\n        }\n\n        if (this._isTimepointBuffered(target)) {\n            if (this._alwaysSeekKeyframe) {\n                let idr = this._msectl.getNearestKeyframe(Math.floor(target * 1000));\n                if (idr != null) {\n                    this._requestSetTime = true;\n                    this._mediaElement.currentTime = idr.dts / 1000;\n                }\n            }\n            if (this._progressChecker != null) {\n                this._checkProgressAndResume();\n            }\n            return;\n        }\n\n        this._seekpointRecord = {\n            seekPoint: target,\n            recordTime: this._now()\n        };\n        window.setTimeout(this._checkAndApplyUnbufferedSeekpoint.bind(this), 50);\n    }\n\n    _onvCanPlay(e) {\n        this._receivedCanPlay = true;\n        this._mediaElement.removeEventListener('canplay', this.e.onvCanPlay);\n    }\n\n    _onvStalled(e) {\n        this._checkAndResumeStuckPlayback(true);\n    }\n\n    _onvProgress(e) {\n        this._checkAndResumeStuckPlayback();\n    }\n\n}\n\nexport default FlvPlayer;","import EventEmitter from 'events';\nimport PlayerEvents from './player-events.js';\nimport {createDefaultConfig} from '../config.js';\nimport {InvalidArgumentException, IllegalStateException} from '../utils/exception.js';\n\n// Player wrapper for browser's native player (HTMLVideoElement) without MediaSource src. \nclass NativePlayer {\n\n    constructor(mediaDataSource, config) {\n        this.TAG = this.constructor.name;\n        this._type = 'NativePlayer';\n        this._emitter = new EventEmitter();\n\n        this._config = createDefaultConfig();\n        if (typeof config === 'object') {\n            Object.assign(this._config, config);\n        }\n\n        if (mediaDataSource.type.toLowerCase() === 'flv') {\n            throw new InvalidArgumentException('NativePlayer does\\'t support flv MediaDataSource input!');\n        }\n        if (mediaDataSource.hasOwnProperty('segments')) {\n            throw new InvalidArgumentException(`NativePlayer(${mediaDataSource.type}) doesn't support multipart playback!`);\n        }\n\n        this.e = {\n            onvLoadedMetadata: this._onvLoadedMetadata.bind(this)\n        };\n\n        this._pendingSeekTime = null;\n        this._statisticsReporter = null;\n\n        this._mediaDataSource = mediaDataSource;\n        this._mediaElement = null;\n    }\n\n    destroy() {\n        if (this._mediaElement) {\n            this.unload();\n            this.detachMediaElement();\n        }\n        this.e = null;\n        this._mediaDataSource = null;\n        this._emitter.removeAllListeners();\n        this._emitter = null;\n    }\n\n    on(event, listener) {\n        if (event === PlayerEvents.MEDIA_INFO) {\n            if (this._mediaElement != null && this._mediaElement.readyState !== 0) {  // HAVE_NOTHING\n                Promise.resolve().then(() => {\n                    this._emitter.emit(PlayerEvents.MEDIA_INFO, this.mediaInfo);\n                });\n            }\n        } else if (event === PlayerEvents.STATISTICS_INFO) {\n            if (this._mediaElement != null && this._mediaElement.readyState !== 0) {\n                Promise.resolve().then(() => {\n                    this._emitter.emit(PlayerEvents.STATISTICS_INFO, this.statisticsInfo);\n                });\n            }\n        }\n        this._emitter.addListener(event, listener);\n    }\n\n    off(event, listener) {\n        this._emitter.removeListener(event, listener);\n    }\n\n    attachMediaElement(mediaElement) {\n        this._mediaElement = mediaElement;\n        mediaElement.addEventListener('loadedmetadata', this.e.onvLoadedMetadata);\n\n        if (this._pendingSeekTime != null) {\n            try {\n                mediaElement.currentTime = this._pendingSeekTime;\n                this._pendingSeekTime = null;\n            } catch (e) {\n                // IE11 may throw InvalidStateError if readyState === 0\n                // Defer set currentTime operation after loadedmetadata\n            }\n        }\n    }\n\n    detachMediaElement() {\n        if (this._mediaElement) {\n            this._mediaElement.src = '';\n            this._mediaElement.removeAttribute('src');\n            this._mediaElement.removeEventListener('loadedmetadata', this.e.onvLoadedMetadata);\n            this._mediaElement = null;\n        }\n        if (this._statisticsReporter != null) {\n            window.clearInterval(this._statisticsReporter);\n            this._statisticsReporter = null;\n        }\n    }\n\n    load() {\n        if (!this._mediaElement) {\n            throw new IllegalStateException('HTMLMediaElement must be attached before load()!');\n        }\n        this._mediaElement.src = this._mediaDataSource.url;\n\n        if (this._mediaElement.readyState > 0) {\n            this._mediaElement.currentTime = 0;\n        }\n\n        this._mediaElement.preload = 'auto';\n        this._mediaElement.load();\n        this._statisticsReporter = window.setInterval(\n            this._reportStatisticsInfo.bind(this),\n        this._config.statisticsInfoReportInterval);\n    }\n\n    unload() {\n        if (this._mediaElement) {\n            this._mediaElement.src = '';\n            this._mediaElement.removeAttribute('src');\n        }\n        if (this._statisticsReporter != null) {\n            window.clearInterval(this._statisticsReporter);\n            this._statisticsReporter = null;\n        }\n    }\n\n    play() {\n        this._mediaElement.play();\n    }\n\n    pause() {\n        this._mediaElement.pause();\n    }\n\n    get type() {\n        return this._type;\n    }\n\n    get buffered() {\n        return this._mediaElement.buffered;\n    }\n\n    get duration() {\n        return this._mediaElement.duration;\n    }\n\n    get volume() {\n        return this._mediaElement.volume;\n    }\n\n    set volume(value) {\n        this._mediaElement.volume = value;\n    }\n\n    get muted() {\n        return this._mediaElement.muted;\n    }\n\n    set muted(muted) {\n        this._mediaElement.muted = muted;\n    }\n\n    get currentTime() {\n        if (this._mediaElement) {\n            return this._mediaElement.currentTime;\n        }\n        return 0;\n    }\n\n    set currentTime(seconds) {\n        if (this._mediaElement) {\n            this._mediaElement.currentTime = seconds;\n        } else {\n            this._pendingSeekTime = seconds;\n        }\n    }\n\n    get mediaInfo() {\n        let info = {\n            mimeType: 'video/' + this._mediaDataSource.type\n        };\n        if (this._mediaElement) {\n            info.duration = Math.floor(this._mediaElement.duration * 1000);\n            info.width = this._mediaElement.videoWidth;\n            info.height = this._mediaElement.videoHeight;\n        }\n        return info;\n    }\n\n    get statisticsInfo() {\n        let info = {\n            playerType: this._type,\n            url: this._mediaDataSource.url\n        };\n\n        let hasQualityInfo = true;\n        let decoded = 0;\n        let dropped = 0;\n\n        if (this._mediaElement.getVideoPlaybackQuality) {\n            let quality = this._mediaElement.getVideoPlaybackQuality();\n            decoded = quality.totalVideoFrames;\n            dropped = quality.droppedVideoFrames;\n        } else if (this._mediaElement.webkitDecodedFrameCount != undefined) {\n            decoded = this._mediaElement.webkitDecodedFrameCount;\n            dropped = this._mediaElement.webkitDroppedFrameCount;\n        } else {\n            hasQualityInfo = false;\n        }\n\n        if (hasQualityInfo) {\n            info.decodedFrames = decoded;\n            info.droppedFrames = dropped;\n        }\n        \n        return info;\n    }\n\n    _onvLoadedMetadata(e) {\n        if (this._pendingSeekTime != null) {\n            this._mediaElement.currentTime = this._pendingSeekTime;\n            this._pendingSeekTime = null;\n        }\n        this._emitter.emit(PlayerEvents.MEDIA_INFO, this.mediaInfo);\n    }\n\n    _reportStatisticsInfo() {\n        this._emitter.emit(PlayerEvents.STATISTICS_INFO, this.statisticsInfo);\n    }\n\n}\n\nexport default NativePlayer;","import {LoaderErrors} from '../io/loader.js';\nimport DemuxErrors from '../demux/demux-errors.js';\n\nexport const ErrorTypes = {\n    NETWORK_ERROR: 'NetworkError',\n    MEDIA_ERROR: 'MediaError',\n    OTHER_ERROR: 'OtherError'\n};\n\nexport const ErrorDetails = {\n    NETWORK_EXCEPTION: LoaderErrors.EXCEPTION,\n    NETWORK_STATUS_CODE_INVALID: LoaderErrors.HTTP_STATUS_CODE_INVALID,\n    NETWORK_TIMEOUT: LoaderErrors.CONNECTING_TIMEOUT,\n    NETWORK_UNRECOVERABLE_EARLY_EOF: LoaderErrors.UNRECOVERABLE_EARLY_EOF,\n\n    MEDIA_MSE_ERROR: 'MediaMSEError',\n\n    MEDIA_FORMAT_ERROR: DemuxErrors.FORMAT_ERROR,\n    MEDIA_FORMAT_UNSUPPORTED: DemuxErrors.FORMAT_UNSUPPORTED,\n    MEDIA_CODEC_UNSUPPORTED: DemuxErrors.CODEC_UNSUPPORTED\n};","const PlayerEvents = {\n    ERROR: 'error',\n    LOADING_COMPLETE: 'loading_complete',\n    RECOVERED_EARLY_EOF: 'recovered_early_eof',\n    MEDIA_INFO: 'media_info',\n    STATISTICS_INFO: 'statistics_info'\n};\n\nexport default PlayerEvents;","// from hls.js/src/helper/aac.js\n\nclass AAC {\n\n    static getSilentFrame(channelCount) {\n        if (channelCount === 1) {\n            return new Uint8Array([0x00, 0xc8, 0x00, 0x80, 0x23, 0x80]);\n        } else if (channelCount === 2) {\n            return new Uint8Array([0x21, 0x00, 0x49, 0x90, 0x02, 0x19, 0x00, 0x23, 0x80]);\n        } else if (channelCount === 3) {\n            return new Uint8Array([0x00, 0xc8, 0x00, 0x80, 0x20, 0x84, 0x01, 0x26, 0x40, 0x08, 0x64, 0x00, 0x8e]);\n        } else if (channelCount === 4) {\n            return new Uint8Array([0x00, 0xc8, 0x00, 0x80, 0x20, 0x84, 0x01, 0x26, 0x40, 0x08, 0x64, 0x00, 0x80, 0x2c, 0x80, 0x08, 0x02, 0x38]);\n        } else if (channelCount === 5) {\n            return new Uint8Array([0x00, 0xc8, 0x00, 0x80, 0x20, 0x84, 0x01, 0x26, 0x40, 0x08, 0x64, 0x00, 0x82, 0x30, 0x04, 0x99, 0x00, 0x21, 0x90, 0x02, 0x38]);\n        } else if (channelCount === 6) {\n            return new Uint8Array([0x00, 0xc8, 0x00, 0x80, 0x20, 0x84, 0x01, 0x26, 0x40, 0x08, 0x64, 0x00, 0x82, 0x30, 0x04, 0x99, 0x00, 0x21, 0x90, 0x02, 0x00, 0xb2, 0x00, 0x20, 0x08, 0xe0]);\n        }\n        return null;\n    }\n\n}\n\nexport default AAC;","//  MP4 boxes generator for ISO BMFF (ISO Base Media File Format, defined in ISO/IEC 14496-12)\n\nclass MP4 {\n\n    static init() {\n        MP4.types = {\n            avc1: [], avcC: [], btrt: [], dinf: [],\n            dref: [], esds: [], ftyp: [], hdlr: [],\n            mdat: [], mdhd: [], mdia: [], mfhd: [],\n            minf: [], moof: [], moov: [], mp4a: [],\n            mvex: [], mvhd: [], sdtp: [], stbl: [],\n            stco: [], stsc: [], stsd: [], stsz: [],\n            stts: [], tfdt: [], tfhd: [], traf: [],\n            trak: [], trun: [], trex: [], tkhd: [],\n            vmhd: [], smhd: []\n        };\n\n        for (let name in MP4.types) {\n            if (MP4.types.hasOwnProperty(name)) {\n                MP4.types[name] = [\n                    name.charCodeAt(0),\n                    name.charCodeAt(1),\n                    name.charCodeAt(2),\n                    name.charCodeAt(3)\n                ];\n            }\n        }\n\n        let constants = MP4.constants = {};\n\n        constants.FTYP = new Uint8Array([\n            0x69, 0x73, 0x6F, 0x6D,  // major_brand: isom\n            0x0,  0x0,  0x0,  0x1,   // minor_version: 0x01\n            0x69, 0x73, 0x6F, 0x6D,  // isom\n            0x61, 0x76, 0x63, 0x31   // avc1\n        ]);\n\n        constants.STSD_PREFIX = new Uint8Array([\n            0x00, 0x00, 0x00, 0x00,  // version(0) + flags\n            0x00, 0x00, 0x00, 0x01   // entry_count\n        ]);\n\n        constants.STTS = new Uint8Array([\n            0x00, 0x00, 0x00, 0x00,  // version(0) + flags\n            0x00, 0x00, 0x00, 0x00   // entry_count\n        ]);\n\n        constants.STSC = constants.STCO = constants.STTS;\n\n        constants.STSZ = new Uint8Array([\n            0x00, 0x00, 0x00, 0x00,  // version(0) + flags\n            0x00, 0x00, 0x00, 0x00,  // sample_size\n            0x00, 0x00, 0x00, 0x00   // sample_count\n        ]);\n\n        constants.HDLR_VIDEO = new Uint8Array([\n            0x00, 0x00, 0x00, 0x00,  // version(0) + flags\n            0x00, 0x00, 0x00, 0x00,  // pre_defined\n            0x76, 0x69, 0x64, 0x65,  // handler_type: 'vide'\n            0x00, 0x00, 0x00, 0x00,  // reserved: 3 * 4 bytes\n            0x00, 0x00, 0x00, 0x00,\n            0x00, 0x00, 0x00, 0x00,\n            0x56, 0x69, 0x64, 0x65,\n            0x6F, 0x48, 0x61, 0x6E,\n            0x64, 0x6C, 0x65, 0x72, 0x00  // name: VideoHandler\n        ]);\n\n        constants.HDLR_AUDIO = new Uint8Array([\n            0x00, 0x00, 0x00, 0x00,  // version(0) + flags\n            0x00, 0x00, 0x00, 0x00,  // pre_defined\n            0x73, 0x6F, 0x75, 0x6E,  // handler_type: 'soun'\n            0x00, 0x00, 0x00, 0x00,  // reserved: 3 * 4 bytes\n            0x00, 0x00, 0x00, 0x00,\n            0x00, 0x00, 0x00, 0x00,\n            0x53, 0x6F, 0x75, 0x6E,\n            0x64, 0x48, 0x61, 0x6E,\n            0x64, 0x6C, 0x65, 0x72, 0x00  // name: SoundHandler\n        ]);\n\n        constants.DREF = new Uint8Array([\n            0x00, 0x00, 0x00, 0x00,  // version(0) + flags\n            0x00, 0x00, 0x00, 0x01,  // entry_count\n            0x00, 0x00, 0x00, 0x0C,  // entry_size\n            0x75, 0x72, 0x6C, 0x20,  // type 'url '\n            0x00, 0x00, 0x00, 0x01   // version(0) + flags\n        ]);\n\n        // Sound media header\n        constants.SMHD = new Uint8Array([\n            0x00, 0x00, 0x00, 0x00,  // version(0) + flags\n            0x00, 0x00, 0x00, 0x00   // balance(2) + reserved(2)\n        ]);\n\n        // video media header\n        constants.VMHD = new Uint8Array([\n            0x00, 0x00, 0x00, 0x01,  // version(0) + flags\n            0x00, 0x00,              // graphicsmode: 2 bytes\n            0x00, 0x00, 0x00, 0x00,  // opcolor: 3 * 2 bytes\n            0x00, 0x00\n        ]);\n    }\n\n    // Generate a box\n    static box(type) {\n        let size = 8;\n        let result = null;\n        let datas = Array.prototype.slice.call(arguments, 1);\n        let arrayCount = datas.length;\n\n        for (let i = 0; i < arrayCount; i++) {\n            size += datas[i].byteLength;\n        }\n\n        result = new Uint8Array(size);\n        result[0] = (size >>> 24) & 0xFF;  // size\n        result[1] = (size >>> 16) & 0xFF;\n        result[2] = (size >>>  8) & 0xFF;\n        result[3] = (size) & 0xFF;\n\n        result.set(type, 4);  // type\n\n        let offset = 8;\n        for (let i = 0; i < arrayCount; i++) {  // data body\n            result.set(datas[i], offset);\n            offset += datas[i].byteLength;\n        }\n\n        return result;\n    }\n\n    // emit ftyp & moov\n    static generateInitSegment(meta) {\n        let ftyp = MP4.box(MP4.types.ftyp, MP4.constants.FTYP);\n        let moov = MP4.moov(meta);\n\n        let result = new Uint8Array(ftyp.byteLength + moov.byteLength);\n        result.set(ftyp, 0);\n        result.set(moov, ftyp.byteLength);\n        return result;\n    }\n\n    // Movie metadata box\n    static moov(meta) {\n        let mvhd = MP4.mvhd(meta.timescale, meta.duration);\n        let trak = MP4.trak(meta);\n        let mvex = MP4.mvex(meta);\n        return MP4.box(MP4.types.moov, mvhd, trak, mvex);\n    }\n\n    // Movie header box\n    static mvhd(timescale, duration) {\n        return MP4.box(MP4.types.mvhd, new Uint8Array([\n            0x00, 0x00, 0x00, 0x00,  // version(0) + flags\n            0x00, 0x00, 0x00, 0x00,  // creation_time\n            0x00, 0x00, 0x00, 0x00,  // modification_time\n            (timescale >>> 24) & 0xFF,  // timescale: 4 bytes\n            (timescale >>> 16) & 0xFF,\n            (timescale >>>  8) & 0xFF,\n            (timescale) & 0xFF,\n            (duration >>> 24) & 0xFF,   // duration: 4 bytes\n            (duration >>> 16) & 0xFF,\n            (duration >>>  8) & 0xFF,\n            (duration) & 0xFF,\n            0x00, 0x01, 0x00, 0x00,  // Preferred rate: 1.0\n            0x01, 0x00, 0x00, 0x00,  // PreferredVolume(1.0, 2bytes) + reserved(2bytes)\n            0x00, 0x00, 0x00, 0x00,  // reserved: 4 + 4 bytes\n            0x00, 0x00, 0x00, 0x00,\n            0x00, 0x01, 0x00, 0x00,  // ----begin composition matrix----\n            0x00, 0x00, 0x00, 0x00,\n            0x00, 0x00, 0x00, 0x00,\n            0x00, 0x00, 0x00, 0x00,\n            0x00, 0x01, 0x00, 0x00,\n            0x00, 0x00, 0x00, 0x00,\n            0x00, 0x00, 0x00, 0x00,\n            0x00, 0x00, 0x00, 0x00,\n            0x40, 0x00, 0x00, 0x00,  // ----end composition matrix----\n            0x00, 0x00, 0x00, 0x00,  // ----begin pre_defined 6 * 4 bytes----\n            0x00, 0x00, 0x00, 0x00,\n            0x00, 0x00, 0x00, 0x00,\n            0x00, 0x00, 0x00, 0x00,\n            0x00, 0x00, 0x00, 0x00,\n            0x00, 0x00, 0x00, 0x00,  // ----end pre_defined 6 * 4 bytes----\n            0xFF, 0xFF, 0xFF, 0xFF   // next_track_ID\n        ]));\n    }\n\n    // Track box\n    static trak(meta) {\n        return MP4.box(MP4.types.trak, MP4.tkhd(meta), MP4.mdia(meta));\n    }\n\n    // Track header box\n    static tkhd(meta) {\n        let trackId = meta.id, duration = meta.duration;\n        let width = meta.presentWidth, height = meta.presentHeight;\n\n        return MP4.box(MP4.types.tkhd, new Uint8Array([\n            0x00, 0x00, 0x00, 0x07,  // version(0) + flags\n            0x00, 0x00, 0x00, 0x00,  // creation_time\n            0x00, 0x00, 0x00, 0x00,  // modification_time\n            (trackId >>> 24) & 0xFF,  // track_ID: 4 bytes\n            (trackId >>> 16) & 0xFF,\n            (trackId >>>  8) & 0xFF,\n            (trackId) & 0xFF,\n            0x00, 0x00, 0x00, 0x00,  // reserved: 4 bytes\n            (duration >>> 24) & 0xFF, // duration: 4 bytes\n            (duration >>> 16) & 0xFF,\n            (duration >>>  8) & 0xFF,\n            (duration) & 0xFF,\n            0x00, 0x00, 0x00, 0x00,  // reserved: 2 * 4 bytes\n            0x00, 0x00, 0x00, 0x00,\n            0x00, 0x00, 0x00, 0x00,  // layer(2bytes) + alternate_group(2bytes)\n            0x00, 0x00, 0x00, 0x00,  // volume(2bytes) + reserved(2bytes)\n            0x00, 0x01, 0x00, 0x00,  // ----begin composition matrix----\n            0x00, 0x00, 0x00, 0x00,\n            0x00, 0x00, 0x00, 0x00,\n            0x00, 0x00, 0x00, 0x00,\n            0x00, 0x01, 0x00, 0x00,\n            0x00, 0x00, 0x00, 0x00,\n            0x00, 0x00, 0x00, 0x00,\n            0x00, 0x00, 0x00, 0x00,\n            0x40, 0x00, 0x00, 0x00,  // ----end composition matrix----\n            (width >>> 8) & 0xFF,    // width and height\n            (width) & 0xFF,\n            0x00, 0x00,\n            (height >>> 8) & 0xFF,\n            (height) & 0xFF,\n            0x00, 0x00\n        ]));\n    }\n\n    // Media Box\n    static mdia(meta) {\n        return MP4.box(MP4.types.mdia, MP4.mdhd(meta), MP4.hdlr(meta), MP4.minf(meta));\n    }\n\n    // Media header box\n    static mdhd(meta) {\n        let timescale = meta.timescale;\n        let duration = meta.duration;\n        return MP4.box(MP4.types.mdhd, new Uint8Array([\n            0x00, 0x00, 0x00, 0x00,  // version(0) + flags\n            0x00, 0x00, 0x00, 0x00,  // creation_time\n            0x00, 0x00, 0x00, 0x00,  // modification_time\n            (timescale >>> 24) & 0xFF,  // timescale: 4 bytes\n            (timescale >>> 16) & 0xFF,\n            (timescale >>>  8) & 0xFF,\n            (timescale) & 0xFF,\n            (duration >>> 24) & 0xFF,   // duration: 4 bytes\n            (duration >>> 16) & 0xFF,\n            (duration >>>  8) & 0xFF,\n            (duration) & 0xFF,\n            0x55, 0xC4,             // language: und (undetermined)\n            0x00, 0x00              // pre_defined = 0\n        ]));\n    }\n\n    // Media handler reference box\n    static hdlr(meta) {\n        let data = null;\n        if (meta.type === 'audio') {\n            data = MP4.constants.HDLR_AUDIO;\n        } else {\n            data = MP4.constants.HDLR_VIDEO;\n        }\n        return MP4.box(MP4.types.hdlr, data);\n    }\n\n    // Media infomation box\n    static minf(meta) {\n        let xmhd = null;\n        if (meta.type === 'audio') {\n            xmhd = MP4.box(MP4.types.smhd, MP4.constants.SMHD);\n        } else {\n            xmhd = MP4.box(MP4.types.vmhd, MP4.constants.VMHD);\n        }\n        return MP4.box(MP4.types.minf, xmhd, MP4.dinf(), MP4.stbl(meta));\n    }\n\n    // Data infomation box\n    static dinf() {\n        let result = MP4.box(MP4.types.dinf,\n            MP4.box(MP4.types.dref, MP4.constants.DREF)\n        );\n        return result;\n    }\n\n    // Sample table box\n    static stbl(meta) {\n        let result = MP4.box(MP4.types.stbl,  // type: stbl\n            MP4.stsd(meta),  // Sample Description Table\n            MP4.box(MP4.types.stts, MP4.constants.STTS),  // Time-To-Sample\n            MP4.box(MP4.types.stsc, MP4.constants.STSC),  // Sample-To-Chunk\n            MP4.box(MP4.types.stsz, MP4.constants.STSZ),  // Sample size\n            MP4.box(MP4.types.stco, MP4.constants.STCO)   // Chunk offset\n        ); \n        return result; \n    }\n\n    // Sample description box\n    static stsd(meta) {\n        if (meta.type === 'audio') {\n            return MP4.box(MP4.types.stsd, MP4.constants.STSD_PREFIX, MP4.mp4a(meta));\n        } else {\n            return MP4.box(MP4.types.stsd, MP4.constants.STSD_PREFIX, MP4.avc1(meta));\n        }\n    }\n\n    static mp4a(meta) {\n        let channelCount = meta.channelCount;\n        let sampleRate = meta.audioSampleRate;\n\n        let data = new Uint8Array([\n            0x00, 0x00, 0x00, 0x00,  // reserved(4)\n            0x00, 0x00, 0x00, 0x01,  // reserved(2) + data_reference_index(2)\n            0x00, 0x00, 0x00, 0x00,  // reserved: 2 * 4 bytes\n            0x00, 0x00, 0x00, 0x00,\n            0x00, channelCount,      // channelCount(2)\n            0x00, 0x10,              // sampleSize(2)\n            0x00, 0x00, 0x00, 0x00,  // reserved(4)\n            (sampleRate >>> 8) & 0xFF,  // Audio sample rate\n            (sampleRate) & 0xFF,\n            0x00, 0x00\n        ]);\n\n        return MP4.box(MP4.types.mp4a, data, MP4.esds(meta));\n    }\n\n    static esds(meta) {\n        let config = meta.config;\n        let configSize = config.length;\n        let data = new Uint8Array([\n            0x00, 0x00, 0x00, 0x00,  // version 0 + flags\n\n            0x03,                    // descriptor_type\n            0x17 + configSize,       // length3\n            0x00, 0x01,              // es_id\n            0x00,                    // stream_priority\n\n            0x04,                    // descriptor_type\n            0x0F + configSize,       // length\n            0x40,                    // codec: mpeg4_audio\n            0x15,                    // stream_type: Audio\n            0x00, 0x00, 0x00,        // buffer_size\n            0x00, 0x00, 0x00, 0x00,  // maxBitrate\n            0x00, 0x00, 0x00, 0x00,  // avgBitrate\n\n            0x05                     // descriptor_type\n        ].concat([\n            configSize\n        ]).concat(\n            config\n        ).concat([\n            0x06, 0x01, 0x02         // GASpecificConfig\n        ]));\n        return MP4.box(MP4.types.esds, data);\n    }\n\n    static avc1(meta) {\n        let avcc = meta.avcc;\n        let width = meta.codecWidth, height = meta.codecHeight;\n\n        let data = new Uint8Array([\n            0x00, 0x00, 0x00, 0x00,  // reserved(4)\n            0x00, 0x00, 0x00, 0x01,  // reserved(2) + data_reference_index(2)\n            0x00, 0x00, 0x00, 0x00,  // pre_defined(2) + reserved(2)\n            0x00, 0x00, 0x00, 0x00,  // pre_defined: 3 * 4 bytes\n            0x00, 0x00, 0x00, 0x00,\n            0x00, 0x00, 0x00, 0x00,\n            (width >>> 8) & 0xFF,    // width: 2 bytes\n            (width) & 0xFF,\n            (height >>> 8) & 0xFF,   // height: 2 bytes\n            (height) & 0xFF,\n            0x00, 0x48, 0x00, 0x00,  // horizresolution: 4 bytes\n            0x00, 0x48, 0x00, 0x00,  // vertresolution: 4 bytes\n            0x00, 0x00, 0x00, 0x00,  // reserved: 4 bytes\n            0x00, 0x01,              // frame_count\n            0x0A,                    // strlen\n            0x78, 0x71, 0x71, 0x2F,  // compressorname: 32 bytes\n            0x66, 0x6C, 0x76, 0x2E,\n            0x6A, 0x73, 0x00, 0x00,\n            0x00, 0x00, 0x00, 0x00,\n            0x00, 0x00, 0x00, 0x00,\n            0x00, 0x00, 0x00, 0x00,\n            0x00, 0x00, 0x00, 0x00,\n            0x00, 0x00, 0x00,\n            0x00, 0x18,              // depth\n            0xFF, 0xFF               // pre_defined = -1\n        ]);\n        return MP4.box(MP4.types.avc1, data, MP4.box(MP4.types.avcC, avcc));\n    }\n\n    // Movie Extends box\n    static mvex(meta) {\n        return MP4.box(MP4.types.mvex, MP4.trex(meta));\n    }\n\n    // Track Extends box\n    static trex(meta) {\n        let trackId = meta.id;\n        let data = new Uint8Array([\n            0x00, 0x00, 0x00, 0x00,  // version(0) + flags\n            (trackId >>> 24) & 0xFF, // track_ID\n            (trackId >>> 16) & 0xFF,\n            (trackId >>>  8) & 0xFF,\n            (trackId) & 0xFF,\n            0x00, 0x00, 0x00, 0x01,  // default_sample_description_index\n            0x00, 0x00, 0x00, 0x00,  // default_sample_duration\n            0x00, 0x00, 0x00, 0x00,  // default_sample_size\n            0x00, 0x01, 0x00, 0x01   // default_sample_flags\n        ]);\n        return MP4.box(MP4.types.trex, data);\n    }\n\n    // Movie fragment box\n    static moof(track, baseMediaDecodeTime) {\n        return MP4.box(MP4.types.moof, MP4.mfhd(track.sequenceNumber), MP4.traf(track, baseMediaDecodeTime));\n    }\n\n    static mfhd(sequenceNumber) {\n        let data = new Uint8Array([\n            0x00, 0x00, 0x00, 0x00,\n            (sequenceNumber >>> 24) & 0xFF,  // sequence_number: int32\n            (sequenceNumber >>> 16) & 0xFF,\n            (sequenceNumber >>>  8) & 0xFF,\n            (sequenceNumber) & 0xFF\n        ]);\n        return MP4.box(MP4.types.mfhd, data);\n    }\n\n    // Track fragment box\n    static traf(track, baseMediaDecodeTime) {\n        let trackId = track.id;\n\n        // Track fragment header box\n        let tfhd = MP4.box(MP4.types.tfhd, new Uint8Array([\n            0x00, 0x00, 0x00, 0x00,  // version(0) & flags\n            (trackId >>> 24) & 0xFF, // track_ID\n            (trackId >>> 16) & 0xFF,\n            (trackId >>>  8) & 0xFF,\n            (trackId) & 0xFF\n        ]));\n        // Track Fragment Decode Time\n        let tfdt = MP4.box(MP4.types.tfdt, new Uint8Array([\n            0x00, 0x00, 0x00, 0x00,  // version(0) & flags\n            (baseMediaDecodeTime >>> 24) & 0xFF,  // baseMediaDecodeTime: int32\n            (baseMediaDecodeTime >>> 16) & 0xFF,\n            (baseMediaDecodeTime >>>  8) & 0xFF,\n            (baseMediaDecodeTime) & 0xFF\n        ]));\n        let sdtp = MP4.sdtp(track);\n        let trun = MP4.trun(track, sdtp.byteLength + 16 + 16 + 8 + 16 + 8 + 8);\n\n        return MP4.box(MP4.types.traf, tfhd, tfdt, trun, sdtp);\n    }\n\n    // Sample Dependency Type box\n    static sdtp(track) {\n        let samples = track.samples || [];\n        let sampleCount = samples.length;\n        let data = new Uint8Array(4 + sampleCount);\n        // 0~4 bytes: version(0) & flags\n        for (let i = 0; i < sampleCount; i++) {\n            let flags = samples[i].flags;\n            data[i + 4] = (flags.isLeading << 6)    // is_leading: 2 (bit)\n                        | (flags.dependsOn << 4)    // sample_depends_on\n                        | (flags.isDependedOn << 2) // sample_is_depended_on\n                        | (flags.hasRedundancy);    // sample_has_redundancy\n        }\n        return MP4.box(MP4.types.sdtp, data);\n    }\n\n    // Track fragment run box\n    static trun(track, offset) {\n        let samples = track.samples || [];\n        let sampleCount = samples.length;\n        let dataSize = 12 + 16 * sampleCount;\n        let data = new Uint8Array(dataSize);\n        offset += 8 + dataSize;\n\n        data.set([\n            0x00, 0x00, 0x0F, 0x01,      // version(0) & flags\n            (sampleCount >>> 24) & 0xFF, // sample_count\n            (sampleCount >>> 16) & 0xFF,\n            (sampleCount >>>  8) & 0xFF,\n            (sampleCount) & 0xFF,\n            (offset >>> 24) & 0xFF,      // data_offset\n            (offset >>> 16) & 0xFF,\n            (offset >>>  8) & 0xFF,\n            (offset) & 0xFF\n        ], 0);\n\n        for (let i = 0; i < sampleCount; i++) {\n            let duration = samples[i].duration;\n            let size = samples[i].size;\n            let flags = samples[i].flags;\n            let cts = samples[i].cts;\n            data.set([\n                (duration >>> 24) & 0xFF,  // sample_duration\n                (duration >>> 16) & 0xFF,\n                (duration >>>  8) & 0xFF,\n                (duration) & 0xFF,\n                (size >>> 24) & 0xFF,      // sample_size\n                (size >>> 16) & 0xFF,\n                (size >>>  8) & 0xFF,\n                (size) & 0xFF,\n                (flags.isLeading << 2) | flags.dependsOn,  // sample_flags\n                (flags.isDependedOn << 6) | (flags.hasRedundancy << 4) | flags.isNonSync,\n                0x00, 0x00,                // sample_degradation_priority\n                (cts >>> 24) & 0xFF,       // sample_composition_time_offset\n                (cts >>> 16) & 0xFF,\n                (cts >>>  8) & 0xFF,\n                (cts) & 0xFF\n            ], 12 + 16 * i);\n        }\n        return MP4.box(MP4.types.trun, data);\n    }\n\n    static mdat(data) {\n        return MP4.box(MP4.types.mdat, data);\n    }\n\n}\n\nMP4.init();\n\nexport default MP4;","import Log from '../utils/logger.js';\nimport MP4 from './mp4-generator.js';\nimport AAC from './aac-silent.js';\nimport Browser from '../utils/browser.js';\nimport {SampleInfo, MediaSegmentInfo, MediaSegmentInfoList} from '../core/media-segment-info.js';\nimport {IllegalStateException} from '../utils/exception.js';\n\n\n// Fragmented mp4 remuxer\nclass MP4Remuxer {\n\n    constructor(config) {\n        this.TAG = this.constructor.name;\n\n        this._config = config;\n        this._isLive = (config.isLive === true) ? true : false;\n\n        this._dtsBase = -1;\n        this._dtsBaseInited = false;\n        this._audioDtsBase = Infinity;\n        this._videoDtsBase = Infinity;\n        this._audioNextDts = undefined;\n        this._videoNextDts = undefined;\n\n        this._audioMeta = null;\n        this._videoMeta = null;\n\n        this._audioSegmentInfoList = new MediaSegmentInfoList('audio');\n        this._videoSegmentInfoList = new MediaSegmentInfoList('video');\n\n        this._onInitSegment = null;\n        this._onMediaSegment = null;\n\n        // Workaround for chrome < 50: Always force first sample as a Random Access Point in media segment\n        // see https://bugs.chromium.org/p/chromium/issues/detail?id=229412\n        this._forceFirstIDR = (Browser.chrome &&\n                              (Browser.version.major < 50 ||\n                              (Browser.version.major === 50 && Browser.version.build < 2661))) ? true : false;\n\n        // Workaround for IE11/Edge: Fill silent aac frame after keyframe-seeking\n        // Make audio beginDts equals with video beginDts, in order to fix seek freeze\n        this._fillSilentAfterSeek = (Browser.msedge || Browser.msie);\n    }\n\n    destroy() {\n        this._dtsBase = -1;\n        this._dtsBaseInited = false;\n        this._audioMeta = null;\n        this._videoMeta = null;\n        this._audioSegmentInfoList.clear();\n        this._audioSegmentInfoList = null;\n        this._videoSegmentInfoList.clear();\n        this._videoSegmentInfoList = null;\n        this._onInitSegment = null;\n        this._onMediaSegment = null;\n    }\n\n    bindDataSource(producer) {\n        producer.onDataAvailable = this.remux.bind(this);\n        producer.onTrackMetadata = this._onTrackMetadataReceived.bind(this);\n        return this;\n    }\n\n    /* prototype: function onInitSegment(type: string, initSegment: ArrayBuffer): void\n       InitSegment: {\n           type: string,\n           data: ArrayBuffer,\n           codec: string,\n           container: string\n       }\n    */\n    get onInitSegment() {\n        return this._onInitSegment;\n    }\n\n    set onInitSegment(callback) {\n        this._onInitSegment = callback;\n    }\n\n    /* prototype: function onMediaSegment(type: string, mediaSegment: MediaSegment): void\n       MediaSegment: {\n           type: string,\n           data: ArrayBuffer,\n           sampleCount: int32\n           info: MediaSegmentInfo\n       }\n    */\n    get onMediaSegment() {\n        return this._onMediaSegment;\n    }\n\n    set onMediaSegment(callback) {\n        this._onMediaSegment = callback;\n    }\n\n    insertDiscontinuity() {\n        this._audioNextDts = this._videoNextDts = undefined;\n    }\n\n    seek(originalDts) {\n        this._videoSegmentInfoList.clear();\n        this._audioSegmentInfoList.clear();\n    }\n\n    remux(audioTrack, videoTrack) {\n        if (!this._onMediaSegment) {\n            throw new IllegalStateException('MP4Remuxer: onMediaSegment callback must be specificed!');\n        }\n        if (!this._dtsBaseInited) {\n            this._calculateDtsBase(audioTrack, videoTrack);\n        }\n        this._remuxVideo(videoTrack);\n        this._remuxAudio(audioTrack);\n    }\n\n    _onTrackMetadataReceived(type, metadata) {\n        let metabox = null;\n\n        if (type === 'audio') {\n            this._audioMeta = metadata;\n            metabox = MP4.generateInitSegment(metadata);\n        } else if (type === 'video') {\n            this._videoMeta = metadata;\n            metabox = MP4.generateInitSegment(metadata);\n        } else {\n            return;\n        }\n\n        // dispatch metabox (Initialization Segment)\n        if (!this._onInitSegment) {\n            throw new IllegalStateException('MP4Remuxer: onInitSegment callback must be specified!');\n        }\n        this._onInitSegment(type, {\n            type: type,\n            data: metabox.buffer,\n            codec: metadata.codec,\n            container: `${type}/mp4`\n        });\n    }\n\n    _calculateDtsBase(audioTrack, videoTrack) {\n        if (this._dtsBaseInited) {\n            return;\n        }\n\n        if (audioTrack.samples && audioTrack.samples.length) {\n            this._audioDtsBase = audioTrack.samples[0].dts;\n        }\n        if (videoTrack.samples && videoTrack.samples.length) {\n            this._videoDtsBase = videoTrack.samples[0].dts;\n        }\n\n        this._dtsBase = Math.min(this._audioDtsBase, this._videoDtsBase);\n        this._dtsBaseInited = true;\n    }\n\n    _remuxAudio(audioTrack) {\n        let track = audioTrack;\n        let samples = track.samples;\n        let dtsCorrection = undefined;\n        let firstDts = -1, lastDts = -1, lastPts = -1;\n\n        let remuxSilentFrame = false;\n        let silentFrameDuration = -1;\n\n        if (!samples || samples.length === 0) {\n            return;\n        }\n\n        let bytes = 8 + track.length;\n        let mdatbox = new Uint8Array(bytes);\n        mdatbox[0] = (bytes >>> 24) & 0xFF;\n        mdatbox[1] = (bytes >>> 16) & 0xFF;\n        mdatbox[2] = (bytes >>>  8) & 0xFF;\n        mdatbox[3] = (bytes) & 0xFF;\n\n        mdatbox.set(MP4.types.mdat, 4);\n\n        let offset = 8;  // size + type\n        let mp4Samples = [];\n\n        while (samples.length) {\n            let aacSample = samples.shift();\n            let unit = aacSample.unit;\n            let originalDts = aacSample.dts - this._dtsBase;\n\n            if (dtsCorrection == undefined) {\n                if (this._audioNextDts == undefined) {\n                    if (this._audioSegmentInfoList.isEmpty()) {\n                        dtsCorrection = 0;\n                        if (this._fillSilentAfterSeek && !this._videoSegmentInfoList.isEmpty()) {\n                            remuxSilentFrame = true;\n                        }\n                    } else {\n                        let lastSample = this._audioSegmentInfoList.getLastSampleBefore(originalDts);\n                        if (lastSample != null) {\n                            let distance = (originalDts - (lastSample.originalDts + lastSample.duration));\n                            if (distance <= 3) {\n                                distance = 0;\n                            }\n                            let expectedDts = lastSample.dts + lastSample.duration + distance;\n                            dtsCorrection = originalDts - expectedDts;\n                        } else {  // lastSample == null\n                            dtsCorrection = 0;\n                        }\n                    }\n                } else {\n                    dtsCorrection = originalDts - this._audioNextDts;\n                }\n            }\n\n            let dts = originalDts - dtsCorrection;\n            if (remuxSilentFrame) {\n                // align audio segment beginDts to match with current video segment's beginDts\n                let videoSegment = this._videoSegmentInfoList.getLastSegmentBefore(originalDts);\n                if (videoSegment != null && videoSegment.beginDts < dts) {\n                    silentFrameDuration = dts - videoSegment.beginDts;\n                    dts = videoSegment.beginDts;\n                } else {\n                    remuxSilentFrame = false;\n                }\n            }\n            if (firstDts === -1) {\n                firstDts = dts;\n            }\n\n            if (remuxSilentFrame) {\n                remuxSilentFrame = false;\n                samples.unshift(aacSample);\n\n                let frame = this._generateSilentAudio(dts, silentFrameDuration);\n                if (frame == null) {\n                    continue;\n                }\n                let mp4Sample = frame.mp4Sample;\n                let unit = frame.unit;\n\n                mp4Samples.push(mp4Sample);\n\n                // re-allocate mdatbox buffer with new size, to fit with this silent frame\n                bytes += unit.byteLength;\n                mdatbox = new Uint8Array(bytes);\n                mdatbox[0] = (bytes >>> 24) & 0xFF;\n                mdatbox[1] = (bytes >>> 16) & 0xFF;\n                mdatbox[2] = (bytes >>>  8) & 0xFF;\n                mdatbox[3] = (bytes) & 0xFF;\n                mdatbox.set(MP4.types.mdat, 4);\n\n                // fill data now\n                mdatbox.set(unit, offset);\n                offset += unit.byteLength;\n                continue;\n            }\n\n            let sampleDuration = 0;\n\n            if (samples.length >= 1) {\n                let nextDts = samples[0].dts - this._dtsBase - dtsCorrection;\n                sampleDuration = nextDts - dts;\n            } else {\n                if (mp4Samples.length >= 1) {  // use second last sample duration\n                    sampleDuration = mp4Samples[mp4Samples.length - 1].duration;\n                } else {  // the only one sample, use reference sample duration\n                    sampleDuration = this._audioMeta.refSampleDuration;\n                }\n            }\n\n            let mp4Sample = {\n                dts: dts,\n                pts: dts,\n                cts: 0,\n                size: unit.byteLength,\n                duration: sampleDuration,\n                originalDts: originalDts,\n                flags: {\n                    isLeading: 0,\n                    dependsOn: 1,\n                    isDependedOn: 0,\n                    hasRedundancy: 0\n                }\n            };\n            mp4Samples.push(mp4Sample);\n            mdatbox.set(unit, offset);\n            offset += unit.byteLength;\n        }\n        let latest = mp4Samples[mp4Samples.length - 1];\n        lastDts = latest.dts + latest.duration;\n        this._audioNextDts = lastDts;\n\n        // fill media segment info & add to info list\n        let info = new MediaSegmentInfo();\n        info.beginDts = firstDts;\n        info.endDts = lastDts;\n        info.beginPts = firstDts;\n        info.endPts = lastDts;\n        info.originalBeginDts = mp4Samples[0].originalDts;\n        info.originalEndDts = latest.originalDts + latest.duration;\n        info.firstSample = new SampleInfo(mp4Samples[0].dts,\n                                          mp4Samples[0].pts,\n                                          mp4Samples[0].duration,\n                                          mp4Samples[0].originalDts,\n                                          false);\n        info.lastSample = new SampleInfo(latest.dts,\n                                         latest.pts,\n                                         latest.duration,\n                                         latest.originalDts,\n                                         false);\n        if (!this._isLive) {\n            this._audioSegmentInfoList.append(info);\n        }\n\n        track.samples = mp4Samples;\n        track.sequenceNumber++;\n\n        let moofbox = MP4.moof(track, firstDts);\n        track.samples = [];\n        track.length = 0;\n\n        this._onMediaSegment('audio', {\n            type: 'audio',\n            data: this._mergeBoxes(moofbox, mdatbox).buffer,\n            sampleCount: mp4Samples.length,\n            info: info\n        });\n    }\n\n    _generateSilentAudio(dts, frameDuration) {\n        Log.v(this.TAG, `GenerateSilentAudio: dts = ${dts}, duration = ${frameDuration}`);\n\n        let unit = AAC.getSilentFrame(this._audioMeta.channelCount);\n        if (unit == null) {\n            Log.w(this.TAG, `Cannot generate silent aac frame for channelCount = ${this._audioMeta.channelCount}`);\n            return null;\n        }\n\n        let mp4Sample = {\n            dts: dts,\n            pts: dts,\n            cts: 0,\n            size: unit.byteLength,\n            duration: frameDuration,\n            originalDts: dts,\n            flags: {\n                isLeading: 0,\n                dependsOn: 1,\n                isDependedOn: 0,\n                hasRedundancy: 0\n            }\n        };\n\n        return {\n            unit,\n            mp4Sample\n        };\n    }\n\n    _remuxVideo(videoTrack) {\n        let track = videoTrack;\n        let samples = track.samples;\n        let dtsCorrection = undefined;\n        let firstDts = -1, lastDts = -1;\n        let firstPts = -1, lastPts = -1;\n\n        if (!samples || samples.length === 0) {\n            return;\n        }\n\n        let bytes = 8 + videoTrack.length;\n        let mdatbox = new Uint8Array(bytes);\n        mdatbox[0] = (bytes >>> 24) & 0xFF;\n        mdatbox[1] = (bytes >>> 16) & 0xFF;\n        mdatbox[2] = (bytes >>>  8) & 0xFF;\n        mdatbox[3] = (bytes) & 0xFF;\n        mdatbox.set(MP4.types.mdat, 4);\n\n        let offset = 8;\n        let mp4Samples = [];\n        let info = new MediaSegmentInfo();\n\n        while (samples.length) {\n            let avcSample = samples.shift();\n            let keyframe = avcSample.isKeyframe;\n            let originalDts = avcSample.dts - this._dtsBase;\n\n            if (dtsCorrection == undefined) {\n                if (this._videoNextDts == undefined) {\n                    if (this._videoSegmentInfoList.isEmpty()) {\n                        dtsCorrection = 0;\n                    } else {\n                        let lastSample = this._videoSegmentInfoList.getLastSampleBefore(originalDts);\n                        if (lastSample != null) {\n                            let distance = (originalDts - (lastSample.originalDts + lastSample.duration));\n                            if (distance <= 3) {\n                                distance = 0;\n                            }\n                            let expectedDts = lastSample.dts + lastSample.duration + distance;\n                            dtsCorrection = originalDts - expectedDts;\n                        } else {  // lastSample == null\n                            dtsCorrection = 0;\n                        }\n                    }\n                } else {\n                    dtsCorrection = originalDts - this._videoNextDts;\n                }\n            }\n\n            let dts = originalDts - dtsCorrection;\n            let cts = avcSample.cts;\n            let pts = dts + cts;\n\n            if (firstDts === -1) {\n                firstDts = dts;\n                firstPts = pts;\n            }\n\n            // fill mdat box\n            let sampleSize = 0;\n            while (avcSample.units.length) {\n                let unit = avcSample.units.shift();\n                let data = unit.data;\n                mdatbox.set(data, offset);\n                offset += data.byteLength;\n                sampleSize += data.byteLength;\n            }\n\n            let sampleDuration = 0;\n\n            if (samples.length >= 1) {\n                let nextDts = samples[0].dts - this._dtsBase - dtsCorrection;\n                sampleDuration = nextDts - dts;\n            } else { \n                if (mp4Samples.length >= 1) {  // lastest sample, use second last duration\n                    sampleDuration = mp4Samples[mp4Samples.length - 1].duration;\n                } else {  // the only one sample, use reference duration\n                    sampleDuration = this._videoMeta.refSampleDuration;\n                }\n            }\n\n            if (keyframe) {\n                let syncPoint = new SampleInfo(dts, pts, sampleDuration, avcSample.dts, true);\n                syncPoint.fileposition = avcSample.fileposition;\n                info.appendSyncPoint(syncPoint);\n            }\n\n            let mp4Sample = {\n                dts: dts,\n                pts: pts,\n                cts: cts,\n                size: sampleSize,\n                isKeyframe: keyframe,\n                duration: sampleDuration,\n                originalDts: originalDts,\n                flags: {\n                    isLeading: 0,\n                    dependsOn: keyframe ? 2 : 1,\n                    isDependedOn: keyframe ? 1 : 0,\n                    hasRedundancy: 0,\n                    isNonSync: keyframe ? 0 : 1\n                }\n            };\n\n            mp4Samples.push(mp4Sample);\n        }\n        let latest = mp4Samples[mp4Samples.length - 1];\n        lastDts = latest.dts + latest.duration;\n        lastPts = latest.pts + latest.duration;\n        this._videoNextDts = lastDts;\n\n        // fill media segment info & add to info list\n        info.beginDts = firstDts;\n        info.endDts = lastDts;\n        info.beginPts = firstPts;\n        info.endPts = lastPts;\n        info.originalBeginDts = mp4Samples[0].originalDts;\n        info.originalEndDts = latest.originalDts + latest.duration;\n        info.firstSample = new SampleInfo(mp4Samples[0].dts,\n                                          mp4Samples[0].pts,\n                                          mp4Samples[0].duration,\n                                          mp4Samples[0].originalDts,\n                                          mp4Samples[0].isKeyframe);\n        info.lastSample = new SampleInfo(latest.dts,\n                                         latest.pts,\n                                         latest.duration,\n                                         latest.originalDts,\n                                         latest.isKeyframe);\n        if (!this._isLive) {\n            this._videoSegmentInfoList.append(info);\n        }\n\n        track.samples = mp4Samples;\n        track.sequenceNumber++;\n\n        // workaround for chrome < 50: force first sample as a random access point\n        // see https://bugs.chromium.org/p/chromium/issues/detail?id=229412\n        if (this._forceFirstIDR) {\n            let flags = mp4Samples[0].flags;\n            flags.dependsOn = 2;\n            flags.isNonSync = 0;\n        }\n\n        let moofbox = MP4.moof(track, firstDts);\n        track.samples = [];\n        track.length = 0;\n\n        this._onMediaSegment('video', {\n            type: 'video',\n            data: this._mergeBoxes(moofbox, mdatbox).buffer,\n            sampleCount: mp4Samples.length,\n            info: info\n        });\n    }\n\n    _mergeBoxes(moof, mdat) {\n        let result = new Uint8Array(moof.byteLength + mdat.byteLength);\n        result.set(moof, 0);\n        result.set(mdat, moof.byteLength);\n        return result;\n    }\n\n}\n\nexport default MP4Remuxer;","let Browser = {};\n\nfunction detect() {\n    // modified from jquery-browser-plugin\n\n    let ua = self.navigator.userAgent.toLowerCase();\n\n    let match = /(edge)\\/([\\w.]+)/.exec(ua) ||\n        /(opr)[\\/]([\\w.]+)/.exec(ua) ||\n        /(chrome)[ \\/]([\\w.]+)/.exec(ua) ||\n        /(iemobile)[\\/]([\\w.]+)/.exec(ua) ||\n        /(version)(applewebkit)[ \\/]([\\w.]+).*(safari)[ \\/]([\\w.]+)/.exec(ua) ||\n        /(webkit)[ \\/]([\\w.]+).*(version)[ \\/]([\\w.]+).*(safari)[ \\/]([\\w.]+)/.exec(ua) ||\n        /(webkit)[ \\/]([\\w.]+)/.exec(ua) ||\n        /(opera)(?:.*version|)[ \\/]([\\w.]+)/.exec(ua) ||\n        /(msie) ([\\w.]+)/.exec(ua) ||\n        ua.indexOf('trident') >= 0 && /(rv)(?::| )([\\w.]+)/.exec(ua) ||\n        ua.indexOf('compatible') < 0 && /(mozilla)(?:.*? rv:([\\w.]+)|)/.exec(ua) ||\n        [];\n\n    let platform_match = /(ipad)/.exec(ua) ||\n        /(ipod)/.exec(ua) ||\n        /(windows phone)/.exec(ua) ||\n        /(iphone)/.exec(ua) ||\n        /(kindle)/.exec(ua) ||\n        /(android)/.exec(ua) ||\n        /(windows)/.exec(ua) ||\n        /(mac)/.exec(ua) ||\n        /(linux)/.exec(ua) ||\n        /(cros)/.exec(ua) ||\n        [];\n\n    let matched = {\n        browser: match[5] || match[3] || match[1] || '',\n        version: match[2] || match[4] || '0',\n        majorVersion: match[4] || match[2] || '0',\n        platform: platform_match[0] || ''\n    };\n\n    let browser = {};\n    if (matched.browser) {\n        browser[matched.browser] = true;\n\n        let versionArray = matched.majorVersion.split('.');\n        browser.version = {\n            major: parseInt(matched.majorVersion, 10),\n            string: matched.version\n        };\n        if (versionArray.length > 1) {\n            browser.version.minor = parseInt(versionArray[1], 10);\n        }\n        if (versionArray.length > 2) {\n            browser.version.build = parseInt(versionArray[2], 10);\n        }\n    }\n\n    if (matched.platform) {\n        browser[matched.platform] = true;\n    }\n\n    if (browser.chrome || browser.opr || browser.safari) {\n        browser.webkit = true;\n    }\n\n    // MSIE. IE11 has 'rv' identifer\n    if (browser.rv || browser.iemobile) {\n        if (browser.rv) {\n            delete browser.rv;\n        }\n        let msie = 'msie';\n        matched.browser = msie;\n        browser[msie] = true;\n    }\n\n    // Microsoft Edge\n    if (browser.edge) {\n        delete browser.edge;\n        let msedge = 'msedge';\n        matched.browser = msedge;\n        browser[msedge] = true;\n    }\n\n    // Opera 15+\n    if (browser.opr) {\n        let opera = 'opera';\n        matched.browser = opera;\n        browser[opera] = true;\n    }\n\n    // Stock android browsers are marked as Safari\n    if (browser.safari && browser.android) {\n        let android = 'android';\n        matched.browser = android;\n        browser[android] = true;\n    }\n\n    browser.name = matched.browser;\n    browser.platform = matched.platform;\n\n    for (let key in Browser) {\n        if (Browser.hasOwnProperty(key)) {\n            delete Browser[key];\n        }\n    }\n    Object.assign(Browser, browser);\n}\n\ndetect();\n\nexport default Browser;","class BSearch {\n\n    static search(array, value, compare) {\n        if (array.length === 0) {\n            return 0;\n        }\n        if (compare(value, array[0]) < 0) {\n            return 0;\n        }\n        if (compare(value, array[array.length - 1]) >= 0) {\n            return array.length;\n        }\n\n        let mid = 0;\n        let low = 0;\n        let high = array.length;\n\n        while (low < high) {\n            mid = Math.floor((low + high) / 2);\n            let cmp = compare(array[mid], value);\n            if (cmp < 0) {\n                low = mid + 1;\n            } else if (cmp > 0) {\n                high = mid;\n            } else {\n                return mid;\n            }\n        }\n        return low;\n    }\n\n    static insert(array, value, compare) {\n        if (value == undefined) {\n            return -1;\n        }\n        if (compare == undefined) {\n            compare = BSearch.less;\n        }\n        let idx = BSearch.search(array, value, compare);\n        array.splice(idx, 0, value);\n        return idx;\n    }\n\n    static less(a, b) {\n        return a - b;\n    }\n\n    static greater(a, b) {\n        return b - a;\n    }\n\n}\n\nexport default BSearch;","export class RuntimeException {\n\n    constructor(message) {\n        this._message = message;\n    }\n\n    get name() {\n        return 'RuntimeException';\n    }\n\n    get message() {\n        return this._message;\n    }\n\n    toString() {\n        return this.name + ': ' + this.message;\n    }\n\n}\n\nexport class IllegalStateException extends RuntimeException {\n\n    constructor(message) {\n        super(message);\n    }\n\n    get name() {\n        return 'IllegalStateException';\n    }\n\n}\n\nexport class InvalidArgumentException extends RuntimeException {\n\n    constructor(message) {\n        super(message);\n    }\n\n    get name() {\n        return 'InvalidArgumentException';\n    }\n\n}\n\nexport class NotImplementedException extends RuntimeException {\n\n    constructor(message) {\n        super(message);\n    }\n\n    get name() {\n        return 'NotImplementedException';\n    }\n\n}\n","class Log {\n\n    static e(tag, msg) {\n        if (!Log.ENABLE_ERROR) {\n            return;\n        }\n\n        if (!tag || Log.FORCE_GLOBAL_TAG)\n            tag = Log.GLOBAL_TAG;\n\n        let str = `[${tag}] > ${msg}`;\n\n        if (console.error) {\n            console.error(str);\n        } else if (console.warn) {\n            console.warn(str);\n        } else {\n            console.log(str);\n        }\n    }\n\n    static i(tag, msg) {\n        if (!Log.ENABLE_INFO) {\n            return;\n        }\n\n        if (!tag || Log.FORCE_GLOBAL_TAG)\n            tag = Log.GLOBAL_TAG;\n\n        let str = `[${tag}] > ${msg}`;\n\n        if (console.info) {\n            console.info(str);\n        } else {\n            console.log(str);\n        }\n    }\n\n    static w(tag, msg) {\n        if (!Log.ENABLE_WARN) {\n            return;\n        }\n\n        if (!tag || Log.FORCE_GLOBAL_TAG)\n            tag = Log.GLOBAL_TAG;\n\n        let str = `[${tag}] > ${msg}`;\n\n        if (console.warn) {\n            console.warn(str);\n        } else {\n            console.log(str);\n        }\n    }\n\n    static d(tag, msg) {\n        if (!Log.ENABLE_DEBUG) {\n            return;\n        }\n\n        if (!tag || Log.FORCE_GLOBAL_TAG)\n            tag = Log.GLOBAL_TAG;\n\n        let str = `[${tag}] > ${msg}`;\n\n        if (console.debug) {\n            console.debug(str);\n        } else {\n            console.log(str);\n        }\n    }\n\n    static v(tag, msg) {\n        if (!Log.ENABLE_VERBOSE) {\n            return;\n        }\n\n        if (!tag || Log.FORCE_GLOBAL_TAG)\n            tag = Log.GLOBAL_TAG;\n\n        console.log(`[${tag}] > ${msg}`);\n    }\n\n}\n\nLog.GLOBAL_TAG = 'flv.js';\nLog.FORCE_GLOBAL_TAG = false;\nLog.ENABLE_ERROR = true;\nLog.ENABLE_INFO = true;\nLog.ENABLE_WARN = true;\nLog.ENABLE_DEBUG = true;\nLog.ENABLE_VERBOSE = true;\n\nexport default Log;","import EventEmitter from 'events';\nimport Log from './logger.js';\n\nclass LoggingControl {\n\n    static get forceGlobalTag() {\n        return Log.FORCE_GLOBAL_TAG;\n    }\n\n    static set forceGlobalTag(enable) {\n        Log.FORCE_GLOBAL_TAG = enable;\n        LoggingControl._notifyChange();\n    }\n\n    static get globalTag() {\n        return Log.GLOBAL_TAG;\n    }\n\n    static set globalTag(tag) {\n        Log.GLOBAL_TAG = tag;\n        LoggingControl._notifyChange();\n    }\n\n    static get enableAll() {\n        return Log.ENABLE_VERBOSE\n            && Log.ENABLE_DEBUG\n            && Log.ENABLE_INFO\n            && Log.ENABLE_WARN\n            && Log.ENABLE_ERROR;\n    }\n\n    static set enableAll(enable) {\n        Log.ENABLE_VERBOSE = enable;\n        Log.ENABLE_DEBUG = enable;\n        Log.ENABLE_INFO = enable;\n        Log.ENABLE_WARN = enable;\n        Log.ENABLE_ERROR = enable;\n        LoggingControl._notifyChange();\n    }\n\n    static get enableDebug() {\n        return Log.ENABLE_DEBUG;\n    }\n\n    static set enableDebug(enable) {\n        Log.ENABLE_DEBUG = enable;\n        LoggingControl._notifyChange();\n    }\n\n    static get enableVerbose() {\n        return Log.ENABLE_VERBOSE;\n    }\n\n    static set enableVerbose(enable) {\n        Log.ENABLE_VERBOSE = enable;\n        LoggingControl._notifyChange();\n    }\n\n    static get enableInfo() {\n        return Log.ENABLE_INFO;\n    }\n\n    static set enableInfo(enable) {\n        Log.ENABLE_INFO = enable;\n        LoggingControl._notifyChange();\n    }\n\n    static get enableWarn() {\n        return Log.ENABLE_WARN;\n    }\n\n    static set enableWarn(enable) {\n        Log.ENABLE_WARN = enable;\n        LoggingControl._notifyChange();\n    }\n\n    static get enableError() {\n        return Log.ENABLE_ERROR;\n    }\n\n    static set enableError(enable) {\n        Log.ENABLE_ERROR = enable;\n        LoggingControl._notifyChange();\n    }\n\n    static getConfig() {\n        return {\n            globalTag: Log.GLOBAL_TAG,\n            forceGlobalTag: Log.FORCE_GLOBAL_TAG,\n            enableVerbose: Log.ENABLE_VERBOSE,\n            enableDebug: Log.ENABLE_DEBUG,\n            enableInfo: Log.ENABLE_INFO,\n            enableWarn: Log.ENABLE_WARN,\n            enableError: Log.ENABLE_ERROR\n        };\n    }\n\n    static applyConfig(config) {\n        Log.GLOBAL_TAG = config.globalTag;\n        Log.FORCE_GLOBAL_TAG = config.forceGlobalTag;\n        Log.ENABLE_VERBOSE = config.enableVerbose;\n        Log.ENABLE_DEBUG = config.enableDebug;\n        Log.ENABLE_INFO = config.enableInfo;\n        Log.ENABLE_WARN = config.enableWarn;\n        Log.ENABLE_ERROR = config.enableError;\n    }\n\n    static _notifyChange() {\n        let emitter = LoggingControl.emitter;\n\n        if (emitter.listenerCount('change') > 0) {\n            let config = LoggingControl.getConfig();\n            emitter.emit('change', config);\n        }\n    }\n\n    static registerListener(listener) {\n        LoggingControl.emitter.addListener('change', listener);\n    }\n\n    static removeListener(listener) {\n        LoggingControl.emitter.removeListener('change', listener);\n    }\n\n}\n\nLoggingControl.emitter = new EventEmitter();\n\nexport default LoggingControl;","class Polyfill {\n\n    static install() {\n        // ES6 Object.setPrototypeOf\n        Object.setPrototypeOf = Object.setPrototypeOf || function (obj, proto) {\n            obj.__proto__ = proto;\n            return obj;\n        };\n\n        // ES6 Object.assign\n        Object.assign = Object.assign || function (target) {\n            if (target === undefined || target === null) {\n                throw new TypeError('Cannot convert undefined or null to object');\n            }\n\n            let output = Object(target);\n            for (let i = 1; i < arguments.length; i++) {\n                let source = arguments[i];\n                if (source !== undefined && source !== null) {\n                    for (let key in source) {\n                        if (source.hasOwnProperty(key)) {\n                            output[key] = source[key];\n                        }\n                    }\n                }\n            }\n            return output;\n        };\n\n        // ES6 Promise (missing support in IE11)\n        if (typeof self.Promise !== 'function') {\n            // polyfill() will be called internally during module load\n            require('es6-promise');\n        }\n    }\n\n}\n\nPolyfill.install();\n\nexport default Polyfill;","// translate from C++ project libWinTF8 (https://github.com/m13253/libWinTF8)\n\nfunction checkContinuation(uint8array, start, checkLength) {\n    let array = uint8array;\n    if (start + checkLength < array.length) {\n        while (checkLength--) {\n            if ((array[++start] & 0xC0) !== 0x80)\n                return false;\n        }\n        return true;\n    } else {\n        return false;\n    }\n}\n\nfunction decodeUTF8(uint8array) {\n    let out = [];\n    let input = uint8array;\n    let i = 0;\n    let length = uint8array.length;\n\n    while (i < length) {\n        if (input[i] < 0x80) {\n            out.push(String.fromCharCode(input[i]));\n            ++i;\n            continue;\n        } else if (input[i] < 0xC0) {\n            // fallthrough\n        } else if (input[i] < 0xE0) {\n            if (checkContinuation(input, i, 1)) {\n                let ucs4 = (input[i] & 0x1F) << 6 | (input[i + 1] & 0x3F);\n                if (ucs4 >= 0x80) {\n                    out.push(String.fromCharCode(ucs4 & 0xFFFF));\n                    i += 2;\n                    continue;\n                }\n            }\n        } else if (input[i] < 0xF0) {\n            if (checkContinuation(input, i, 2)) {\n                let ucs4 = (input[i] & 0xF) << 12 | (input[i + 1] & 0x3F) << 6 | input[i + 2] & 0x3F;\n                if (ucs4 >= 0x800 && (ucs4 & 0xF800) !== 0xD800) {\n                    out.push(String.fromCharCode(ucs4 & 0xFFFF));\n                    i += 3;\n                    continue;\n                }\n            }\n        } else if (input[i] < 0xF8) {\n            if (checkContinuation(input, i, 3)) {\n                let ucs4 = (input[i] & 0x7) << 18 | (input[i + 1] & 0x3F) << 12\n                         | (input[i + 2] & 0x3F) << 6 | (input[i + 3] & 0x3F);\n                if (ucs4 > 0x10000 && ucs4 < 0x110000) {\n                    ucs4 -= 0x10000;\n                    out.push(String.fromCharCode((ucs4 >>> 10) | 0xD800));\n                    out.push(String.fromCharCode((ucs4 & 0x3FF) | 0xDC00));\n                    i += 4;\n                    continue;\n                }\n            }\n        }\n        out.push(String.fromCharCode(0xFFFD));\n        ++i;\n    }\n\n    return out.join('');\n}\n\nexport default decodeUTF8;"],"sourceRoot":"/source/"}